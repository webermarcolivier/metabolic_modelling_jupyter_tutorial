!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.escher=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){this.map=a,this.undo_stack=b,this.empty_behavior=function(){},this.rotation_mode_enabled=!1,this.rotation_drag=d3.behavior.drag(),this.selectable_mousedown=null,this.text_label_mousedown=null,this.text_label_click=null,this.selectable_drag=this.empty_behavior,this.node_mouseover=null,this.node_mouseout=null,this.label_mousedown=null,this.label_mouseover=null,this.label_mouseout=null,this.bezier_drag=this.empty_behavior,this.bezier_mouseover=null,this.bezier_mouseout=null,this.reaction_label_drag=this.empty_behavior,this.node_label_drag=this.empty_behavior,this.turn_everything_on()}function e(){this.toggle_selectable_click(!0),this.toggle_selectable_drag(!0),this.toggle_label_drag(!0),this.toggle_label_mousedown(!0)}function f(){this.toggle_selectable_click(!1),this.toggle_selectable_drag(!1),this.toggle_label_drag(!1),this.toggle_label_mousedown(!1)}function g(a){function b(){var a=this.map.sel.selectAll("#rotation-center").data([0]),b=a.enter().append("g").attr("id","rotation-center");b.append("path").attr("d","M-32 0 L32 0").attr("class","rotation-center-line"),b.append("path").attr("d","M0 -32 L0 32").attr("class","rotation-center-line"),a.attr("transform","translate("+this.center.x+","+this.center.y+")").attr("visibility","visible"),a.call(d3.behavior.drag().on("drag",function(a){var b=u.d3_transform_catch(a.attr("transform")),c=[d3.event.dx+b.translate[0],d3.event.dy+b.translate[1]];a.attr("transform","translate("+c+")"),this.center={x:c[0],y:c[1]}}.bind(this,a))),a.on("mouseover",function(){var a=parseFloat(this.selectAll("path").style("stroke-width"));this.selectAll("path").style("stroke-width",2*a+"px")}.bind(a)),a.on("mouseout",function(){this.selectAll("path").style("stroke-width",null)}.bind(a))}function c(a){this.map.sel.select("#rotation-center").attr("visibility","hidden")}function d(a){var b=[],c=[];for(var d in a){var e=a[d];void 0!==e.x&&b.push(e.x),void 0!==e.y&&c.push(e.y)}return{x:u.mean(b),y:u.mean(c)}}void 0===a?this.rotation_mode_enabled=!this.rotation_mode_enabled:this.rotation_mode_enabled=a;var e=this.map.sel.selectAll(".node-circle"),f=this.map.sel.selectAll("#canvas");if(this.rotation_mode_enabled){this.map.callback_manager.run("start_rotation");var g=this.map.get_selected_nodes();if(0==Object.keys(g).length)return void console.warn("No selected nodes");this.center=d(g),b.call(this);var h=this.map,i=Object.keys(g),j=this.map.reactions,k=this.map.nodes,l=this.map.beziers,m=function(a){d3.event.sourceEvent.stopPropagation()},n=function(a,b,c,d){var e=v.rotate_nodes(g,j,l,b,d);h.draw_these_nodes(e.node_ids),h.draw_these_reactions(e.reaction_ids)},o=function(a){},p=function(a,b,c){var d={};i.forEach(function(a){d[a]=k[a]});var e=v.rotate_nodes(d,j,l,-b,c);h.draw_these_nodes(e.node_ids),h.draw_these_reactions(e.reaction_ids)},q=function(a,b,c){var d={};i.forEach(function(a){d[a]=k[a]});var e=v.rotate_nodes(d,j,l,b,c);h.draw_these_nodes(e.node_ids),h.draw_these_reactions(e.reaction_ids)},r=function(){return this.center}.bind(this);this.rotation_drag=this._get_generic_angular_drag(m,n,o,p,q,r,this.map.sel),f.call(this.rotation_drag),this.selectable_drag=this.rotation_drag}else c.call(this),e.on("mousedown.center",null),f.on("mousedown.center",null),f.on("mousedown.drag",null),f.on("touchstart.drag",null),this.rotation_drag=null,this.selectable_drag=null}function h(a){if(void 0===a&&(a=null===this.selectable_mousedown),a){var b=this.map;this.selectable_mousedown=function(a){d3.event.stopPropagation()},this.selectable_click=function(a){d3.event.stopPropagation(),d3.event.defaultPrevented||b.select_selectable(this,a,d3.event.shiftKey)},this.node_mouseover=function(a){d3.select(this).style("stroke-width",null);var b=parseFloat(d3.select(this).style("stroke-width"));d3.select(this.parentNode).classed("selected")||d3.select(this).style("stroke-width",3*b+"px")},this.node_mouseout=function(a){d3.select(this).style("stroke-width",null)}}else this.selectable_mousedown=null,this.selectable_click=null,this.node_mouseover=null,this.node_mouseout=null,this.map.sel.select("#nodes").selectAll(".node-circle").style("stroke-width",null)}function i(a){if(void 0===a&&(a=null==this.text_edit_mousedown),a){var b=this.map;this.selection;this.text_label_mousedown=function(){if(!d3.event.defaultPrevented){var a=u.d3_transform_catch(d3.select(this).attr("transform")).translate,c={x:a[0],y:a[1]};b.callback_manager.run("edit_text_label",null,d3.select(this),c),d3.event.stopPropagation()}},this.text_label_click=null,this.map.sel.select("#text-labels").selectAll(".label").classed("edit-text-cursor",!0),this.map.sel.on("mousedown.new_text_label",function(a){d3.event.preventDefault();var b={x:d3.mouse(a)[0],y:d3.mouse(a)[1]};this.map.callback_manager.run("new_text_label",null,b)}.bind(this,this.map.sel.node()))}else this.text_label_mousedown=this.selectable_mousedown,this.text_label_click=this.selectable_click,this.map.sel.select("#text-labels").selectAll(".label").classed("edit-text-cursor",!1),this.map.sel.on("mousedown.new_text_label",null),this.map.callback_manager.run("hide_text_label_editor")}function j(a){void 0===a&&(a=this.selectable_drag===this.empty_behavior),a?(this.selectable_drag=this._get_selectable_drag(this.map,this.undo_stack),this.bezier_drag=this._get_bezier_drag(this.map,this.undo_stack)):(this.selectable_drag=this.empty_behavior,this.bezier_drag=this.empty_behavior)}function k(a){void 0===a&&(a=this.label_drag===this.empty_behavior),a?(this.reaction_label_drag=this._get_reaction_label_drag(this.map),this.node_label_drag=this._get_node_label_drag(this.map)):(this.reaction_label_drag=this.empty_behavior,this.node_label_drag=this.empty_behavior)}function l(a){if(void 0===a&&(a=null==this.label_mousedown),a){this.map;this.label_mousedown=function(a){},this.label_mouseover=function(a){},this.label_mouseout=function(a){}}else this.label_mousedown=null,this.label_mouseover=null,this.label_mouseout=null,this.map.sel.select(".node-label,.reaction-label").style("fill",null)}function m(a){void 0===a&&(a=this.bezier_drag===this.empty_behavior),a?(this.bezier_drag=this._get_bezier_drag(this.map),this.bezier_mouseover=function(a){d3.select(this).style("stroke-width",String(3)+"px")},this.bezier_mouseout=function(a){d3.select(this).style("stroke-width",String(1)+"px")}):(this.bezier_drag=this.empty_behavior,this.bezier_mouseover=null,this.bezier_mouseout=null)}function n(a){a.on("mousedown.drag",null),a.on("touchstart.drag",null)}function o(a,b){function c(b,c){var d=a.nodes[c],e=a.nodes[b],f=[];return d.connected_segments.forEach(function(d){var g;try{if(g=a.reactions[d.reaction_id].segments[d.segment_id],void 0===g)throw new Error("undefined segment")}catch(h){return void console.warn("Could not find connected segment "+d.segment_id)}if(g.from_node_id==c)g.from_node_id=b;else{if(g.to_node_id!=c)return void console.error("Segment does not connect to dragged node");g.to_node_id=b}e.connected_segments.push(d),f.push(u.clone(d))}),a.delete_node_data([c]),a.sel.selectAll(".node-to-combine").classed("node-to-combine",!1),a.draw_everything(),f}var d=d3.behavior.drag(),e=null,f=null,g=null,h=null,i=null,j=function(b,c){var d=a.text_labels[b];d.x=d.x+c.x,d.y=d.y+c.y};return d.on("dragstart",function(b){if(d3.event.sourceEvent.stopPropagation(),f={x:0,y:0},-1==d3.select(this).attr("class").indexOf("label")){var c=this.parentNode.__data__,d=c.bigg_id,g=this.parentNode;e=setTimeout(function(){g.parentNode.insertBefore(g,g.parentNode.firstChild)},200),a.sel.selectAll(".metabolite-circle").on("mouseover.combine",function(a){a.bigg_id==d&&a.node_id!=c.node_id&&d3.select(this).style("stroke-width",String(12)+"px").classed("node-to-combine",!0)}).on("mouseout.combine",function(b){b.bigg_id==d&&a.sel.selectAll(".node-to-combine").style("stroke-width",String(2)+"px").classed("node-to-combine",!1)})}}),d.on("drag",function(b){d3.select(this.parentNode).classed("selected")||a.select_selectable(this,b);var c={};-1===d3.select(this).attr("class").indexOf("label")?(c.type="node",c.id=this.parentNode.__data__.node_id):(c.type="label",c.id=this.__data__.text_label_id);var d=a.get_selected_node_ids(),e=a.get_selected_text_label_ids();g=[],i=[],"node"==c.type&&-1==d.indexOf(c.id)?g.push(c.id):"label"==c.type&&-1==e.indexOf(c.id)?i.push(c.id):(g=d,i=e),h=[];var k={x:d3.event.dx,y:d3.event.dy};f=u.c_plus_c(f,k),g.forEach(function(b){var c=a.nodes[b],d=v.move_node_and_dependents(c,b,a.reactions,a.beziers,k);h=u.unique_concat([h,d.reaction_ids])}),i.forEach(function(a){j(a,k)}),a.draw_these_nodes(g),a.draw_these_reactions(h),a.draw_these_text_labels(i)}),d.on("dragend",function(){if(null===g)return f=null,g=null,i=null,h=null,void(e=null);var d=[];if(a.sel.selectAll(".node-to-combine").each(function(a){d.push(a.node_id)}),1==d.length){var k=d[0],l=this.parentNode.__data__.node_id,m=u.clone(a.nodes[l]),n=c(k,l);b.push(function(){a.nodes[l]=m;var b=a.nodes[k],c=[];n.forEach(function(d){var e=a.reactions[d.reaction_id].segments[d.segment_id];e.from_node_id==k?e.from_node_id=l:e.to_node_id==k?e.to_node_id=l:console.error("Segment does not connect to fixed node"),b.connected_segments=b.connected_segments.filter(function(a){return!(a.reaction_id==d.reaction_id&&a.segment_id==d.segment_id)}),-1==c.indexOf(d.reaction_id)&&c.push(d.reaction_id)}),a.draw_these_nodes([l]),a.draw_these_reactions(c)},function(){c(k,l)})}else{var o=u.clone(f),p=u.clone(g),q=u.clone(i),r=u.clone(h);b.push(function(){p.forEach(function(b){var c=a.nodes[b];v.move_node_and_dependents(c,b,a.reactions,a.beziers,u.c_times_scalar(o,-1))}),q.forEach(function(a){j(a,u.c_times_scalar(o,-1))}),a.draw_these_nodes(p),a.draw_these_reactions(r),a.draw_these_text_labels(q)},function(){p.forEach(function(b){var c=a.nodes[b];v.move_node_and_dependents(c,b,a.reactions,a.beziers,o)}),q.forEach(function(a){j(a,o)}),a.draw_these_nodes(p),a.draw_these_reactions(r),a.draw_these_text_labels(q)})}a.sel.selectAll(".metabolite-circle").on("mouseover.combine",null).on("mouseout.combine",null),clearTimeout(e),f=null,g=null,i=null,h=null,e=null}),d}function p(a){var b=function(b,c,d,e,f){var g=a.reactions[b].segments[c];g[d]=u.c_plus_c(g[d],f),a.beziers[e].x=g[d].x,a.beziers[e].y=g[d].y},c=function(a){a.dragging=!0},d=function(c,d,e){b(c.reaction_id,c.segment_id,c.bezier,c.bezier_id,d),a.draw_these_reactions([c.reaction_id],!1),a.draw_these_beziers([c.bezier_id])},e=function(a){a.dragging=!1},f=function(c,d){b(c.reaction_id,c.segment_id,c.bezier,c.bezier_id,u.c_times_scalar(d,-1)),a.draw_these_reactions([c.reaction_id],!1),a.draw_these_beziers([c.bezier_id])},g=function(c,d){b(c.reaction_id,c.segment_id,c.bezier,c.bezier_id,d),a.draw_these_reactions([c.reaction_id],!1),a.draw_these_beziers([c.bezier_id])};return this._get_generic_drag(c,d,e,f,g,this.map.sel)}function q(a){var b=function(b,c){var d=a.reactions[b];d.label_x=d.label_x+c.x,d.label_y=d.label_y+c.y},c=function(a){},d=function(c,d,e){b(c.reaction_id,d),a.draw_these_reactions([c.reaction_id])},e=function(a){},f=function(c,d){b(c.reaction_id,u.c_times_scalar(d,-1)),a.draw_these_reactions([c.reaction_id])},g=function(c,d){b(c.reaction_id,d),a.draw_these_reactions([c.reaction_id])};return this._get_generic_drag(c,d,e,f,g,this.map.sel)}function r(a){var b=function(b,c){var d=a.nodes[b];d.label_x=d.label_x+c.x,d.label_y=d.label_y+c.y},c=function(a){},d=function(c,d,e){b(c.node_id,d),a.draw_these_nodes([c.node_id])},e=function(a){},f=function(c,d){b(c.node_id,u.c_times_scalar(d,-1)),a.draw_these_nodes([c.node_id])},g=function(c,d){b(c.node_id,d),a.draw_these_nodes([c.node_id])};return this._get_generic_drag(c,d,e,f,g,this.map.sel)}function s(a,b,c,d,e,f){var g,h=d3.behavior.drag(),i=this.undo_stack,j=f.node();return h.on("dragstart",function(b){d3.event.sourceEvent.stopPropagation(),g={x:0,y:0},a(b)}),h.on("drag",function(a){var c={x:d3.event.dx,y:d3.event.dy},d={x:d3.mouse(j)[0],y:d3.mouse(j)[1]};g=u.c_plus_c(g,c),b(a,c,g,d)}),h.on("dragend",function(a){var b=u.clone(a),f=u.clone(g),h={x:d3.mouse(j)[0],y:d3.mouse(j)[1]};i.push(function(){d(b,f,h)},function(){e(b,f,h)}),c(a)}),h}function t(a,b,c,d,e,f,g){var h,i=d3.behavior.drag(),j=this.undo_stack,k=g.node();return i.on("dragstart",function(b){d3.event.sourceEvent.stopPropagation(),h=0,a(b)}),i.on("drag",function(a){var c={x:d3.event.dx,y:d3.event.dy},d={x:d3.mouse(k)[0],y:d3.mouse(k)[1]},e=f(),g=u.angle_for_event(c,d,e);h+=g,b(a,g,h,e)}),i.on("dragend",function(a){var b=u.clone(a),g=h,i=u.clone(f());j.push(function(){d(b,g,i)},function(){e(b,g,i)}),c(a)}),i}var u=a("./utils"),v=a("./build"),w=u.make_class();w.prototype={init:d,toggle_rotation_mode:g,turn_everything_on:e,turn_everything_off:f,toggle_selectable_click:h,toggle_text_label_edit:i,toggle_selectable_drag:j,toggle_label_drag:k,toggle_label_mousedown:l,toggle_bezier_drag:m,turn_off_drag:n,_get_selectable_drag:o,_get_bezier_drag:p,_get_reaction_label_drag:q,_get_node_label_drag:r,_get_generic_drag:s,_get_generic_angular_drag:t},b.exports=w},{"./build":24,"./utils":31}],2:[function(a,b,c){function d(a,b,c,d){this.brush_sel=a.append("g").attr("id","brush-container");var e=this.brush_sel.node(),f=a.select(d).node().nextSibling;e!==f&&e.parentNode.insertBefore(e,f),this.enabled=b,this.map=c}function e(a){void 0===a&&(a=!this.enabled),a?this.selection_brush=this.setup_selection_brush():this.brush_sel.selectAll(".brush").remove()}function f(){var a=this.brush_sel,b=this.map.sel.selectAll("#nodes,#text-labels"),c=this.map.canvas.size_and_location(),d=c.width,e=c.height,f=c.x,g=c.y;a.selectAll("g").remove();var h=d3.svg.brush().x(d3.scale.identity().domain([f,f+d])).y(d3.scale.identity().domain([g,g+e])).on("brush",function(){var a,c=d3.event.sourceEvent.shiftKey,d=d3.event.target.extent();a=c?b.selectAll(".node:not(.selected),.text-label:not(.selected)"):b.selectAll(".node,.text-label"),a.classed("selected",function(a){var b=a.x,c=a.y;return d[0][0]<=b&&b<d[1][0]&&d[0][1]<=c&&c<d[1][1]&&"hidden"!==d3.select(this).select(".node-circle").style("visibility")})}).on("brushend",function(){d3.event.target.clear(),d3.select(this).call(d3.event.target)}),i=a.append("g").attr("class","brush").call(h);return a.selectAll(".background").classed("cursor-grab",!1).classed("cursor-grabbing",!1).style("cursor",null),i}var g=a("./utils"),h=g.make_class();h.prototype={init:d,toggle:e,setup_selection_brush:f},b.exports=h},{"./utils":31}],3:[function(a,b,c){function d(a,b,c,d){var e=a.append("div").attr("id","rxn-input");this.placed_div=s(e,b,{x:240,y:0}),this.placed_div.hide();var f=t(e.node(),{backgroundColor:"#eee"});d3.select(f.input),this.completely=f,e.append("button").attr("class","button input-close-button").text("×").on("mousedown",function(){this.hide_dropdown()}.bind(this)),this.map=b;var g=90;this.direction_arrow=new u(b.sel),this.direction_arrow.set_rotation(g),this.setup_map_callbacks(b),this.zoom_container=c,this.setup_zoom_callbacks(c),this.settings=d,this.toggle(!1),this.target_coords=null}function e(a){a.callback_manager.set("select_metabolite_with_id.input",function(a,b){this.is_active&&(this.reload(a,b,!1),this.show_dropdown(b)),this.hide_target()}.bind(this)),a.callback_manager.set("select_selectable.input",function(a,b,c){this.hide_target(),1==a&&this.is_active&&c?(this.reload(b,c,!1),this.show_dropdown(c)):this.toggle(!1)}.bind(this)),a.callback_manager.set("deselect_nodes",function(){this.direction_arrow.hide(),this.hide_dropdown()}.bind(this)),a.callback_manager.set("before_svg_export",function(){this.direction_arrow.hide(),this.hide_target()}.bind(this))}function f(a){a.callback_manager.set("zoom.input",function(){this.is_active&&this.place_at_selected()}.bind(this))}function g(){return this.placed_div.is_visible()}function h(a){void 0===a?this.is_active=!this.is_active:this.is_active=a,this.is_active?(this.toggle_start_reaction_listener(!0),w.isNull(this.target_coords)?this.reload_at_selected():this.placed_div.place(this.target_coords),this.show_dropdown(),this.map.set_status("Click on the canvas or an existing metabolite"),this.direction_arrow.show()):(this.toggle_start_reaction_listener(!1),this.hide_dropdown(),this.map.set_status(null),this.direction_arrow.hide())}function i(a){this.clear_escape=this.map.key_manager.add_escape_listener(function(){this.hide_dropdown()}.bind(this),!0),this.completely.input.blur(),this.completely.repaint(),this.completely.setText(""),this.completely.input.focus()}function j(){this.clear_escape&&this.clear_escape(),this.clear_escape=null,this.placed_div.hide(),this.completely.input.blur(),this.completely.hideDropDown()}function k(){this.map.deselect_text_labels();var a=this.map.select_single_node();if(null!=a){var b={x:a.x,y:a.y};this.place(b)}}function l(a){this.placed_div.place(a),this.direction_arrow.set_location(a),this.direction_arrow.show()}function m(){this.map.deselect_text_labels();var a=this.map.select_single_node();if(null==a)return!1;var b={x:a.x,y:a.y};return this.reload(a,b,!1),!0}function n(a,b,c){function d(a,b){for(var c in b)if(b[c].bigg_id==a)return!0;return!1}if(!c&&!a)return void console.error("No selected node, and not starting from scratch");if(this.place(b),null===this.map.cobra_model)return void this.completely.setText("Cannot add: No model.");var e="name"==this.settings.get_option("identifiers_on_map"),f=this.settings.get_option("allow_building_duplicate_reactions"),g=[],h=this.map.cobra_model.reactions,i=this.map.cobra_model.metabolites,j=this.map.reactions,k=this.map.has_data_on_reactions,l=(this.map.reaction_data,this.map.reaction_data_styles,a?e?a.name:a.bigg_id:""),m=function(a,b){return a.replace(new RegExp("(^| )("+b.join("|")+")($| )","g"),"$1<b>$2</b>$3")},n={};for(var o in h){var p=h[o],q=p.name,s=e?q:o;if(f||!d(o,j))for(var t in p.metabolites)if(c||t==a.bigg_id){if(o in n)continue;i[t].name;if(k)g.push({reaction_data:p.data,html:"<b>"+s+"</b>: "+p.data_string,matches:[s],id:o}),n[o]=!0;else{var u,x={},y=[];if(e)for(u in p.metabolites){var z=i[u].name;x[z]=p.metabolites[u],y.push(z)}else{x=r.clone(p.metabolites);for(u in p.metabolites)y.push(u)}var A=w.flatten(p.genes.map(function(a){return[a.name,a.bigg_id]})),B=v.build_reaction_string(x,p.reversibility,p.lower_bound,p.upper_bound);g.push({html:"<b>"+s+"</b>	"+m(B,[l]),matches:[s].concat(y).concat(A),id:o}),n[o]=!0}}}var C;C=k?function(a,b){return Math.abs(b.reaction_data)-Math.abs(a.reaction_data)}:function(a,b){return a.html.toLowerCase()<b.html.toLowerCase()?-1:1},g=g.sort(C);var D=this.completely;D.options=g,D.setText("");var E=this.direction_arrow,F=function(d){if(null!==d)if(c)this.map.new_reaction_from_scratch(d,b,E.get_rotation());else{if(!(a.node_id in this.map.nodes))return console.error("Selected node no longer exists"),void this.hide_dropdown();this.map.new_reaction_for_metabolite(d,a.node_id,E.get_rotation())}}.bind(this);D.onEnter=function(a){this.setText(""),this.onChange(""),F(a)}}function o(a){if(void 0===a)this.start_reaction_listener=!this.start_reaction_listener;else{if(this.start_reaction_listener==a)return;this.start_reaction_listener=a}this.start_reaction_listener?(this.map.sel.on("click.start_reaction",function(a){if(!this.direction_arrow.dragging){var b={x:d3.mouse(a)[0],y:d3.mouse(a)[1]};this.map.deselect_nodes(),this.map.deselect_text_labels(),this.reload(null,b,!0),this.show_target(this.map,b),this.show_dropdown(b)}}.bind(this,this.map.sel.node())),this.map.sel.classed("start-reaction-cursor",!0)):(this.map.sel.on("click.start_reaction",null),this.map.sel.classed("start-reaction-cursor",!1),this.hide_target())}function p(){this.target_coords&&this.map.sel.selectAll(".start-reaction-target").remove(),this.target_coords=null}function q(a,b){var c=a.sel.selectAll(".start-reaction-target").data([12,5]);c.enter().append("circle").classed("start-reaction-target",!0).attr("r",function(a){return a}).style("stroke-width",4),c.style("visibility","visible").attr("transform","translate("+b.x+","+b.y+")"),this.target_coords=b}var r=a("./utils"),s=a("./PlacedDiv"),t=a("./complete.ly"),u=a("./DirectionArrow"),v=a("./CobraModel"),w=a("underscore"),x=r.make_class();x.prototype={init:d,setup_map_callbacks:e,setup_zoom_callbacks:f,is_visible:g,toggle:h,show_dropdown:i,hide_dropdown:j,place_at_selected:k,place:l,reload_at_selected:m,reload:n,toggle_start_reaction_listener:o,hide_target:p,show_target:q},b.exports=x},{"./CobraModel":7,"./DirectionArrow":9,"./PlacedDiv":13,"./complete.ly":25,"./utils":31,underscore:35}],4:[function(a,b,c){function d(a,b,c,d,e){if(d||(d=d3.select("body").append("div")),e||(e={}),c||(c=N),this.map_data=a,this.model_data=b,this.embedded_css=c,this.selection=d,this.selection.datum(this),this.selection.__builder__=this,this.options=z.set_options(e,{menu:"all",scroll_behavior:"pan",use_3d_transform:!z.check_browser("safari"),enable_editing:!0,enable_keys:!0,enable_search:!0,fill_screen:!1,zoom_to_element:null,full_screen_button:!1,ignore_bootstrap:!1,starting_reaction:null,never_ask_before_quit:!1,unique_map_id:null,primary_metabolite_radius:20,secondary_metabolite_radius:10,marker_radius:5,gene_font_size:18,hide_secondary_metabolites:!1,show_gene_reaction_rules:!1,hide_all_labels:!1,reaction_data:null,reaction_styles:["color","size","text"],reaction_compare_style:"log2_fold",reaction_scale:[{type:"min",color:"#c8c8c8",size:12},{type:"median",color:"#9696ff",size:20},{type:"max",color:"#ff0000",size:25}],reaction_no_data_color:"#dcdcdc",reaction_no_data_size:8,gene_data:null,and_method_in_gene_reaction_rule:"mean",metabolite_data:null,metabolite_styles:["color","size","text"],metabolite_compare_style:"log2_fold",metabolite_scale:[{type:"min",color:"#fffaf0",size:20},{type:"median",color:"#f1c470",size:30},{type:"max",color:"#800000",size:40}],metabolite_no_data_color:"#ffffff",metabolite_no_data_size:10,identifiers_on_map:"bigg_id",highlight_missing:!1,allow_building_duplicate_reactions:!1,cofactors:["atp","adp","nad","nadh","nadp","nadph","gtp","gdp","h","coa","ump","h20","ppi"],first_load_callback:null},{primary_metabolite_radius:!0,secondary_metabolite_radius:!0,marker_radius:!0,gene_font_size:!0,reaction_no_data_size:!0,metabolite_no_data_size:!0}),z.check_for_parent_tag(this.selection,"svg"))throw new Error("Builder cannot be placed within an svg node becuase UI elements are html-based.");var f=function(a,b){this.options[a]=b}.bind(this),g=function(a){return this.options[a]}.bind(this),h=["hide_secondary_metabolites","show_gene_reaction_rules","hide_all_labels","scroll_behavior","reaction_styles","reaction_compare_style","reaction_scale","reaction_no_data_color","reaction_no_data_size","and_method_in_gene_reaction_rule","metabolite_styles","metabolite_compare_style","metabolite_scale","metabolite_no_data_color","metabolite_no_data_size","identifiers_on_map","highlight_missing","allow_building_duplicate_reactions"];this.settings=new I(f,g,h),["reaction_scale","metabolite_scale"].forEach(function(a){this.settings.streams[a].onValue(function(b){["min","max"].forEach(function(c){var d=b.reduce(function(a,b){return a||b.type==c},!1);d||(b.push({type:c,color:"#ffffff",size:10}),this.settings.set_conditional(a,b))}.bind(this))}.bind(this))}.bind(this)),this.callback_manager=F(),null!==this.options.first_load_callback&&this.callback_manager.set("first_load",this.options.first_load_callback),this.load_model(this.model_data,!1),this.load_map(this.map_data,!1),this._update_data(!0,!0),this.settings.status_bus.onValue(function(a){if("accepted"===a){if(this._update_data(!0,!0,["reaction","metabolite"],!1),null!==this.zoom_container){var b=this.settings.get_option("scroll_behavior");this.zoom_container.set_scroll_behavior(b)}null!==this.map&&(this.map.draw_all_nodes(!1),this.map.draw_all_reactions(!0,!1),this.map.select_none())}}.bind(this)),this.callback_manager.run("first_load",this)}function e(a,b){void 0===b&&(b=!0),null===a?this.cobra_model=null:this.cobra_model=D.from_cobra_json(a),this.map&&(this.map.cobra_model=this.cobra_model,b&&this._update_data(!0,!1),this.settings.get_option("highlight_missing")&&this.map.draw_all_reactions(!1,!1)),this.callback_manager.run("load_model",null,a,b)}function f(a,b){O.isUndefined(b)&&(b=!0);z.remove_child_nodes(this.selection),this.zoom_container=new B(this.selection,this.options.scroll_behavior,this.options.use_3d_transform,this.options.fill_screen);var c=this.zoom_container.zoomed_sel,d=this.zoom_container.svg;this.map&&this.map.key_manager.toggle(!1),null!==a?this.map=C.from_data(a,d,this.embedded_css,c,this.zoom_container,this.settings,this.cobra_model,this.options.enable_search):this.map=new C(d,this.embedded_css,c,this.zoom_container,this.settings,this.cobra_model,null,this.options.enable_search),this.zoom_container.callback_manager.set("svg_start",function(){this.map.set_status("Drawing ...")}.bind(this)),this.zoom_container.callback_manager.set("svg_finish",function(){this.map.set_status("")}.bind(this)),b&&this._update_data(!1,!0),this.build_input=new A(this.selection,this.map,this.zoom_container,this.settings),this.text_edit_input=new K(this.selection,this.map,this.zoom_container),this.brush=new E(c,!1,this.map,".canvas-group"),this.map.canvas.callback_manager.set("resize",function(){this.brush.toggle(!0)}.bind(this)),this._setup_modes(this.map,this.brush,this.zoom_container);var e=this.selection.append("div").attr("class","search-menu-container").append("div").attr("class","search-menu-container-inline"),f=e.append("div"),g=e.append("div"),h=this.selection.append("div");this.search_bar=new H(g,this.map.search_index,this.map),this.search_bar.callback_manager.set("show",function(){this.settings_bar.toggle(!1)}.bind(this));var i=this.selection.append("div");this.settings_bar=new J(i,this.settings,this.map,function(a,b){var c=this.options[a+"_styles"];if(b&&-1==c.indexOf("abs"))c.push("abs");else if(!b){var d=c.indexOf("abs");-1!=d&&(this.options[a+"_styles"]=c.slice(0,d).concat(c.slice(d+1)))}this._update_data(!1,!0,a)}.bind(this)),this.settings_bar.callback_manager.set("show",function(){this.search_bar.toggle(!1)}.bind(this));var j=this._get_keys(this.map,this.zoom_container,this.search_bar,this.settings_bar,this.options.enable_editing,this.options.full_screen_button);if(this.map.key_manager.assigned_keys=j,this.map.key_manager.input_list=[this.build_input,this.search_bar,this.settings_bar,this.text_edit_input],this.map.key_manager.update(),this.map.key_manager.toggle(this.options.enable_keys),"all"===this.options.menu&&(this.options.ignore_bootstrap?console.error("Cannot create the dropdown menus if ignore_bootstrap = true"):this._set_up_menu(f,this.map,this.map.key_manager,j,this.options.enable_editing,this.options.enable_keys,this.options.full_screen_button)),this._set_up_button_panel(h,j,this.options.enable_editing,this.options.enable_keys,this.options.full_screen_button,this.options.menu,this.options.ignore_bootstrap),this.options.zoom_to_element){var k=this.options.zoom_to_element.type,l=this.options.zoom_to_element.id;if("undefined"==typeof k||-1==["reaction","node"].indexOf(k))throw new Error('zoom_to_element type must be "reaction" or "node"');if("undefined"==typeof l)throw new Error("zoom_to_element must include id");"reaction"==k?this.map.zoom_to_reaction(l):"node"==k&&this.map.zoom_to_node(l)}else if(null!==a)this.map.zoom_extent_canvas();else if(null!==this.options.starting_reaction&&null!==this.cobra_model){var m=this.zoom_container.get_size(),n={x:m.width/2,y:m.height/4};this.map.new_reaction_from_scratch(this.options.starting_reaction,n,90),this.map.zoom_extent_nodes()}else this.map.zoom_extent_canvas();this._setup_status(this.selection,this.map);this._setup_quick_jump(this.selection),this.options.enable_editing?this.zoom_mode():this.view_mode(),this.options.enable_editing&&this._setup_confirm_before_exit(),this.map.draw_everything()}function g(a){this.search_bar.toggle(!1),this.build_input.toggle("build"==a),this.build_input.direction_arrow.toggle("build"==a),"all"==this.options.menu&&this.options.enable_editing&&this._toggle_direction_buttons("build"==a),this.brush.toggle("brush"==a),this.zoom_container.toggle_pan_drag("zoom"==a||"view"==a),this.map.canvas.toggle_resize("zoom"==a||"brush"==a),"rotate"==a?(this.map.behavior.toggle_selectable_drag(!1),this.map.behavior.toggle_rotation_mode(!0)):(this.map.behavior.toggle_rotation_mode("rotate"==a),this.map.behavior.toggle_selectable_drag("brush"==a)),this.map.behavior.toggle_selectable_click("build"==a||"brush"==a),this.map.behavior.toggle_label_drag("brush"==a),this.map.behavior.toggle_label_mousedown("brush"==a),this.map.behavior.toggle_text_label_edit("text"==a),this.map.behavior.toggle_bezier_drag("brush"==a),("view"==a||"text"==a)&&this.map.select_none(),"rotate"==a&&this.map.deselect_text_labels(),this.map.draw_everything()}function h(){this.callback_manager.run("view_mode"),this._set_mode("view")}function i(){this.callback_manager.run("build_mode"),this._set_mode("build")}function j(){this.callback_manager.run("brush_mode"),this._set_mode("brush")}function k(){this.callback_manager.run("zoom_mode"),this._set_mode("zoom")}function l(){this.callback_manager.run("rotate_mode"),this._set_mode("rotate")}function m(){this.callback_manager.run("text_mode"),this._set_mode("text")}function n(a){this.options.reaction_data=a,this._update_data(!0,!0,"reaction"),this.map.set_status("")}function o(a,b){b&&this.settings.set_conditional("show_gene_reaction_rules",!1),this.options.gene_data=a,this._update_data(!0,!0,"reaction"),this.map.set_status("")}function p(a){this.options.metabolite_data=a,this._update_data(!0,!0,"metabolite"),this.map.set_status("")}function q(a,b,c,d){function e(a,b,c){var d={};return null!==b&&z.extend(d,b.reactions),null!==c&&z.extend(d,c.reactions,!0),M.import_and_check(a,"gene_data",d)}void 0===c&&(c=["reaction","metabolite"]),void 0===d&&(d=!0);var f,g,h,i=-1!=c.indexOf("metabolite"),j=-1!=c.indexOf("reaction");i&&b&&null!==this.map&&(f=M.import_and_check(this.options.metabolite_data,"metabolite_data"),this.map.apply_metabolite_data_to_map(f),d&&this.map.draw_all_nodes(!1)),j&&(null!==this.options.reaction_data&&b&&null!==this.map?(g=M.import_and_check(this.options.reaction_data,"reaction_data"),this.map.apply_reaction_data_to_map(g),d&&this.map.draw_all_reactions(!1,!1)):null!==this.options.gene_data&&b&&null!==this.map?(h=e(this.options.gene_data,this.cobra_model,this.map),this.map.apply_gene_data_to_map(h),d&&this.map.draw_all_reactions(!1,!1)):b&&null!==this.map&&(this.map.apply_reaction_data_to_map(null),d&&this.map.draw_all_reactions(!1,!1))),this.update_model_timer&&clearTimeout(this.update_model_timer);var k=5;this.update_model_timer=setTimeout(function(){i&&a&&null!==this.cobra_model&&(f||(f=M.import_and_check(this.options.metabolite_data,"metabolite_data")),this.cobra_model.apply_metabolite_data(f,this.options.metabolite_styles,this.options.metabolite_compare_style)),j&&(null!==this.options.reaction_data&&a&&null!==this.cobra_model?(g||(g=M.import_and_check(this.options.reaction_data,"reaction_data")),this.cobra_model.apply_reaction_data(g,this.options.reaction_styles,this.options.reaction_compare_style)):null!==this.options.gene_data&&a&&null!==this.cobra_model?(h||(h=e(this.options.gene_data,this.cobra_model,this.map)),this.cobra_model.apply_gene_data(h,this.options.reaction_styles,this.options.identifiers_on_map,this.options.reaction_compare_style,this.options.and_method_in_gene_reaction_rule)):a&&null!==this.cobra_model&&this.cobra_model.apply_reaction_data(null,this.options.reaction_styles,this.options.reaction_compare_style)),
this.callback_manager.run("update_data",null,a,b,c,d)}.bind(this),k)}function r(a,b,c,d,e,f,g,h){function i(a,b){function c(a){if(!("map_id"in a[0]&&"reactions"in a[1]&&"nodes"in a[1]&&"canvas"in a[1]))throw new Error("Bad map data.")}if(a)return console.warn(a),void this.map.set_status("Error loading map: "+a,2e3);try{c(b),this.load_map(b),this.map.set_status("Loaded map "+b[0].map_name,3e3)}catch(d){console.warn(d),this.map.set_status("Error loading map: "+d,2e3)}}function j(a,b){if(a)return console.warn(a),void this.map.set_status("Error loading model: "+a,2e3);try{this.load_model(b,!0),this.build_input.toggle(!1),"id"in b?this.map.set_status("Loaded model "+b.id,3e3):this.map.set_status("Loaded model (no model id)",3e3)}catch(c){console.warn(c),this.map.set_status("Error loading model: "+c,2e3)}}function k(a,b){return a?(console.warn(a),void this.map.set_status("Could not parse file as JSON or CSV",2e3)):(null!==b&&this.set_gene_data(null),void this.set_reaction_data(b))}function l(a,b){return a?(console.warn(a),void this.map.set_status("Could not parse file as JSON or CSV",2e3)):void this.set_metabolite_data(b)}function m(a,b){return a?(console.warn(a),void this.map.set_status("Could not parse file as JSON or CSV",2e3)):(null!==b&&this.set_reaction_data(null),this.settings.set_conditional("show_gene_reaction_rules",!0),void this.set_gene_data(b))}var n=a.attr("id","menu").append("ul").attr("class","nav nav-pills");G.dropdown_menu(n,"Map").button({key:d.save,text:"Save map JSON",key_text:f?" (Ctrl+S)":null}).button({text:"Load map JSON",key_text:f?" (Ctrl+O)":null,input:{assign:c.assigned_keys.load,key:"fn",fn:i.bind(this),pre_fn:function(){b.set_status("Loading map ...")},failure_fn:function(){b.set_status("")}}}).button({key:d.save_svg,text:"Export as SVG",key_text:f?" (Ctrl+Shift+S)":null}).button({key:d.save_png,text:"Export as PNG",key_text:f?" (Ctrl+Shift+P)":null}).button({key:d.clear_map,text:"Clear map"});var o=G.dropdown_menu(n,"Model").button({text:"Load COBRA model JSON",key_text:f?" (Ctrl+M)":null,input:{assign:c.assigned_keys.load_model,key:"fn",fn:j.bind(this),pre_fn:function(){b.set_status("Loading model ...")},failure_fn:function(){b.set_status("")}}}).button({id:"convert_map",key:d.convert_map,text:"Update names and gene reaction rules using model"}).button({id:"clear_model",key:d.clear_model,text:"Clear model"}),p=function(){o.dropdown.selectAll("li").classed("escher-disabled",function(a){return"clear_model"!=a.id&&"convert_map"!=a.id||null!==this.cobra_model?null:!0}.bind(this))}.bind(this);p(),this.callback_manager.set("load_model",p);var q=G.dropdown_menu(n,"Data").button({input:{assign:c.assigned_keys.load_reaction_data,key:"fn",fn:k.bind(this),accept_csv:!0,pre_fn:function(){b.set_status("Loading reaction data ...")},failure_fn:function(){b.set_status("")}},text:"Load reaction data"}).button({key:d.clear_reaction_data,text:"Clear reaction data"}).divider().button({input:{fn:m.bind(this),accept_csv:!0,pre_fn:function(){b.set_status("Loading gene data ...")},failure_fn:function(){b.set_status("")}},text:"Load gene data"}).button({key:d.clear_gene_data,text:"Clear gene data"}).divider().button({input:{fn:l.bind(this),accept_csv:!0,pre_fn:function(){b.set_status("Loading metabolite data ...")},failure_fn:function(){b.set_status("")}},text:"Load metabolite data"}).button({key:d.clear_metabolite_data,text:"Clear metabolite data"}),r=function(){q.dropdown.selectAll("li").classed("escher-disabled",function(a){return a?"Clear reaction data"==a.text&&null===this.options.reaction_data?!0:"Clear gene data"==a.text&&null===this.options.gene_data?!0:"Clear metabolite data"==a.text&&null===this.options.metabolite_data?!0:null:null}.bind(this))}.bind(this);r(),this.callback_manager.set("update_data",r);var s=G.dropdown_menu(n,"Edit",!0);e?s.button({key:d.zoom_mode,id:"zoom-mode-menu-button",text:"Pan mode",key_text:f?" (Z)":null}).button({key:d.brush_mode,id:"brush-mode-menu-button",text:"Select mode",key_text:f?" (V)":null}).button({key:d.build_mode,id:"build-mode-menu-button",text:"Add reaction mode",key_text:f?" (N)":null}).button({key:d.rotate_mode,id:"rotate-mode-menu-button",text:"Rotate mode",key_text:f?" (R)":null}).button({key:d.text_mode,id:"text-mode-menu-button",text:"Text mode",key_text:f?" (T)":null}).divider().button({key:d["delete"],text:"Delete",key_text:f?" (Del)":null}).button({key:d.undo,text:"Undo",key_text:f?" (Ctrl+Z)":null}).button({key:d.redo,text:"Redo",key_text:f?" (Ctrl+Shift+Z)":null}).button({key:d.toggle_primary,text:"Toggle primary/secondary",key_text:f?" (P)":null}).button({key:d.cycle_primary,text:"Rotate reactant locations",key_text:f?" (C)":null}).button({key:d.select_all,text:"Select all",key_text:f?" (Ctrl+A)":null}).button({key:d.select_none,text:"Select none",key_text:f?" (Ctrl+Shift+A)":null}).button({key:d.invert_selection,text:"Invert selection"}):s.button({key:d.view_mode,id:"view-mode-menu-button",text:"View mode"});var t=G.dropdown_menu(n,"View",!0).button({key:d.zoom_in,text:"Zoom in",key_text:f?" (Ctrl and +)":null}).button({key:d.zoom_out,text:"Zoom out",key_text:f?" (Ctrl and -)":null}).button({key:d.extent_nodes,text:"Zoom to nodes",key_text:f?" (Ctrl+0)":null}).button({key:d.extent_canvas,text:"Zoom to canvas",key_text:f?" (Ctrl+1)":null}).button({key:d.search,text:"Find",key_text:f?" (Ctrl+F)":null});g&&t.button({key:d.full_screen,text:"Full screen",key_text:f?" (Ctrl+2)":null}),e&&(t.button({key:d.toggle_beziers,id:"bezier-button",text:"Show control points",key_text:f?" (B)":null}),b.callback_manager.set("toggle_beziers.button",function(a){n.select("#bezier-button").select(".dropdown-button-text").text((a?"Hide":"Show")+" control points"+(f?" (B)":""))})),t.divider().button({key:d.show_settings,text:"Settings",key_text:f?" (Ctrl+,)":null}),n.append("a").attr("class","help-button").attr("target","#").attr("href","https://escher.readthedocs.org").text("?");var u=function(a){$(this.selection.node()).find("#"+a).button("toggle");var b=["zoom-mode-menu-button","brush-mode-menu-button","build-mode-menu-button","rotate-mode-menu-button","view-mode-menu-button","text-mode-menu-button"];b.forEach(function(b){var c=b.replace("-menu","");this.selection.select("#"+b).select("span").classed("glyphicon",c==a).classed("glyphicon-ok",c==a)}.bind(this))};this.callback_manager.set("zoom_mode",u.bind(this,"zoom-mode-button")),this.callback_manager.set("brush_mode",u.bind(this,"brush-mode-button")),this.callback_manager.set("build_mode",u.bind(this,"build-mode-button")),this.callback_manager.set("rotate_mode",u.bind(this,"rotate-mode-button")),this.callback_manager.set("view_mode",u.bind(this,"view-mode-button")),this.callback_manager.set("text_mode",u.bind(this,"text-mode-button"))}function s(a,b,c,d,e,f,g){var h=a.append("ul").attr("class","nav nav-pills nav-stacked").attr("id","button-panel");if(G.individual_button(h.append("li"),{key:b.zoom_in,text:"+",icon:"glyphicon glyphicon-plus-sign",tooltip:"Zoom in",key_text:d?" (Ctrl and +)":null,ignore_bootstrap:g}),G.individual_button(h.append("li"),{key:b.zoom_out,text:"–",icon:"glyphicon glyphicon-minus-sign",tooltip:"Zoom out",key_text:d?" (Ctrl and -)":null,ignore_bootstrap:g}),G.individual_button(h.append("li"),{key:b.extent_canvas,text:"↔",icon:"glyphicon glyphicon-resize-full",tooltip:"Zoom to canvas",key_text:d?" (Ctrl+1)":null,ignore_bootstrap:g}),e&&G.individual_button(h.append("li"),{key:b.full_screen,text:"▣",icon:"glyphicon glyphicon-fullscreen",tooltip:"Full screen",key_text:d?" (Ctrl+2)":null,ignore_bootstrap:g}),c&&"all"===f){G.radio_button_group(h.append("li")).button({key:b.zoom_mode,id:"zoom-mode-button",text:"Z",icon:"glyphicon glyphicon-move",tooltip:"Pan mode",key_text:d?" (Z)":null,ignore_bootstrap:g}).button({key:b.brush_mode,text:"V",id:"brush-mode-button",icon:"glyphicon glyphicon-hand-up",tooltip:"Select mode",key_text:d?" (V)":null,ignore_bootstrap:g}).button({key:b.build_mode,text:"N",id:"build-mode-button",icon:"glyphicon glyphicon-plus",tooltip:"Add reaction mode",key_text:d?" (N)":null,ignore_bootstrap:g}).button({key:b.rotate_mode,text:"R",id:"rotate-mode-button",icon:"glyphicon glyphicon-repeat",tooltip:"Rotate mode",key_text:d?" (R)":null,ignore_bootstrap:g}).button({key:b.text_mode,text:"T",id:"text-mode-button",icon:"glyphicon glyphicon-font",tooltip:"Text mode",key_text:d?" (T)":null,ignore_bootstrap:g}),this.direction_buttons=h.append("li");G.button_group(this.direction_buttons).button({key:b.direction_arrow_left,text:"←",icon:"glyphicon glyphicon-arrow-left",tooltip:"Direction arrow (←)",ignore_bootstrap:g}).button({key:b.direction_arrow_right,text:"→",icon:"glyphicon glyphicon-arrow-right",tooltip:"Direction arrow (→)",ignore_bootstrap:g}).button({key:b.direction_arrow_up,text:"↑",icon:"glyphicon glyphicon-arrow-up",tooltip:"Direction arrow (↑)",ignore_bootstrap:g}).button({key:b.direction_arrow_down,text:"↓",icon:"glyphicon glyphicon-arrow-down",tooltip:"Direction arrow (↓)",ignore_bootstrap:g})}}function t(a){O.isUndefined(a)&&(a="block"===!this.direction_buttons.style("display")),this.direction_buttons.style("display",a?"block":"none")}function u(a,b){var c=a.append("div").attr("id","status");return b.callback_manager.set("set_status",function(a){c.html(a)}),c}function v(a){var b=function(a,b,c){if(this.options.enable_editing&&!this.options.never_ask_before_quit&&!confirm("You will lose any unsaved changes.\n\nAre you sure you want to switch maps?"))return void(c&&c(!1));this.map.set_status("Loading map "+a+" ...");var d=z.name_to_url(a,b);d3.json(d,function(a,b){return a?(console.warn("Could not load data: "+a),this.map.set_status("Could not load map",2e3),void(c&&c(!1))):(c&&c(!0),this.load_map(b),void this.map.set_status(""))}.bind(this))}.bind(this);this.quick_jump=L(a,b)}function w(a,b,c){var d={};a.callback_manager.set("start_rotation",function(){d.brush=b.enabled,b.toggle(!1),d.zoom=c.zoom_on,c.toggle_pan_drag(!1),d.selectable_mousedown=null!=a.behavior.selectable_mousedown,a.behavior.toggle_selectable_click(!1),d.label_mousedown=null!=a.behavior.label_mousedown,a.behavior.toggle_label_mousedown(!1)}),a.callback_manager.set("end_rotation",function(){b.toggle(d.brush),c.toggle_pan_drag(d.zoom),a.behavior.toggle_selectable_click(d.selectable_mousedown),a.behavior.toggle_label_mousedown(d.label_mousedown),d={}})}function x(a,b,c,d,e,f){var g={save:{key:"ctrl+s",target:a,fn:a.save},save_svg:{key:"ctrl+shift+s",target:a,fn:a.save_svg},save_png:{key:"ctrl+shift+p",target:a,fn:a.save_png},load:{key:"ctrl+o",fn:null},convert_map:{target:a,fn:a.convert_map},clear_map:{target:a,fn:a.clear_map},load_model:{key:"ctrl+m",fn:null},clear_model:{fn:this.load_model.bind(this,null,!0)},load_reaction_data:{fn:null},clear_reaction_data:{target:this,fn:function(){this.set_reaction_data(null)}},load_metabolite_data:{fn:null},clear_metabolite_data:{target:this,fn:function(){this.set_metabolite_data(null)}},load_gene_data:{fn:null},clear_gene_data:{target:this,fn:function(){this.set_gene_data(null,!0)}},zoom_in:{key:"ctrl+=",target:b,fn:b.zoom_in},zoom_out:{key:"ctrl+-",target:b,fn:b.zoom_out},extent_nodes:{key:"ctrl+0",target:a,fn:a.zoom_extent_nodes},extent_canvas:{key:"ctrl+1",target:a,fn:a.zoom_extent_canvas},search:{key:"ctrl+f",fn:c.toggle.bind(c,!0)},view_mode:{target:this,fn:this.view_mode,ignore_with_input:!0},show_settings:{key:"ctrl+,",target:d,fn:d.toggle}};return f&&z.extend(g,{full_screen:{key:"ctrl+2",target:a,fn:a.full_screen}}),e&&z.extend(g,{build_mode:{key:"n",target:this,fn:this.build_mode,ignore_with_input:!0},zoom_mode:{key:"z",target:this,fn:this.zoom_mode,ignore_with_input:!0},brush_mode:{key:"v",target:this,fn:this.brush_mode,ignore_with_input:!0},rotate_mode:{key:"r",target:this,fn:this.rotate_mode,ignore_with_input:!0},text_mode:{key:"t",target:this,fn:this.text_mode,ignore_with_input:!0},toggle_beziers:{key:"b",target:a,fn:a.toggle_beziers,ignore_with_input:!0},"delete":{key:"ctrl+backspace",target:a,fn:a.delete_selected,ignore_with_input:!0},delete_del:{key:"del",target:a,fn:a.delete_selected,ignore_with_input:!0},toggle_primary:{key:"p",target:a,fn:a.toggle_selected_node_primary,ignore_with_input:!0},cycle_primary:{key:"c",target:a,fn:a.cycle_primary_node,ignore_with_input:!0},direction_arrow_right:{key:"right",target:this.build_input.direction_arrow,fn:this.build_input.direction_arrow.right,ignore_with_input:!0},direction_arrow_down:{key:"down",target:this.build_input.direction_arrow,fn:this.build_input.direction_arrow.down,ignore_with_input:!0},direction_arrow_left:{key:"left",target:this.build_input.direction_arrow,fn:this.build_input.direction_arrow.left,ignore_with_input:!0},direction_arrow_up:{key:"up",target:this.build_input.direction_arrow,fn:this.build_input.direction_arrow.up,ignore_with_input:!0},undo:{key:"ctrl+z",target:a.undo_stack,fn:a.undo_stack.undo},redo:{key:"ctrl+shift+z",target:a.undo_stack,fn:a.undo_stack.redo},select_all:{key:"ctrl+a",target:a,fn:a.select_all},select_none:{key:"ctrl+shift+a",target:a,fn:a.select_none},invert_selection:{target:a,fn:a.invert_selection}}),g}function y(){window.onbeforeunload=function(a){return a=a||window.event,this.options.never_ask_before_quit?null:"You will lose any unsaved changes."}.bind(this)}var z=a("./utils"),A=a("./BuildInput"),B=a("./ZoomContainer"),C=a("./Map"),D=a("./CobraModel"),E=a("./Brush"),F=a("./CallbackManager"),G=a("./ui"),H=a("./SearchBar"),I=a("./Settings"),J=a("./SettingsMenu"),K=a("./TextEditInput"),L=a("./QuickJump"),M=a("./data_styles"),N=a("./inline").builder_embed,O=a("underscore"),P=z.make_class();P.prototype={init:d,load_map:f,load_model:e,_set_mode:g,view_mode:h,build_mode:i,brush_mode:j,zoom_mode:k,rotate_mode:l,text_mode:m,set_reaction_data:n,set_metabolite_data:p,set_gene_data:o,_update_data:q,_toggle_direction_buttons:t,_set_up_menu:r,_set_up_button_panel:s,_setup_status:u,_setup_quick_jump:v,_setup_modes:w,_get_keys:x,_setup_confirm_before_exit:y},b.exports=P},{"./Brush":2,"./BuildInput":3,"./CallbackManager":5,"./CobraModel":7,"./Map":12,"./QuickJump":14,"./SearchBar":17,"./Settings":19,"./SettingsMenu":20,"./TextEditInput":21,"./ZoomContainer":23,"./data_styles":26,"./inline":27,"./ui":30,"./utils":31,underscore:35}],5:[function(a,b,c){function d(){}function e(a,b){return void 0===this.callbacks&&(this.callbacks={}),void 0===this.callbacks[a]&&(this.callbacks[a]=[]),this.callbacks[a].push(b),this}function f(a){return(void 0===this.callbacks||0==Object.keys(this.callbacks).length)&&console.warn("No callbacks to remove"),delete this.callbacks[a],this}function g(a,b){if(i.isUndefined(this.callbacks))return this;i.isUndefined(b)&&(b=null);var c=Array.prototype.slice.call(arguments,2);for(var d in this.callbacks){var e=d.split(".")[0];e==a&&this.callbacks[d].forEach(function(a){a.apply(b,c)})}return this}var h=a("./utils"),i=a("underscore"),j=h.make_class();j.prototype={init:d,set:e,remove:f,run:g},b.exports=j},{"./utils":31,underscore:35}],6:[function(a,b,c){function d(a,b){this.selection=a,this.x=b.x,this.y=b.y,this.width=b.width,this.height=b.height,this.resize_enabled=!0,this.callback_manager=new i,this.setup()}function e(a){void 0===a&&(a=!this.resize_enabled),a?this.selection.selectAll(".drag-rect").style("pointer-events","auto"):this.selection.selectAll(".drag-rect").style("pointer-events","none")}function f(){function a(){d3.event.sourceEvent.stopPropagation()}function b(a,b,c){var d=h.d3_transform_catch(c),e=d.translate;return null!==a&&(e[0]=a),null!==b&&(e[1]=b),"translate("+e+")"}function c(a){var c=a.x;a.x=Math.min(a.x+g.width-i/2,d3.event.x),g.x=a.x,g.width=g.width+(c-a.x),r.attr("transform",function(a){return b(a.x-i/2,null,r.attr("transform"))}),l.attr("transform",function(a){return b(a.x,null,l.attr("transform"))}).attr("width",g.width*j),m.attr("transform",function(a){return b(a.x,null,m.attr("transform"))}).attr("width",g.width),t.attr("transform",function(a){return b(a.x+i/2,null,t.attr("transform"))}).attr("width",g.width-i),u.attr("transform",function(a){return b(a.x+i/2,null,u.attr("transform"))}).attr("width",g.width-i),g.callback_manager.run("resize")}function d(a){d3.event.sourceEvent.stopPropagation();var c=Math.max(a.x+i/2,a.x+g.width+d3.event.dx);g.width=c-a.x,s.attr("transform",function(a){return b(c-i/2,null,s.attr("transform"))}),l.attr("width",g.width*j),m.attr("width",g.width),t.attr("width",g.width-i),u.attr("width",g.width-i),g.callback_manager.run("resize")}function e(a){d3.event.sourceEvent.stopPropagation();var c=a.y;a.y=Math.min(a.y+g.height-i/2,d3.event.y),g.y=a.y,g.height=g.height+(c-a.y),t.attr("transform",function(a){return b(null,a.y-i/2,t.attr("transform"))}),l.attr("transform",function(a){return b(null,a.y,l.attr("transform"))}).attr("width",g.height*j),m.attr("transform",function(a){return b(null,a.y,m.attr("transform"))}).attr("height",g.height),r.attr("transform",function(a){return b(null,a.y+i/2,r.attr("transform"))}).attr("height",g.height-i),s.attr("transform",function(a){return b(null,a.y+i/2,s.attr("transform"))}).attr("height",g.height-i),g.callback_manager.run("resize")}function f(a){d3.event.sourceEvent.stopPropagation();var c=Math.max(a.y+i/2,a.y+g.height+d3.event.dy);g.height=c-a.y,u.attr("transform",function(a){return b(null,c-i/2,u.attr("transform"))}),l.attr("height",g.height*j),m.attr("height",g.height),r.attr("height",g.height-i),s.attr("height",g.height-i),g.callback_manager.run("resize")}var g=this,i=({x:this.width,y:this.height},100),j=10,k=this.selection.append("g").classed("canvas-group",!0).data([{x:this.x,y:this.y}]),l=k.append("rect").attr("id","mouse-node").attr("width",this.width*j).attr("height",this.height*j).attr("transform","translate("+[g.x-this.width*j/2,g.y-this.height*j/2]+")").attr("pointer-events","all");this.mouse_node=l;var m=k.append("rect").attr("id","canvas").attr("width",this.width).attr("height",this.height).attr("transform","translate("+[g.x,g.y]+")"),n=d3.behavior.drag().origin(Object).on("dragstart",a).on("drag",d),o=d3.behavior.drag().origin(Object).on("dragstart",a).on("drag",c),p=d3.behavior.drag().origin(Object).on("dragstart",a).on("drag",e),q=d3.behavior.drag().origin(Object).on("dragstart",a).on("drag",f),r=k.append("rect").classed("drag-rect",!0).attr("transform",function(a){return"translate("+[a.x-i/2,a.y+i/2]+")"}).attr("height",this.height-i).attr("id","dragleft").attr("width",i).attr("cursor","ew-resize").classed("resize-rect",!0).call(o),s=k.append("rect").classed("drag-rect",!0).attr("transform",function(a){return"translate("+[a.x+g.width-i/2,a.y+i/2]+")"}).attr("id","dragright").attr("height",this.height-i).attr("width",i).attr("cursor","ew-resize").classed("resize-rect",!0).call(n),t=k.append("rect").classed("drag-rect",!0).attr("transform",function(a){return"translate("+[a.x+i/2,a.y-i/2]+")"}).attr("height",i).attr("id","dragtop").attr("width",this.width-i).attr("cursor","ns-resize").classed("resize-rect",!0).call(p),u=k.append("rect").classed("drag-rect",!0).attr("transform",function(a){return"translate("+[a.x+i/2,a.y+g.height-i/2]+")"}).attr("id","dragbottom").attr("height",i).attr("width",this.width-i).attr("cursor","ns-resize").classed("resize-rect",!0).call(q)}function g(){return{x:this.x,y:this.y,width:this.width,height:this.height}}var h=a("./utils"),i=a("./CallbackManager"),j=h.make_class();j.prototype={init:d,toggle_resize:e,setup:f,size_and_location:g},b.exports=j},{"./CallbackManager":5,"./utils":31}],7:[function(a,b,c){function d(a,b){var c=function(a){return 1==a?"":String(a)+" "},d=[],e=[];for(var f in a){var g=a[f];g>0?e.push(c(g)+f):d.push(c(Math.abs(g))+f)}var h=d.join(" + ");return h+=b?" ↔ ":" → ",h+=e.join(" + ")}function e(a){if(!a.reactions||!a.metabolites)throw new Error("Bad model data.");var b=new n;return b.reactions=a.reactions,b.metabolites=a.metabolites,b}function f(a){if(!a.reactions||!a.metabolites)throw new Error("Bad model data.");for(var b={},c=0,d=a.genes.length;d>c;c++){var e=a.genes[c],f=e.id;b[f]=e}var g=new n;g.reactions={};for(var c=0,d=a.reactions.length;d>c;c++){var e=a.reactions[c],f=e.id,h=l.clone(e);if(delete h.id,h.bigg_id=f,h.genes=[],h.reversibility=h.lower_bound<0&&h.upper_bound>0,h.upper_bound<=0&&h.lower_bound<0)for(var i in h.metabolites)h.metabolites[i]=-h.metabolites[i];if(delete h.lower_bound,delete h.upper_bound,"gene_reaction_rule"in h){var j=m.genes_for_gene_reaction_rule(h.gene_reaction_rule);j.forEach(function(a){if(a in b){var c=l.clone(b[a]);c.bigg_id=c.id,delete c.id,h.genes.push(c)}else console.warn("Could not find gene for gene_id "+a)})}g.reactions[f]=h}g.metabolites={};for(var c=0,d=a.metabolites.length;d>c;c++){var e=a.metabolites[c],f=e.id,k=l.clone(e);delete k.id,k.bigg_id=f,g.metabolites[f]=k}return g}function g(){this.reactions={},this.metabolites={}}function h(a,b,c){m.apply_reaction_data_to_reactions(this.reactions,a,b,c)}function i(a,b,c){m.apply_metabolite_data_to_nodes(this.metabolites,a,b,c)}function j(a,b,c,d,e){m.apply_gene_data_to_reactions(this.reactions,a,b,c,d,e)}function k(){return{reactions:this.reactions,metabolites:this.metabolites}}var l=a("./utils"),m=a("./data_styles"),n=l.make_class();n.from_exported_data=e,n.from_cobra_json=f,n.build_reaction_string=d,n.prototype={init:g,apply_reaction_data:h,apply_metabolite_data:i,apply_gene_data:j,model_for_export:k},b.exports=n},{"./data_styles":26,"./utils":31}],8:[function(a,b,c){var d=a("./utils");b.exports=function(a){function b(a,b,d,f,g){d.node().addEventListener("change",function(){c(a,this.value,g,f)},!1);var h=b[0];e(b,d),c(a,h,g,f)}function c(a,b,c,e){d.load_the_file(a,b,function(a,b){return a?console.warn(a):(f.data=b,void(e&&e(b)))})}function e(a,b){b.selectAll(".menu-option").data(a).enter().append("option").attr("value",function(a){return a}).text(function(a){return a}),b.node().focus()}var f=d.set_options(a,{selection:null,getdatafiles:null,datafiles:null,update_callback:null,target:null});if(null===f.selection)throw new Error("No selection provided for DataMenu");var g=f.selection.select(".data-menu");g.empty()&&(g=f.selection.append("div").attr("class","data-menu"));var h=g.append("form").append("select").attr("class","dropdown-menu");return f.getdatafiles?(f.datafiles&&console.warn("DataMenu: getdatafiles option overrides datafiles"),d3.json(f.getdatafiles,function(a,c){return a?console.warn(a):(b(f.target,c.data,h,f.update_callback,f.selection),null)})):f.datafiles?b(f.target,f.datafiles,h,f.update_callback,f.selection):console.warn("DataMenu: No datafiles given"),{update:e}}},{"./utils":31}],9:[function(a,b,c){function d(a){function b(){return"M0 -5 L0 5 L20 5 L20 10 L30 0 L20 -10 L20 -5 Z"}this.arrow_container=a.append("g").attr("id","direction-arrow-container").attr("transform","translate(0,0)rotate(0)"),this.arrow=this.arrow_container.append("path").classed("direction-arrow",!0).attr("d",b()).style("visibility","hidden").attr("transform","translate(30,0)scale(2.5)"),this.sel=a,this.center={x:0,y:0},this._setup_drag(),this.dragging=!1,this.is_visible=!1,this.show()}function e(a){this.center=a;var b=q.d3_transform_catch(this.arrow_container.attr("transform"));this.arrow_container.attr("transform","translate("+a.x+","+a.y+")rotate("+b.rotate+")")}function f(a){var b=q.d3_transform_catch(this.arrow_container.attr("transform"));this.arrow_container.attr("transform","translate("+b.translate+")rotate("+a+")")}function g(a){var b=q.d3_transform_catch(this.arrow_container.attr("transform"));this.arrow_container.attr("transform","translate("+b.translate+")rotate("+(b.rotate+a)+")")}function h(){return q.d3_transform_catch(this.arrow_container.attr("transform")).rotate}function i(a){void 0===a?this.is_visible=!this.is_visible:this.is_visible=a,this.arrow.style("visibility",this.is_visible?"visible":"hidden")}function j(){this.toggle(!0)}function k(){this.toggle(!1)}function l(){this.set_rotation(0)}function m(){this.set_rotation(90)}function n(){this.set_rotation(180)}function o(){this.set_rotation(270)}function p(){var a=d3.behavior.drag().on("dragstart",function(a){d3.event.sourceEvent.stopPropagation(),this.dragging=!0}.bind(this)).on("drag.direction_arrow",function(a){var b={x:d3.event.dx,y:d3.event.dy},c={x:d3.mouse(this.sel.node())[0],y:d3.mouse(this.sel.node())[1]},d=q.angle_for_event(b,c,this.center);this.displace_rotation(q.to_degrees(d))}.bind(this)).on("dragend",function(a){setTimeout(function(){this.dragging=!1}.bind(this),200)}.bind(this));this.arrow_container.call(a)}var q=a("./utils"),r=q.make_class();r.prototype={init:d,set_location:e,set_rotation:f,displace_rotation:g,get_rotation:h,toggle:i,show:j,hide:k,right:l,left:n,up:o,down:m,_setup_drag:p},b.exports=r},{"./utils":31}],10:[function(a,b,c){function d(a,b){this.behavior=a,this.settings=b,this.callback_manager=new v}function e(a){a.append("rect").attr("class","membrane"),this.callback_manager.run("create_membrane",this,a)}function f(a){a.attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("stroke-width",function(a){return 10}).attr("rx",function(a){return 20}).attr("ry",function(a){return 20}),this.callback_manager.run("update_membrane",this,a)}function g(a){a.append("g").attr("id",function(a){return"r"+a.reaction_id}).attr("class","reaction").call(this.create_reaction_label.bind(this)),this.callback_manager.run("create_reaction",this,a)}function h(a,b,c,d,e,f){a.select(".reaction-label-group").call(function(a){return this.update_reaction_label(a,f)}.bind(this)),t.draw_a_nested_object(a,".segment-group","segments","segment_id",this.create_segment.bind(this),function(a){return this.update_segment(a,b,c,d,e,f)}.bind(this),function(a){a.remove()}),this.callback_manager.run("update_reaction",this,a)}function i(a){var b=a.append("g").attr("class","reaction-label-group");b.append("title"),b.append("text").attr("class","reaction-label label"),b.append("g").attr("class","all-genes-label-group"),this.callback_manager.run("create_reaction_label",this,a)}function j(a,b){var c=(d3.format(".4g"),this.settings.get_option("identifiers_on_map")),d="bigg_id"==c?"name":"bigg_id",e=this.settings.get_option("reaction_styles"),f=this.settings.get_option("show_gene_reaction_rules"),g=this.settings.get_option("hide_all_labels"),h=this.settings.get_option("gene_font_size"),i=this.behavior.label_mousedown,j=this.behavior.label_mouseover,k=this.behavior.label_mouseout;a.attr("transform",function(a){return"translate("+a.label_x+","+a.label_y+")"}).call(this.behavior.turn_off_drag).call(this.behavior.reaction_label_drag);var l=a.select(".reaction-label").attr("visibility",g?"hidden":"visible");g||(l.text(function(a){var d=a[c];return b&&-1!=e.indexOf("text")&&(d+=" "+a.data_string),d}).on("mousedown",i).on("mouseover",j).on("mouseout",k),a.select("title").text(function(a){return a[d]}));var m=a.select(".all-genes-label-group").selectAll(".gene-label-group").data(function(a){var b="gene_string"in a&&null!==a.gene_string&&f&&!g&&-1!==e.indexOf("text"),d="gene_reaction_rule"in a&&null!==a.gene_reaction_rule&&f&&!g;return b?a.gene_string:d?u.gene_string_for_data(a.gene_reaction_rule,null,a.genes,null,c,null):[]}),n=m.enter().append("g").attr("class","gene-label-group");n.append("text").attr("class","gene-label").style("font-size",h+"px"),n.append("title"),m.attr("transform",function(a,b){return"translate(0, "+1.5*h*(b+1)+")"}),m.select("text").text(function(a){return a.text}),m.select("title").text(function(a){return a[d]}),m.exit().remove(),this.callback_manager.run("update_reaction_label",this,a)}function k(a){var b=a.append("g").attr("class","segment-group").attr("id",function(a){return"s"+a.segment_id});b.append("path").attr("class","segment"),b.append("g").attr("class","arrowheads"),b.append("g").attr("class","stoichiometry-labels"),this.callback_manager.run("create_segment",this,a)}function l(a,b,c,d,e,f){var g=this.settings.get_option("reaction_styles"),h=f&&-1!=g.indexOf("size"),i=f&&-1!=g.indexOf("color"),j=this.settings.get_option("reaction_no_data_size"),k=this.settings.get_option("reaction_no_data_color"),l=this.settings.get_option("highlight_missing"),m=this.settings.get_option("hide_secondary_metabolites"),n=this.settings.get_option("primary_metabolite_radius"),o=this.settings.get_option("secondary_metabolite_radius"),p=function(a,c){var d=20,e=13;return c&&(e=null===a?j:b.reaction_size(a),isNaN(e)&&(e=j),d=2*e),{width:d,height:e}},q=function(a,b,c,d){var e=b||c>0?a.height:0,f=d?n:o;return f+e+10};a.selectAll(".segment").datum(function(){return this.parentNode.__data__}).style("visibility",function(a){var b=d[a.from_node_id],c=d[a.to_node_id];return m&&("metabolite"==c.node_type&&!c.node_is_primary||"metabolite"==b.node_type&&!b.node_is_primary)?"hidden":null}).attr("d",function(a){if(null===a.from_node_id||null===a.to_node_id)return null;var b=d[a.from_node_id],c=d[a.to_node_id],e=a.b1,f=a.b2;if("metabolite"==b.node_type){var g=p(a.data,h),i=q(g,a.reversibility,a.from_node_coefficient,b.node_is_primary),j=null===e?c:e;b=s(i,b,j,"start")}if("metabolite"==c.node_type){var g=p(a.data,h),i=q(g,a.reversibility,a.to_node_coefficient,c.node_is_primary),j=null===f?b:f;c=s(i,j,c,"end")}var k="M"+b.x+","+b.y+" ";return null!==e&&null!==f&&(k+="C"+e.x+","+e.y+" "+f.x+","+f.y+" "),k+=c.x+","+c.y}).style("stroke",function(a){var d=this.parentNode.parentNode.__data__.bigg_id,e=l&&null!==c&&!(d in c.reactions);if(e)return"red";if(i){var f=a.data;return null===f?k:b.reaction_color(f)}return null}).style("stroke-width",function(a){if(h){var c=a.data;return null===c?j:b.reaction_size(c)}return null});var r=a.select(".arrowheads").selectAll(".arrowhead").data(function(a){var b=[],c=d[a.from_node_id],e=a.b1,f=d[a.to_node_id],g=a.b2;if(m&&("metabolite"==f.node_type&&!f.node_is_primary||"metabolite"==c.node_type&&!c.node_is_primary))return b;if("metabolite"==c.node_type&&(a.reversibility||a.from_node_coefficient>0)){var i=p(a.data,h),j=q(i,a.reversibility,a.from_node_coefficient,c.node_is_primary),k=null===e?f:e,l=t.to_degrees(t.get_angle([c,k]))+90,n=s(j,c,k,"start");b.push({data:a.data,x:n.x,y:n.y,size:i,rotation:l,show_arrowhead_flux:a.from_node_coefficient<0==a.reverse_flux||0==a.data})}if("metabolite"==f.node_type&&(a.reversibility||a.to_node_coefficient>0)){var i=p(a.data,h),j=q(i,a.reversibility,a.to_node_coefficient,f.node_is_primary),k=null===g?c:g,l=t.to_degrees(t.get_angle([f,k]))+90,n=s(j,k,f,"end");b.push({data:a.data,x:n.x,y:n.y,size:i,rotation:l,show_arrowhead_flux:a.to_node_coefficient<0==a.reverse_flux||0==a.data})}return b});r.enter().append("path").classed("arrowhead",!0),r.attr("d",function(a){return"M"+[-a.size.width/2,0]+" L"+[0,a.size.height]+" L"+[a.size.width/2,0]+" Z"}).attr("transform",function(a){return"translate("+a.x+","+a.y+")rotate("+a.rotation+")"}).style("fill",function(a){if(i){if(a.show_arrowhead_flux){var c=a.data;return null===c?k:b.reaction_color(c)}return"#FFFFFF"}return null}).style("stroke",function(a){if(i){var c=a.data;return null===c?k:b.reaction_color(c)}return null}),r.exit().remove();var u=a.select(".stoichiometry-labels").selectAll(".stoichiometry-label").data(function(a){var b=[],c=d[a.from_node_id],e=a.b1,f=d[a.to_node_id],g=a.b2,i=1.5;if(m&&("metabolite"==f.node_type&&!f.node_is_primary||"metabolite"==c.node_type&&!c.node_is_primary))return b;if("metabolite"==c.node_type&&1!=Math.abs(a.from_node_coefficient)){var j=p(a.data,h),k=i*q(j,!1,0,f.node_is_primary),l=null===e?f:e;l=t.c_plus_c(l,t.rotate_coords(l,.5,c));var n=s(k,c,l,"start");n=t.c_plus_c(n,{x:0,y:7}),b.push({coefficient:Math.abs(a.from_node_coefficient),x:n.x,y:n.y,data:a.data})}if("metabolite"==f.node_type&&1!=Math.abs(a.to_node_coefficient)){var j=p(a.data,h),k=i*q(j,!1,0,f.node_is_primary),l=null===g?c:g;l=t.c_plus_c(l,t.rotate_coords(l,.5,f));var n=s(k,l,f,"end");n=t.c_plus_c(n,{x:0,y:7}),b.push({coefficient:Math.abs(a.to_node_coefficient),x:n.x,y:n.y,data:a.data})}return b});u.enter().append("text").attr("class","stoichiometry-label").attr("text-anchor","middle"),
u.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).text(function(a){return a.coefficient}).style("fill",function(a){if(i){var c=a.data;return null===c?k:b.reaction_color(c)}return null}),u.exit().remove(),this.callback_manager.run("update_segment",this,a)}function m(a){var b=a.append("g").attr("id",function(a){return a.bezier_id}).attr("class",function(a){return"bezier"});b.append("path").attr("class","connect-line"),b.append("circle").attr("class",function(a){return"bezier-circle "+a.bezier}).style("stroke-width",String(1)+"px").attr("r",String(7)+"px"),this.callback_manager.run("create_bezier",this,a)}function n(a,b,c,d,e,f,g){var h=this.settings.get_option("hide_secondary_metabolites");return b?(a.attr("visibility","visible"),a.style("visibility",function(a){var b=g[a.reaction_id].segments[a.segment_id],c=f[b.from_node_id],d=f[b.to_node_id];return h&&("metabolite"==d.node_type&&!d.node_is_primary||"metabolite"==c.node_type&&!c.node_is_primary)?"hidden":null}),a.select(".bezier-circle").call(this.behavior.turn_off_drag).call(c).on("mouseover",d).on("mouseout",e).attr("transform",function(a){return null==a.x||null==a.y?"":"translate("+a.x+","+a.y+")"}),a.select(".connect-line").attr("d",function(a){var b,c=g[a.reaction_id].segments[a.segment_id];return b="b1"==a.bezier?f[c.from_node_id]:f[c.to_node_id],null==a.x||null==a.y||null==b.x||null==b.y?"":"M"+a.x+", "+a.y+" "+b.x+","+b.y}),void this.callback_manager.run("update_bezier",this,a)):void a.attr("visibility","hidden")}function o(a,b,c){var d=a.append("g").attr("class","node").attr("id",function(a){return"n"+a.node_id});d.append("circle").attr("class",function(a){var b="node-circle";return null!==a.node_type&&(b+=" "+a.node_type+"-circle"),b});var e=d.filter(function(a){return"metabolite"==a.node_type});e.append("text").attr("class","node-label label"),e.append("title"),this.callback_manager.run("create_node",this,a)}function p(a,b,c,d,e,f,g,h,i){function j(a,b){return"metabolite"===a.node_type&&b&&!a.node_is_primary}var k=this.settings.get_option("hide_secondary_metabolites"),l=this.settings.get_option("primary_metabolite_radius"),m=this.settings.get_option("secondary_metabolite_radius"),n=this.settings.get_option("marker_radius"),o=this.settings.get_option("hide_all_labels"),p=this.settings.get_option("identifiers_on_map"),q="bigg_id"===p?"name":"bigg_id",r=this.settings.get_option("metabolite_styles"),s={color:this.settings.get_option("metabolite_no_data_color"),size:this.settings.get_option("metabolite_no_data_size")},t=(a.select(".node-circle").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("visibility",function(a){return j(a,k)?"hidden":null}).attr("r",function(a){if("metabolite"===a.node_type){var d=c&&-1!==r.indexOf("size");if(d){var e=a.data;return null===e?s.size:b.metabolite_size(e)}return a.node_is_primary?l:m}return n}).style("fill",function(a){if("metabolite"==a.node_type){var d=c&&-1!=r.indexOf("color");if(d){var e=a.data;return null===e?s.color:b.metabolite_color(e)}return null}return null}).call(this.behavior.turn_off_drag).call(h).on("mousedown",d).on("click",e).on("mouseover",f).on("mouseout",g),a.select(".node-label").attr("visibility",o?"hidden":"visible"));o||(t.style("visibility",function(a){return j(a,k)?"hidden":null}).attr("transform",function(a){return"translate("+a.label_x+","+a.label_y+")"}).text(function(a){var b=a[p];return c&&-1!==r.indexOf("text")&&(b+=" "+a.data_string),b}).call(this.behavior.turn_off_drag).call(i),a.select("title").text(function(a){return a[q]})),this.callback_manager.run("update_node",this,a)}function q(a){a.append("g").attr("id",function(a){return"l"+a.text_label_id}).attr("class","text-label").append("text").attr("class","label"),this.callback_manager.run("create_text_label",this,a)}function r(a){var b=this.behavior.text_label_mousedown,c=this.behavior.text_label_click,d=this.behavior.selectable_drag,e=this.behavior.turn_off_drag;a.select(".label").text(function(a){return a.text}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).on("mousedown",b).on("click",c).call(e).call(d),this.callback_manager.run("update_text_label",this,a)}function s(a,b,c,d){t.check_undefined(arguments,["reaction_arrow_displacement","start","end","displace"]);var e,f,g=a,h=t.distance(b,c);return g&&h||console.error("Bad value"),"start"==d?(e=b.x+g*(c.x-b.x)/h,f=b.y+g*(c.y-b.y)/h):"end"==d?(e=c.x-g*(c.x-b.x)/h,f=c.y-g*(c.y-b.y)/h):console.error("bad displace value: "+d),{x:e,y:f}}var t=a("./utils"),u=a("./data_styles"),v=a("./CallbackManager"),w=t.make_class();w.prototype={init:d,create_reaction:g,update_reaction:h,create_bezier:m,update_bezier:n,create_node:o,update_node:p,create_text_label:q,update_text_label:r,create_membrane:e,update_membrane:f,create_reaction_label:i,update_reaction_label:j,create_segment:k,update_segment:l},b.exports=w},{"./CallbackManager":5,"./data_styles":26,"./utils":31}],11:[function(a,b,c){function d(a,b,c,d){this.assigned_keys=a||{},this.input_list=b||[],this.mousetrap=c?new l(c):new l,this.ctrl_equals_cmd=m.isBoolean(d)?d:!1,this.mousetrap.stopCallback=function(){return!1},this.enabled=!0,this.update()}function e(a,b){if(!b)return a;var c=m.isArray(a)?a:[a],d=c.reduce(function(a,b){var c=b.replace("ctrl+","meta+");return c!==b&&a.push(c),a},c.slice());return d.length===c.length?a:d}function f(){if(this.mousetrap.reset(),this.enabled)for(var a in this.assigned_keys){var b=this.assigned_keys[a];if(b.key){var c=e(b.key,this.ctrl_equals_cmd);b.input_list=this.input_list,this.mousetrap.bind(c,function(a){var b=!1;if(this.ignore_with_input)for(var c=0,d=this.input_list.length;d>c;c++)if(this.input_list[c].is_visible()){b=!0;break}b||(this.fn?this.fn.call(this.target):console.warn("No function for key: "+this.key),a.preventDefault())}.bind(b),"keydown")}}}function g(a){m.isUndefined(a)&&(a=!this.enabled),this.enabled=a,this.update()}function h(a,b){return this.add_key_listener("enter",a,b)}function i(a,b){return this.add_key_listener("escape",a,b)}function j(a,b,c){m.isUndefined(c)&&(c=!1);var d=this.mousetrap.unbind.bind(this.mousetrap,a);return this.mousetrap.bind(e(a,this.ctrl_equals_cmd),function(a){a.preventDefault(),b(),c&&d()}),d}var k=a("./utils"),l=a("mousetrap"),m=a("underscore"),n=k.make_class();n.prototype={init:d,update:f,toggle:g,add_escape_listener:i,add_enter_listener:h,add_key_listener:j},b.exports=n},{"./utils":31,mousetrap:34,underscore:35}],12:[function(a,b,c){function d(a,b,c,d,e,f,g,h,i,j,k){if(null===g){var l=d.get_size();g={x:-l.width,y:-l.height,width:3*l.width,height:3*l.height}}i=La.isUndefined(i)||null===i||""==i?"new_map":String(i),j=La.isUndefined(j)||null===j||""==j?Aa.generate_map_id():String(j),k=La.isUndefined(k)||null===k?"":String(k),this.callback_manager=new Ga,this.svg=a,this.defs=Aa.setup_defs(a,b),this.canvas=new Ia(c,g),this.setup_containers(c),this.sel=c,this.zoom_container=d,this.settings=e,this.cobra_model=f,this.largest_ids={reactions:-1,nodes:-1,segments:-1,text_labels:-1},this.scale=new Da,this.calc_data_stats("reaction"),this.calc_data_stats("metabolite"),this.scale.connect_to_settings(this.settings,this,D.bind(this)),this.undo_stack=new Fa,this.behavior=new Ca(this,this.undo_stack),this.draw=new Ba(this.behavior,this.settings),this.key_manager=new Ha,this.key_manager.ctrl_equals_cmd=!0,this.enable_search=h,this.search_index=new Ka,this.map_name=i,this.map_id=j,this.map_description=k;this.beziers_enabled=!1,this.has_data_on_reactions=!1,this.has_data_on_nodes=!1,this.nodes={},this.reactions={},this.beziers={},this.text_labels={},this.apply_reaction_data_to_map(null),this.apply_metabolite_data_to_map(null),this.apply_gene_data_to_map(null),this.rotation_on=!1,this.listen_for_full_screen(function(){setTimeout(function(){this.zoom_extent_canvas()}.bind(this),50)}.bind(this))}function e(a,b,c,d,e,f,g,h){function i(a,b){return La.isUndefined(b)&&(b=0),La.isUndefined(a)?b:Math.max.apply(null,Object.keys(a).map(function(a){return parseInt(a)}).concat([b]))}var j=a[1].canvas,k=a[0].map_name,l=a[0].map_id,m=a[0].map_description.replace(/(\nLast Modified.*)+$/g,"")+"\nLast Modified "+Date(Date.now()).toString(),n=new Ma(b,c,d,e,f,g,j,h,k,l,m);n.reactions=a[1].reactions,n.nodes=a[1].nodes,n.text_labels=a[1].text_labels;for(var o in n.nodes){var p=n.nodes[o];if(p.connected_segments=[],h){if("metabolite"!=p.node_type)continue;n.search_index.insert("n"+o,{name:p.bigg_id,data:{type:"metabolite",node_id:o}}),n.search_index.insert("n_name"+o,{name:p.name,data:{type:"metabolite",node_id:o}})}}for(var q in n.reactions){var r=n.reactions[q];if(h){n.search_index.insert("r"+q,{name:r.bigg_id,data:{type:"reaction",reaction_id:q}}),n.search_index.insert("r_name"+q,{name:r.name,data:{type:"reaction",reaction_id:q}});for(var s in r.genes){var t=r.genes[s];n.search_index.insert("r"+q+"_g"+s,{name:t.bigg_id,data:{type:"reaction",reaction_id:q}}),n.search_index.insert("r"+q+"_g_name"+s,{name:t.name,data:{type:"reaction",reaction_id:q}})}}var u=[];for(var v in r.segments){var w=r.segments[v];if(w.reversibility=r.reversibility,w.from_node_id in n.nodes&&w.to_node_id in n.nodes){var x=n.nodes[w.from_node_id],y=n.nodes[w.to_node_id];r.metabolites.forEach(function(a){a.bigg_id==x.bigg_id?w.from_node_coefficient=a.coefficient:a.bigg_id==y.bigg_id&&(w.to_node_coefficient=a.coefficient)}),[x,y].forEach(function(a){a.connected_segments.push({segment_id:v,reaction_id:q})});var z=n.nodes[w.from_node_id],A=n.nodes[w.to_node_id];if("metabolite"==z.node_type||"metabolite"==A.node_type){var B=Aa.c_plus_c(z,Aa.c_times_scalar(Aa.c_minus_c(A,z),.5));null===w.b1&&(w.b1=B),null===w.b2&&(w.b2=B)}}else console.warn("Bad node references in segment "+v+". Deleting segment."),u.push(v)}u.forEach(function(a){delete r.segments[a]})}if(h)for(var C in n.text_labels){var D=n.text_labels[C];n.search_index.insert("l"+C,{name:D.text,data:{type:"text_label",text_label_id:C}})}n.beziers=Ea.new_beziers_for_reactions(n.reactions),n.largest_ids.reactions=i(n.reactions),n.largest_ids.nodes=i(n.nodes),n.largest_ids.text_labels=i(n.text_labels);var E=0;for(var F in n.reactions)E=i(n.reactions[F].segments,E);return n.largest_ids.segments=E,n.apply_reaction_data_to_map(null),n.apply_metabolite_data_to_map(null),n.apply_gene_data_to_map(null),n}function f(a){a.append("g").attr("id","reactions"),a.append("g").attr("id","nodes"),a.append("g").attr("id","beziers"),a.append("g").attr("id","text-labels")}function g(){this.sel.select("#reactions").selectAll(".reaction").remove(),this.sel.select("#nodes").selectAll(".node").remove(),this.sel.select("#beziers").selectAll(".bezier").remove(),this.sel.select("#text-labels").selectAll(".text-label").remove()}function h(a,b){this.callback_manager.run("set_status",null,a),clearTimeout(this._status_timer),this._status_timer=null,void 0!==b&&(this._status_timer=setTimeout(function(){this.callback_manager.run("set_status",null,"")}.bind(this),b))}function i(){this.reactions={},this.beziers={},this.nodes={},this.text_labels={},this.map_name="new_map",this.map_id=Aa.generate_map_id(),this.map_description="",this.apply_reaction_data_to_map(null),this.apply_metabolite_data_to_map(null),this.apply_gene_data_to_map(null),this.draw_everything()}function j(){return null!==this.cobra_model}function k(){this.draw_all_reactions(!0,!0),this.draw_all_nodes(!0),this.draw_all_text_labels()}function l(a,b){La.isUndefined(a)&&(a=!0),La.isUndefined(b)&&(b=!0);var c=[];for(var d in this.reactions)c.push(d);this.draw_these_reactions(c,!1),a&&this.beziers_enabled&&this.draw_all_beziers(),b&&this.clear_deleted_reactions(a)}function m(a,b){La.isUndefined(b)&&(b=!0);var c=Aa.object_slice_for_ids_ref(this.reactions,a),d=function(a){return this.draw.update_reaction(a,this.scale,this.cobra_model,this.nodes,this.defs,this.has_data_on_reactions)}.bind(this);if(Aa.draw_an_object(this.sel,"#reactions",".reaction",c,"reaction_id",this.draw.create_reaction.bind(this.draw),d),b){var e=Ea.bezier_ids_for_reaction_ids(c);this.draw_these_beziers(e)}}function n(a){function b(a){Aa.draw_a_nested_object(a,".segment-group","segments","segment_id",null,null,function(a){a.remove()})}La.isUndefined(a)&&(a=!0),Aa.draw_an_object(this.sel,"#reactions",".reaction",this.reactions,"reaction_id",null,b,function(a){a.remove()}),1==a&&this.clear_deleted_beziers()}function o(a){void 0===a&&(a=!0);var b=[];for(var c in this.nodes)b.push(c);this.draw_these_nodes(b),a&&this.clear_deleted_nodes()}function p(a){var b=Aa.object_slice_for_ids_ref(this.nodes,a),c=function(a){return this.draw.create_node(a,this.nodes,this.reactions)}.bind(this),d=function(a){return this.draw.update_node(a,this.scale,this.has_data_on_nodes,this.behavior.selectable_mousedown,this.behavior.selectable_click,this.behavior.node_mouseover,this.behavior.node_mouseout,this.behavior.selectable_drag,this.behavior.node_label_drag)}.bind(this);Aa.draw_an_object(this.sel,"#nodes",".node",b,"node_id",c,d)}function q(){Aa.draw_an_object(this.sel,"#nodes",".node",this.nodes,"node_id",null,null,function(a){a.remove()})}function r(){var a=[];for(var b in this.text_labels)a.push(b);this.draw_these_text_labels(a),this.clear_deleted_text_labels()}function s(a){var b=Aa.object_slice_for_ids_ref(this.text_labels,a),c=function(a){return this.draw.update_text_label(a,this.behavior)}.bind(this);Aa.draw_an_object(this.sel,"#text-labels",".text-label",b,"text_label_id",this.draw.create_text_label.bind(this.draw),c)}function t(){Aa.draw_an_object(this.sel,"#text-labels",".text-label",this.text_labels,"text_label_id",null,null,function(a){a.remove()})}function u(){var a=[];for(var b in this.beziers)a.push(b);this.draw_these_beziers(a),this.clear_deleted_beziers()}function v(a){var b=Aa.object_slice_for_ids_ref(this.beziers,a),c=function(a){return this.draw.update_bezier(a,this.beziers_enabled,this.behavior.bezier_drag,this.behavior.bezier_mouseover,this.behavior.bezier_mouseout,this.nodes,this.reactions)}.bind(this);Aa.draw_an_object(this.sel,"#beziers",".bezier",b,"bezier_id",this.draw.create_bezier.bind(this.draw),c)}function w(){Aa.draw_an_object(this.sel,"#beziers",".bezier",this.beziers,"bezier_id",null,null,function(a){a.remove()})}function x(){this.toggle_beziers(!0)}function y(){this.toggle_beziers(!1)}function z(a){La.isUndefined(a)?this.beziers_enabled=!this.beziers_enabled:this.beziers_enabled=a,this.draw_all_beziers(),this.callback_manager.run("toggle_beziers",null,this.beziers_enabled)}function A(a){var b=this.settings.get_option("reaction_styles"),c=this.settings.get_option("reaction_compare_style"),d=Ja.apply_reaction_data_to_reactions(this.reactions,a,b,c);return this.has_data_on_reactions=d,this.calc_data_stats("reaction")}function B(a){var b=this.settings.get_option("metabolite_styles"),c=this.settings.get_option("metabolite_compare_style"),d=Ja.apply_metabolite_data_to_nodes(this.nodes,a,b,c);return this.has_data_on_nodes=d,this.calc_data_stats("metabolite")}function C(a){var b=this.settings.get_option("reaction_styles"),c=this.settings.get_option("reaction_compare_style"),d=this.settings.get_option("identifiers_on_map"),e=this.settings.get_option("and_method_in_gene_reaction_rule"),f=Ja.apply_gene_data_to_reactions(this.reactions,a,b,d,c,e);return this.has_data_on_reactions=f,this.calc_data_stats("reaction")}function D(){return this.data_statistics}function E(a){function b(a){return function(b){return a.apply(null,b)}}if(-1==["reaction","metabolite"].indexOf(a))throw new Error("Bad type "+a);"data_statistics"in this?a in this.data_statistics||(this.data_statistics[a]={}):(this.data_statistics={},this.data_statistics[a]={});var c=!0,d=[];if("metabolite"==a)for(var e in this.nodes){var f=this.nodes[e];null!==f.data&&d.push(f.data)}else if("reaction"==a)for(var g in this.reactions){var h=this.reactions[g];null!==h.data&&d.push(h.data)}var i=Aa.quartiles(d),j=[["min",b(Math.min)],["max",b(Math.max)],["mean",Aa.mean],["Q1",function(){return i[0]}],["median",function(){return i[1]}],["Q3",function(){return i[2]}]];return j.forEach(function(b){var e,f=b[0];if(0==d.length)e=null;else{var g=b[1];e=g(d)}e!=this.data_statistics[a][f]&&(c=!1),this.data_statistics[a][f]=e}.bind(this)),"reaction"==a?this.callback_manager.run("calc_data_stats__reaction",null,!c):this.callback_manager.run("calc_data_stats__metabolite",null,!c),!c}function F(){var a=[];return this.sel.select("#nodes").selectAll(".selected").each(function(b){a.push(b.node_id)}),a}function G(){var a={};return this.sel.select("#nodes").selectAll(".selected").each(function(b){a[b.node_id]=this.nodes[b.node_id]}.bind(this)),a}function H(){var a=[];return this.sel.select("#text-labels").selectAll(".selected").each(function(b){a.push(b.text_label_id)}),a}function I(){var a={};return this.sel.select("#text-labels").selectAll(".selected").each(function(b){a[b.text_label_id]=this.text_labels[b.text_label_id]}.bind(this)),a}function J(){this.sel.selectAll("#nodes,#text-labels").selectAll(".node,.text-label").classed("selected",!0)}function K(){this.sel.selectAll(".selected").classed("selected",!1)}function L(){var a=this.sel.selectAll("#nodes,#text-labels").selectAll(".node,.text-label");a.classed("selected",function(){return!d3.select(this).classed("selected")})}function M(a){this.deselect_text_labels();var b,c,d=this.sel.select("#nodes").selectAll(".node");d.classed("selected",function(d){var e=String(d.node_id)==String(a);return e&&(c=d,b={x:d.x,y:d.y}),e}),this.sel.selectAll(".start-reaction-target").style("visibility","hidden"),this.callback_manager.run("select_metabolite_with_id",null,c,b)}function N(a,b,c){c=La.isUndefined(c)?!1:c;var d,e=this.sel.selectAll("#nodes,#text-labels").selectAll(".node,.text-label");d=-1==d3.select(a).attr("class").indexOf("text-label")?a.parentNode:a,c?d3.select(d).classed("selected",!d3.select(d).classed("selected")):(e.classed("selected",!1),d3.select(d).classed("selected",!0));var f,g,h=this.sel.select("#nodes").selectAll(".selected"),i=0;h.each(function(a){g=a,f={x:a.x,y:a.y},i++}),this.callback_manager.run("select_selectable",null,i,g,f)}function O(){var a=null,b=this.sel.select("#nodes").selectAll(".selected");return b.classed("selected",function(b,c){return 0==c?(a=b,!0):!1}),a}function P(){var a=this.sel.select("#nodes").selectAll(".node");a.classed("selected",!1),this.callback_manager.run("deselect_nodes")}function Q(a,b){this.deselect_nodes();var c=this.sel.select("#text-labels").selectAll(".text-label");c.classed("selected",function(a){return b===a});var d,e=this.sel.select("#text-labels").selectAll(".selected");e.each(function(a){d={x:a.x,y:a.y}}),this.callback_manager.run("select_text_label")}function R(){var a=this.sel.select("#text-labels").selectAll(".text-label");a.classed("selected",!1)}function S(){var a=this.get_selected_nodes(),b=this.get_selected_text_labels();(Object.keys(a).length>=1||Object.keys(b).length>=1)&&this.delete_selectable(a,b,!0)}function T(a,b,c){var d=this.segments_and_reactions_for_nodes(a),e=d.segment_objs_w_segments,f=d.reactions,g=Aa.clone(a),h=Aa.clone(e),i=Aa.clone(f),j=Aa.clone(b),k=function(b,d,e,f){this.delete_node_data(Object.keys(a)),this.delete_segment_data(e),this.delete_reaction_data(Object.keys(d)),this.delete_text_label_data(Object.keys(f));var g=!1,h=!1;this.has_data_on_reactions&&(g=this.calc_data_stats("reaction")),this.has_data_on_nodes&&(h=this.calc_data_stats("metabolite")),c&&(g?this.draw_all_reactions(!0,!0):this.clear_deleted_reactions(),h?this.draw_all_nodes(!0):this.clear_deleted_nodes(),this.clear_deleted_text_labels())}.bind(this);k(a,f,e,b),this.undo_stack.push(function(){this.extend_nodes(g),this.extend_reactions(i);var d=Object.keys(i);for(var k in h){var l=h[k],m=l.segment;this.reactions[l.reaction_id].segments[l.segment_id]=m,[m.from_node_id,m.to_node_id].forEach(function(a){if(!(a in g)){var b=this.nodes[a];b.connected_segments.push({reaction_id:l.reaction_id,segment_id:l.segment_id})}}.bind(this));var n=l.segment_id,o=l.reaction_id,p={};p[n]=l.segment,Aa.extend(this.beziers,Ea.new_beziers_for_segments(p,o)),-1==d.indexOf(l.reaction_id)&&d.push(l.reaction_id)}if(this.has_data_on_reactions){var q=this.calc_data_stats("reaction");q?this.draw_all_reactions(!0,!1):this.draw_these_reactions(d)}else c&&this.draw_these_reactions(d);if(this.has_data_on_nodes){var q=this.calc_data_stats("metabolite");c&&(q?this.draw_all_nodes(!1):this.draw_these_nodes(Object.keys(g)))}else c&&this.draw_these_nodes(Object.keys(g));Aa.extend(this.text_labels,j),c&&this.draw_these_text_labels(Object.keys(j)),b=Aa.clone(j),a=Aa.clone(g),e=Aa.clone(h),f=Aa.clone(i)}.bind(this),function(){k(a,f,e,b)}.bind(this))}function U(a){a.forEach(function(a){if(this.enable_search&&"metabolite"==this.nodes[a].node_type){var b=this.search_index.remove("n"+a)&&this.search_index.remove("n_name"+a);b||console.warn("Could not find deleted metabolite in search index")}delete this.nodes[a]}.bind(this))}function V(a){for(var b in a){var c=a[b],d=this.reactions[c.reaction_id];if(!(c.segment_id in d.segments))return;var e=d.segments[c.segment_id];[e.from_node_id,e.to_node_id].forEach(function(a){if(a in this.nodes){var b=this.nodes[a];b.connected_segments=b.connected_segments.filter(function(a){return a.segment_id!=c.segment_id})}}.bind(this)),["b1","b2"].forEach(function(a){var b=Ea.bezier_id_for_segment_id(c.segment_id,a);delete this.beziers[b]}.bind(this)),delete d.segments[c.segment_id]}}function W(a){a.forEach(function(a){var b=this.reactions[a];for(var c in b.segments)["b1","b2"].forEach(function(a){var b=Ea.bezier_id_for_segment_id(c,a);delete this.beziers[b]}.bind(this));delete this.reactions[a];var d=this.search_index.remove("r"+a)&&this.search_index.remove("r_name"+a);d||console.warn("Could not find deleted reaction "+a+" in search index");for(var e in b.genes){var d=this.search_index.remove("r"+a+"_g"+e)&&this.search_index.remove("r"+a+"_g_name"+e);d||console.warn("Could not find deleted gene "+e+" in search index")}}.bind(this))}function X(a){a.forEach(function(a){delete this.text_labels[a];var b=this.search_index.remove("l"+a);b||console.warn("Could not find deleted text label in search index")}.bind(this))}function Y(a,b,c){function d(a,b){if(this.extend_nodes(a),this.has_data_on_nodes){var c=this.apply_metabolite_data_to_nodes(a);c?this.draw_all_nodes(!1):this.draw_these_nodes([b])}else this.draw_these_nodes([b])}if(!this.cobra_model)return void console.error("No CobraModel. Cannot build new reaction");var e=Aa.clone(this.cobra_model.reactions[a]);if(0===La.size(e.metabolites))throw Error("No metabolites in reaction "+e.bigg_id);var f=La.map(e.metabolites,function(a,b){return[a,b]}).filter(function(a){return a[0]<0}).map(function(a){return a[1]}),g=f.length>0?f[0]:Object.keys(e.metabolites)[0],h=this.cobra_model.metabolites[g],i=String(++this.largest_ids.nodes),j={x:30,y:10},k={connected_segments:[],x:b.x,y:b.y,node_is_primary:!0,label_x:b.x+j.x,label_y:b.y+j.y,name:h.name,bigg_id:g,node_type:"metabolite"},l={};l[i]=k,d.apply(this,[l,i]);var m=Aa.clone(l),n=this.new_reaction_for_metabolite(a,i,c,!1),o=n.redo,p=n.undo;this.undo_stack.push(function(){p(),this.delete_node_data(Object.keys(l)),l=Aa.clone(m),this.clear_deleted_nodes(),this.deselect_nodes()}.bind(this),function(){d.apply(this,[l,i]),o()}.bind(this))}function Z(a){if(this.enable_search)for(var b in a){var c=a[b];"metabolite"==c.node_type&&(this.search_index.insert("n"+b,{name:c.bigg_id,data:{type:"metabolite",node_id:b}}),this.search_index.insert("n_name"+b,{name:c.name,data:{type:"metabolite",node_id:b}}))}Aa.extend(this.nodes,a)}function $(a){if(this.enable_search)for(var b in a){var c=a[b];this.search_index.insert("r"+b,{name:c.bigg_id,data:{type:"reaction",reaction_id:b}}),this.search_index.insert("r_name"+b,{name:c.name,data:{type:"reaction",reaction_id:b}});for(var d in c.genes){var e=c.genes[d];this.search_index.insert("r"+b+"_g"+d,{name:e.bigg_id,data:{type:"reaction",reaction_id:b}}),this.search_index.insert("r"+b+"_g_name"+d,{name:e.name,data:{type:"reaction",reaction_id:b}})}}Aa.extend(this.reactions,a)}function _(a,b,c,d){function e(a,b,c,d){if(this.extend_reactions(b),Aa.extend(this.beziers,c),this.delete_node_data([d]),this.extend_nodes(a),this.has_data_on_reactions){var e=this.calc_data_stats("reaction");e?this.draw_all_reactions(!0,!1):this.draw_these_reactions(Object.keys(b))}else this.draw_these_reactions(Object.keys(b));if(this.has_data_on_nodes){var e=this.calc_data_stats("metabolite");e?this.draw_all_nodes(!1):this.draw_these_nodes(Object.keys(a))}else this.draw_these_nodes(Object.keys(a));for(var f in a){var g=a[f];if(g.node_is_primary&&f!=d){this.select_metabolite_with_id(f);var h={x:g.x,y:g.y};this.zoom_container&&this.zoom_container.translate_off_screen(h)}}}void 0===d&&(d=!0);var f=this.nodes[b],g=this.cobra_model.reactions[a],h=Ea.new_reaction(a,g,this.cobra_model.metabolites,b,Aa.clone(f),this.largest_ids,this.settings.get_option("cofactors"),c),i=h.new_nodes,j=h.new_reactions,k=h.new_beziers;e.apply(this,[i,j,k,b]);var l=Aa.clone(i),m=Aa.clone(j),n=Aa.clone(k),o=function(){if(delete i[b],this.delete_node_data(Object.keys(i)),this.delete_reaction_data(Object.keys(j)),M.apply(this,[b]),i=Aa.clone(l),j=Aa.clone(m),k=Aa.clone(n),this.has_data_on_reactions){var a=this.calc_data_stats("reaction");a?this.draw_all_reactions(!0,!0):this.draw_these_reactions(Object.keys(j))}else this.clear_deleted_reactions(!0);if(this.has_data_on_nodes){var a=this.calc_data_stats("metabolite");a?this.draw_all_nodes(!0):this.draw_these_nodes(Object.keys(i))}else this.clear_deleted_nodes()}.bind(this),p=function(){e.apply(this,[i,j,k,b])}.bind(this);return d&&this.undo_stack.push(o,p),{undo:o,redo:p}}function aa(){var a,b=this.get_selected_nodes(),c=Object.keys(b)[0],d=(b[c],this.reactions),e=this.nodes,f=[];if(e[c].connected_segments.forEach(function(b){a=[b.reaction_id];var e;try{if(e=d[b.reaction_id].segments[b.segment_id],void 0===e)throw new Error("undefined segment")}catch(g){return void console.warn("Could not find connected segment "+b.segment_id)}f.push(e.from_node_id==c?e.to_node_id:e.from_node_id)}),1!=f.length)return void console.error("Only connected nodes with a single reaction can be selected");var g=f[0],h=[c];e[g].connected_segments.forEach(function(a){var b;try{if(b=d[a.reaction_id].segments[a.segment_id],void 0===b)throw new Error("undefined segment")}catch(f){return void console.warn("Could not find connected segment "+a.segment_id)}var i=b.from_node_id==g?b.to_node_id:b.from_node_id,j=e[i];"metabolite"==j.node_type&&i!=c&&h.push(String(i))});for(var i=0;i<h.length;i++)if(e[h[i]].connected_segments.length>1)return void console.error("Only connected nodes with a single reaction can be selected");for(var j in b)if(j!=c&&-1==h.indexOf(j))return void console.warn("Selected nodes are not on the same reaction");var k=[],l=h.length-1,m=e[h[l]],n=m.node_is_primary,o={x:m.x,y:m.y,label_x:m.label_x,label_y:m.label_y};m.connected_segments.length>1&&console.warn("Too many connected segments for node "+m.node_id);var p,q=m.connected_segments[0];try{if(p=d[q.reaction_id].segments[q.segment_id],void 0===p)throw new Error("undefined segment")}catch(r){return void console.error("Could not find connected segment "+q.segment_id)}var s,t={b1:p.b1,b2:p.b2};h.forEach(function(a){var b=e[a],c=b.node_is_primary,f={x:b.x,y:b.y,label_x:b.label_x,label_y:b.label_y},g=b.connected_segments[0],h=d[g.reaction_id].segments[g.segment_id],i={b1:h.b1,b2:h.b2};b.node_is_primary=n,b.x=o.x,b.y=o.y,b.label_x=o.label_x,b.label_y=o.label_y,h.b1=t.b1,h.b2=t.b2,n=c,o=f,t=i,b.node_is_primary&&(s=a),k.push(a)});var u=e[g].connected_segments,l=u.length-1,v=[u[l]];u.forEach(function(a,b){l!=b&&v.push(a)}),e[g].connected_segments=v,this.draw_these_nodes(k),this.draw_these_reactions(a),this.select_metabolite_with_id(s)}function ba(){var a=this.get_selected_node_ids(),b=function(a){var b={},c=this.settings.get_option("hide_secondary_metabolites");if(a.forEach(function(a){if(!(a in this.nodes))return void console.warn("Could not find node: "+a);var c=this.nodes[a];"metabolite"==c.node_type&&(c.node_is_primary=!c.node_is_primary,b[a]=c)}.bind(this)),this.draw_these_nodes(Object.keys(b)),c){var d=this.segments_and_reactions_for_nodes(b),e={};for(var f in d.segment_objs_w_segments){var g=d.segment_objs_w_segments[f].reaction_id;e[g]=!0}this.draw_these_reactions(Object.keys(e))}}.bind(this);b(a),this.undo_stack.push(function(){b(a)},function(){b(a)})}function ca(a){var b={},c={},d={},e=this.reactions;for(var f in a){var g=a[f];g.connected_segments.forEach(function(a){var c;try{if(c=e[a.reaction_id].segments[a.segment_id],void 0===c)throw new Error("undefined segment")}catch(f){return void console.warn("Could not find connected segments for node")}var g=Aa.clone(a);g.segment=Aa.clone(c),b[a.segment_id]=g,a.reaction_id in d||(d[a.reaction_id]=[]),d[a.reaction_id].push(a.segment_id)})}for(var h in d){var i=e[h],j=d[h],k=!0;for(var l in i.segments)-1==j.indexOf(l)&&(k=!1);k&&(c[h]=i)}return{segment_objs_w_segments:b,reactions:c}}function da(a,b){var c=Ea.new_text_label(this.largest_ids,b,a);this.text_labels[c.id]=c.label;this.draw_these_text_labels([c.id]);return this.search_index.insert("l"+c.id,{name:b,data:{type:"text_label",text_label_id:c.id}}),c.id}function ea(a,b,c){var d=this.text_labels[a].text,e=function(b,c){this.text_labels[a].text=b,c&&this.draw_these_text_labels([a]);var d="l"+a,e=this.search_index.remove(d);e||console.warn("Could not find modified text label in search index"),this.search_index.insert(d,{name:b,data:{type:"text_label",text_label_id:a}})}.bind(this);e(b,c),this.undo_stack.push(function(){e(d,c)},function(){e(b,c)})}function fa(a){this._zoom_extent(a,"nodes")}function ga(a){this._zoom_extent(a,"canvas")}function ha(a,b){La.isUndefined(a)&&(a="nodes"==b?.2:0),La.isUndefined(b)&&(b="canvas");var c,d,e=this.get_size();if(a*=e.height,"nodes"==b){var f={x:null,y:null},g={x:null,y:null};for(var h in this.nodes){var i=this.nodes[h];null===f.x&&(f.x=i.x),null===f.y&&(f.y=i.y),null===g.x&&(g.x=i.x),null===g.y&&(g.y=i.y),f.x=Math.min(f.x,i.x),f.y=Math.min(f.y,i.y),g.x=Math.max(g.x,i.x),g.y=Math.max(g.y,i.y)}c=Math.min((e.width-2*a)/(g.x-f.x),(e.height-2*a)/(g.y-f.y)),d={x:-(f.x*c)+a+(e.width-2*a-(g.x-f.x)*c)/2,y:-(f.y*c)+a+(e.height-2*a-(g.y-f.y)*c)/2}}else{if("canvas"!=b)return console.error("Did not recognize mode");c=Math.min((e.width-2*a)/this.canvas.width,(e.height-2*a)/this.canvas.height),d={x:-(this.canvas.x*c)+a+(e.width-2*a-this.canvas.width*c)/2,y:-(this.canvas.y*c)+a+(e.height-2*a-this.canvas.height*c)/2}}return this.zoom_container.go_to(c,d),null}function ia(){return this.zoom_container.get_size()}function ja(a){var b=this.reactions[a],c=.5,d=this.get_size(),e={x:-b.label_x*c+d.width/2,y:-b.label_y*c+d.height/2};this.zoom_container.go_to(c,e)}function ka(a){var b=this.nodes[a],c=.5,d=this.get_size(),e={x:-b.label_x*c+d.width/2,y:-b.label_y*c+d.height/2};this.zoom_container.go_to(c,e)}function la(a){var b=this.text_labels[a],c=.5,d=this.get_size(),e={x:-b.x*c+d.width/2,y:-b.y*c+d.height/2};this.zoom_container.go_to(c,e)}function ma(a){this.highlight(this.sel.selectAll("#r"+a).selectAll("text"))}function na(a){this.highlight(this.sel.selectAll("#n"+a).selectAll("text"))}function oa(a){this.highlight(this.sel.selectAll("#l"+a).selectAll("text"))}function pa(a){this.sel.selectAll(".highlight").classed("highlight",!1),null!==a&&a.classed("highlight",!0)}function qa(){return document.fullscreenEnabled?"fullscreenchange":document.mozFullScreenEnabled?"mozfullscreenchange":document.webkitFullscreenEnabled?"webkitfullscreenchange":document.msFullscreenEnabled?"MSFullscreenChange":null}function ra(a){document.addEventListener(qa(),a),this.full_screen_listener=a}function sa(){document.removeEventListener(qa(),this.full_screen_listener)}function ta(){var a=this.zoom_container.selection,b=a.node(),c=document,d=c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement||c.msFullscreenElement;if(d)if(a.classed("full-screen-on",!1),c.exitFullscreen)c.exitFullscreen();else if(c.mozCancelFullScreen)c.mozCancelFullScreen();else if(c.webkitExitFullscreen)c.webkitExitFullscreen();else{
if(!c.msExitFullscreen)throw Error("Cannot exit full screen");c.msExitFullscreen()}else if(a.classed("full-screen-on",!0),b.requestFullscreen)b.requestFullscreen();else if(b.mozRequestFullScreen)b.mozRequestFullScreen();else if(b.webkitRequestFullscreen)b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else{if(!b.msRequestFullscreen)throw Error("Full screen does not seem to be supported on this system.");b.msRequestFullscreen()}}function ua(){Aa.download_json(this.map_for_export(),this.map_name)}function va(){var a=[{map_name:this.map_name,map_id:this.map_id,map_description:this.map_description,homepage:"https://escher.github.io",schema:"https://escher.github.io/escher/jsonschema/1-0-0#"},{reactions:Aa.clone(this.reactions),nodes:Aa.clone(this.nodes),text_labels:Aa.clone(this.text_labels),canvas:this.canvas.size_and_location()}];for(var b in a[1].reactions){var c=a[1].reactions[b],d={};["name","bigg_id","reversibility","label_x","label_y","gene_reaction_rule","genes","metabolites"].forEach(function(a){d[a]=c[a]}),d.segments={};for(var e in c.segments){var f=c.segments[e],g={};["from_node_id","to_node_id","b1","b2"].forEach(function(a){g[a]=f[a]}),d.segments[e]=g}a[1].reactions[b]=d}for(var h in a[1].nodes){var i,j=a[1].nodes[h],k={};i="metabolite"==j.node_type?["node_type","x","y","bigg_id","name","label_x","label_y","node_is_primary"]:["node_type","x","y"],i.forEach(function(a){k[a]=j[a]}),a[1].nodes[h]=k}for(var l in a[1].text_labels){var m=a[1].text_labels[l],n={},i=["x","y","text"];i.forEach(function(a){n[a]=m[a]}),a[1].text_labels[l]=n}var o=a[1].canvas,p={},i=["x","y","width","height"];return i.forEach(function(a){p[a]=o[a]}),a[1].canvas=p,a}function wa(a,b,c,d){a.callback_manager.run(b);var e=a.zoom_container.window_scale,f=a.zoom_container.window_translate,g=a.canvas.size_and_location(),h={w:a.canvas.mouse_node.attr("width"),h:a.canvas.mouse_node.attr("height"),transform:a.canvas.mouse_node.attr("transform")};a.zoom_container._go_to_svg(1,{x:-g.x,y:-g.y},function(){a.svg.attr("width",g.width),a.svg.attr("height",g.height),a.canvas.mouse_node.attr("width","0px"),a.canvas.mouse_node.attr("height","0px"),a.canvas.mouse_node.attr("transform",null);var b=a.sel.selectAll(".multimarker-circle,.midmarker-circle,#canvas").style("visibility","hidden");"svg"==d?Aa.download_svg("saved_map",a.svg,!0):"png"==d&&Aa.download_png("saved_map",a.svg,!0),a.zoom_container._go_to_svg(e,f,function(){a.svg.attr("width",null),a.svg.attr("height",null),a.canvas.mouse_node.attr("width",h.w),a.canvas.mouse_node.attr("height",h.h),a.canvas.mouse_node.attr("transform",h.transform),b.style("visibility",null),a.callback_manager.run(c)}.bind(a))}.bind(a))}function xa(){wa(this,"before_svg_export","after_svg_export","svg")}function ya(){wa(this,"before_png_export","after_png_export","png")}function za(){if(this.callback_manager.run("before_convert_map"),!this.has_cobra_model())throw Error("No COBRA model loaded.");var a,b=this.cobra_model,c={},d=["name","gene_reaction_rule","genes"],e={},f=["name"];for(var g in this.reactions){var h=this.reactions[g];a=!1;for(var i in b.reactions){var j=b.reactions[i];j.bigg_id==h.bigg_id&&(d.forEach(function(a){h[a]=j[a]}),a=!0)}a||(c[g]=!0)}for(var k in this.nodes){var l=this.nodes[k];if("metabolite"==l.node_type){a=!1;for(var m in b.metabolites){var n=b.metabolites[m];n.bigg_id==l.bigg_id&&(f.forEach(function(a){l[a]=n[a]}),a=!0)}a||(e[k]=!0)}}var o=Object.keys(c).length,p=Object.keys(e).length,q=3e3;0==o&&0==p?this.set_status("Successfully converted attributes.",q):0==p?(this.set_status("Converted attributes, but count not find "+o+" reactions in the model.",q),this.settings.set_conditional("highlight_missing",!0)):0==o?(this.set_status("Converted attributes, but count not find "+p+" metabolites in the model.",q),this.settings.set_conditional("highlight_missing",!0)):(this.set_status("Converted attributes, but count not find "+o+" reactions and "+p+" metabolites in the model.",q),this.settings.set_conditional("highlight_missing",!0)),this.draw_everything(),this.callback_manager.run("after_convert_map")}var Aa=a("./utils"),Ba=a("./Draw"),Ca=a("./Behavior"),Da=a("./Scale"),Ea=a("./build"),Fa=a("./UndoStack"),Ga=a("./CallbackManager"),Ha=a("./KeyManager"),Ia=a("./Canvas"),Ja=a("./data_styles"),Ka=a("./SearchIndex"),La=(a("baconjs"),a("underscore")),Ma=Aa.make_class();Ma.from_data=e,Ma.prototype={init:d,setup_containers:f,reset_containers:g,set_status:h,clear_map:i,select_all:J,select_none:K,invert_selection:L,select_selectable:N,select_metabolite_with_id:M,select_single_node:O,deselect_nodes:P,select_text_label:Q,deselect_text_labels:R,new_reaction_from_scratch:Y,extend_nodes:Z,extend_reactions:$,new_reaction_for_metabolite:_,cycle_primary_node:aa,toggle_selected_node_primary:ba,new_text_label:da,edit_text_label:ea,delete_selected:S,delete_selectable:T,delete_node_data:U,delete_segment_data:V,delete_reaction_data:W,delete_text_label_data:X,get_selected_node_ids:F,get_selected_nodes:G,get_selected_text_label_ids:H,get_selected_text_labels:I,segments_and_reactions_for_nodes:ca,draw_everything:k,draw_all_reactions:l,draw_these_reactions:m,clear_deleted_reactions:n,draw_all_nodes:o,draw_these_nodes:p,clear_deleted_nodes:q,draw_all_text_labels:r,draw_these_text_labels:s,clear_deleted_text_labels:t,draw_all_beziers:u,draw_these_beziers:v,clear_deleted_beziers:w,toggle_beziers:z,hide_beziers:y,show_beziers:x,has_cobra_model:j,apply_reaction_data_to_map:A,apply_metabolite_data_to_map:B,apply_gene_data_to_map:C,get_data_statistics:D,calc_data_stats:E,zoom_extent_nodes:fa,zoom_extent_canvas:ga,_zoom_extent:ha,get_size:ia,zoom_to_reaction:ja,zoom_to_node:ka,zoom_to_text_label:la,highlight_reaction:ma,highlight_node:na,highlight_text_label:oa,highlight:pa,listen_for_full_screen:ra,unlisten_for_full_screen:sa,full_screen:ta,save:ua,map_for_export:va,save_svg:xa,save_png:ya,convert_map:za},b.exports=Ma},{"./Behavior":1,"./CallbackManager":5,"./Canvas":6,"./Draw":10,"./KeyManager":11,"./Scale":15,"./SearchIndex":18,"./UndoStack":22,"./build":24,"./data_styles":26,"./utils":31,baconjs:32,underscore:35}],13:[function(a,b,c){function d(a,b,c){this.div=a,void 0===c&&(c={x:0,y:0}),this.displacement=c,this.map=b}function e(){return"none"!=this.div.style("display")}function f(a){this.div.style("display",null);var b=this.map.zoom_container.window_translate,c=this.map.zoom_container.window_scale,d=this.map.get_size(),e=Math.max(20,Math.min(d.width-270,c*a.x+b.x-this.displacement.x)),f=Math.max(20,Math.min(d.height-40,c*a.y+b.y-this.displacement.y));this.div.style("position","absolute").style("display","block").style("left",e+"px").style("top",f+"px")}function g(){this.div.style("display","none")}var h=a("./utils"),i=h.make_class();i.prototype={init:d,is_visible:e,place:f,hide:g},b.exports=i},{"./utils":31}],14:[function(a,b,c){function d(a,b){var c=a.append("select").attr("id","quick-jump-menu").attr("class","form-control");this.selector=c;var d=g.parse_url_components(window),e="map_name"in d?d.map_name:null,f="quick_jump_path"in d?d.quick_jump_path:null,h="quick_jump"in d?d.quick_jump:[],i="— Jump to map —",j=[i].concat(h);null!==e&&(j=j.filter(function(a){return a!=e})),c.selectAll("option").data(j).enter().append("option").text(function(a){return a.split(".").slice(-1)[0]}),c.style("display",j.length>1?"block":"none");var k=function(a){b(a,f,function(b){b?this.replace_state_for_map_name(a):this.reset_selection()}.bind(this))}.bind(this);c.on("change",function(){var a=this.options[this.selectedIndex].__data__;k(a)})}function e(){this.selector.node().selectedIndex=0}function f(a){var b=window.location.href.replace(/(map_name=)([^&]+)(&|$)/,"$1"+a+"$3");window.history.replaceState("Not implemented","",b)}var g=a("./utils"),h=g.make_class();h.prototype={init:d,reset_selection:e,replace_state_for_map_name:f},b.exports=h},{"./utils":31}],15:[function(a,b,c){function d(){this.x=d3.scale.linear(),this.y=d3.scale.linear(),this.x_size=d3.scale.linear(),this.y_size=d3.scale.linear(),this.size=d3.scale.linear(),this.reaction_color=d3.scale.linear().clamp(!0),this.reaction_size=d3.scale.linear().clamp(!0),this.metabolite_color=d3.scale.linear().clamp(!0),this.metabolite_size=d3.scale.linear().clamp(!0),this.scale_path=function(a){var b=this.x,c=this.y,d=d3.format(".2f"),a=a.replace(/(M|L)([0-9-.]+),?\s*([0-9-.]+)/g,function(a,e,f,g){return e+[d(b(parseFloat(f))),d(c(parseFloat(g)))].join(", ")}),e=/C([0-9-.]+),?\s*([0-9-.]+)\s*([0-9-.]+),?\s*([0-9-.]+)\s*([0-9-.]+),?\s*([0-9-.]+)/g;return a=a.replace(e,function(a,e,f,g,h,i,j){return"C"+d(b(parseFloat(e)))+","+d(c(parseFloat(f)))+" "+d(b(parseFloat(g)))+","+d(c(parseFloat(h)))+" "+[d(b(parseFloat(i)))+","+d(c(parseFloat(j)))]})}.bind(this),this.scale_decimals=function(a,b,c){var d=d3.format("."+String(c)+"f");return a=a.replace(/([0-9.]+)/g,function(a,c){return d(b(parseFloat(c)))})}}function e(a,b,c){function d(a,b){var c=a.map(function(a){var c;if(a.type in b)c=b[a.type];else{if("value"!=a.type)throw new Error("Bad domain type "+a.type);c=a.value}return{v:c,color:a.color,size:a.size}}).sort(function(a,b){return a.v-b.v});return{domain:c.map(function(a){return a.v}),color_range:c.map(function(a){return a.color}),size_range:c.map(function(a){return a.size})}}var e=function(a){var b=d(a,c().reaction);this.reaction_color.domain(b.domain),this.reaction_size.domain(b.domain),this.reaction_color.range(b.color_range),this.reaction_size.range(b.size_range)}.bind(this),f=function(a){var b=d(a,c().metabolite);this.metabolite_color.domain(b.domain),this.metabolite_size.domain(b.domain),this.metabolite_color.range(b.color_range),this.metabolite_size.range(b.size_range)}.bind(this);a.streams.reaction_scale.onValue(e),a.streams.metabolite_scale.onValue(f),b.callback_manager.set("calc_data_stats__reaction",function(b){b&&e(a.get_option("reaction_scale"))}),b.callback_manager.set("calc_data_stats__metabolite",function(b){b&&f(a.get_option("metabolite_scale"))})}var f=a("./utils"),g=f.make_class();g.prototype={init:d,connect_to_settings:e},b.exports=g},{"./utils":31}],16:[function(a,b,c){function d(a,b,c,d){var e="grad"+b+this.unique_string;this.w=400,this.h=30,this.x=20,this.input_width=90,this.input_height=24;var f=a.append("div").attr("class","scale-editor");this.data_not_loaded=f.append("div").attr("class","data-not-loaded").text(("reaction"==b?"Reaction and gene":"Metabolite")+" data not loaded"),this.input_label_group=f.append("div").attr("class","input-label-group");var g=f.append("div").style("top",3*this.input_height+56+10+"px").attr("class","no-data");g.append("span").text("Styles for "+b+"s with no data").attr("class","no-data-heading"),this.no_data_container=g.append("div");var h=f.append("div").attr("class","centered");this.add_group=h.append("div"),this.trash_group=h.append("div").attr("class","trash-container");var i=h.append("svg").attr("class","scale-svg");this.input_group=h.append("div").attr("class","input-container"),this.gradient=i.append("defs").append("linearGradient").attr("id",e),i.append("rect").attr("class","rect").attr("fill","url(#"+e+")").attr("width",this.w+"px").attr("height",this.h+"px").attr("x",this.x+"px"),this.pickers_group=i.append("g"),this.type=b,this.settings=c,this.get_data_statistics=d;var j=this.settings.get_option("unique_map_id");this.unique_string=null===j?"":"."+j,this.no_data={},["color","size"].forEach(function(a){this.no_data[a]=null,this.settings.streams[this.type+"_no_data_"+a].onValue(function(b){this.no_data[a]=b,this.update_no_data()}.bind(this))}.bind(this)),this.settings.streams[b+"_scale"].onValue(function(a){this.scale=a,this.update()}.bind(this))}function e(){var a=this.scale,b=this.get_data_statistics()[this.type],c=14,d=35,e=this.x,f=this._data_not_loaded();f&&(a=[{type:"min",color:null,size:null},{type:"max",color:null,size:null}],b={min:0,max:1});var g=d3.scale.linear().domain([0,this.w]).range([b.min,b.max]),h=d3.scale.linear().domain([0,this.w]).range([0,b.max-b.min]),i=function(a,b){this.input_group.selectAll(".input-set").each(function(b){d3.select(this).classed("selected-set",a===b)})}.bind(this),j=function(a){return"value"==a.type?a.value:b[a.type]},k=function(a){this.settings.set_conditional(this.type+"_scale",a),this.scale=a,this.update()}.bind(this),l=a.map(function(a){return{frac:(j(a)-b.min)/(b.max-b.min),color:a.color}}).filter(function(a){return a.frac>=0&&a.frac<=1}).sort(function(a,b){return a.frac-b.frac}),m=this.gradient.selectAll("stop").data(l);m.enter().append("stop"),m.attr("offset",function(a){return 100*a.frac+"%"}).style("stop-color",function(a){return null===a.color?"#F1ECFA":a.color}),m.exit().remove(),this.data_not_loaded.style("visibility",f?null:"hidden");var n=this.pickers_group.selectAll(".picker").data(a),o=d3.behavior.drag();o.on("drag",function(d,e){-1===["value","min","max"].indexOf(a[e].type)&&(a[e].value=j(d),a[e].type="value");var f=a[e].value+h(d3.event.dx),g=h(c+2);f>b.max-g&&(f=b.max-g),f<b.min+g&&(f=b.min+g),f=Math.floor(100*f)/100,a[e].value=f,this.settings.set_conditional(this.type+"_scale",a),this.scale=a,this.update()}.bind(this)),n.enter().append("g").attr("class","picker").style("cursor","pointer").append("rect"),n.select("rect").attr("x",function(a,d){var f=j(a),h=c+2;return"value"==a.type&&f<=b.min?g.invert(b.min)-c/2+e-h:"value"==a.type&&f>=b.max?g.invert(b.max)-c/2+e+h:g.invert(f)-c/2+e}).attr("width",c+"px").attr("height",d+"px").call(o).on("mousedown",i),n.exit().remove();var p=this.trash_group.selectAll("span").data(a);p.enter().append("span"),p.attr("class",function(a,b){return"min"==a.type||"max"==a.type?null:"trash glyphicon glyphicon-trash"}).style("left",function(a){return g.invert(j(a))-c/2+e+"px"}).on("click",function(b,c){"min"!=b.type&&"max"!=b.type&&(a=a.slice(0,c).concat(a.slice(c+1)),this.settings.set_conditional(this.type+"_scale",a),this.scale=a,this.update())}.bind(this)),p.exit().remove();var q=this.add_group.selectAll(".add").data(["add"]);q.enter().append("span").attr("class","add glyphicon glyphicon-plus"),q.on("click",function(d){if(!f){for(var e=(b.max+b.min)/2,g=h(c+2),i=0,l=0,m=a.length;m>l;l++){var n=j(a[l]);Math.abs(n-e)<g&&(e+=g,e>b.max-g&&(e=b.max-g),e<b.min+g&&(e=b.min+g)),e>n&&(i=l)}a.push({type:"value",value:e,color:a[i].color,size:a[i].size}),k(a)}}.bind(this)),q.exit().remove();var r=this.input_label_group.selectAll(".row-label").data(["Value:","Color:","Size:"]);r.enter().append("div").attr("class","row-label").style("height",this.input_height+"px").style("line-height",this.input_height+"px"),r.style("top",function(a,b){return 56+b*this.input_height+"px"}.bind(this)).text(function(a){return a}),r.exit().remove();var s=this.input_group.selectAll(".input-set").data(a),t=s.enter().append("div").attr("class","input-set");t.append("input").attr("class","domain-input").style("width",this.input_width+"px"),t.append("select").attr("class","domain-type-picker"),t.append("input").attr("class","color-input").style("width",this.input_width+"px"),t.append("input").attr("type","color").style("visibility",function(){return"text"==this.type?"hidden":null}).attr("class","color-picker"),t.append("input").attr("class","size-input").style("width",this.input_width+"px"),s.style("height",3*this.input_height+"px").style("width",this.input_width+"px").style("left",function(a){var d,f=j(a),h=c+2;return d="value"==a.type&&f<=b.min?g.invert(b.min)-c/2+e-h:"value"==a.type&&f>=b.max?g.invert(b.max)-c/2+e+h:g.invert(f)-c/2+e,d+this.input_width>this.w+this.x&&(d=d-this.input_width+c/2),d+"px"}.bind(this)).on("mousedown",i);var u=d3.format(".4g");s.select(".domain-input").style("height",this.input_height+"px").each(function(a,b){"value"==a.type?(this.value=j(a),this.disabled=!1):(this.value=a.type+" ("+u(j(a))+")",this.disabled=!0)}).on("change",function(b,d){var e=(h(c+2),parseFloat(this.value));a[d].value=e,k(a)});var v=s.select(".domain-type-picker"),w=["value"].concat(Object.keys(b)).filter(function(a){return"min"!=a&&"max"!=a}),x=v.selectAll("option").data(w);x.enter().append("option"),x.attr("value",function(a){return a}).text(function(a){return a}),x.exit().remove(),v.style("visibility",function(a){return"min"==a.type||"max"==a.type?"hidden":null}).style("left",this.input_width-20+"px").style("width","20px").each(function(a,b){var c=0;d3.select(this).selectAll("option").each(function(b,d){this.value==a.type&&(c=d)}),this.selectedIndex=c}).on("change",function(c,d){"value"==this.value&&(a[d].value=b[c.type]),a[d].type=this.value,k(a)}),s.select(".color-input").style("height",this.input_height+"px").style("top",this.input_height+"px").each(function(a,b){this.value=null===a.color?"":a.color,this.disabled=null===a.color}).on("change",function(b,c){a[c].color=this.value,k(a)}),s.select(".color-picker").style("left",this.input_width-this.input_height+"px").style("top",this.input_height+"px").style("width",this.input_height+"px").style("height",this.input_height+"px").each(function(a,b){this.value=null===a.color?"#dddddd":a.color,this.disabled=null===a.color}).on("change",function(b,c){a[c].color=this.value,k(a)}),s.select(".size-input").style("height",this.input_height+"px").style("top",2*this.input_height+"px").each(function(a,b){this.value=null===a.size?"":a.size,this.disabled=null===a.size}).on("change",function(b,c){a[c].size=parseFloat(this.value),k(a)}),s.exit().remove()}function f(){var a=this.no_data,b=this._data_not_loaded(),c=40,d=this.no_data_container.selectAll(".input-group").data([["color","Color:"],["size","Size:"]]),e=d.enter().append("div").attr("class","input-group");e.append("span"),e.append("input"),e.append("input").attr("type","color").style("visibility",function(a){return"text"==this.type||"color"!=a[0]?"hidden":null}).attr("class","color-picker"),d.select("span").text(function(a){return a[1]}).style("height",this.input_height+"px").style("line-height",this.input_height+"px").style("left",function(a,b){return(c+this.input_width+10)*b+"px"}.bind(this));(function(a){return this.settings.get_option(this.type+"_no_data_"+a)}).bind(this);d.select("input").style("left",function(a,b){return c+(c+this.input_width+10)*b+"px"}.bind(this)).style("height",this.input_height+"px").style("width",this.input_width+"px").each(function(c){this.value=b?"":a[c[0]],this.disabled=b}).on("change",function(a){var b=d3.event.target.value;"size"==a[0]&&(b=parseFloat(b)),this.no_data[a[0]]=b,this.settings.set_conditional(this.type+"_no_data_"+a[0],b),this.update_no_data()}.bind(this)),d.select(".color-picker").style("left",function(a,b){return(c+this.input_width)*(b+1)-this.input_height+"px"}.bind(this)).style("width",this.input_height+"px").style("height",this.input_height+"px").each(function(c,d){this.value=b?"#dddddd":a[c[0]],this.disabled=b}).on("change",function(a,b){var c=d3.event.target.value;this.no_data[a[0]]=c,this.settings.set_conditional(this.type+"_no_data_"+a[0],c),this.update_no_data()}.bind(this)),d.exit().remove()}function g(){var a=this.get_data_statistics()[this.type];return null===a.max||null===a.min}var h=a("./utils"),i=(a("baconjs"),h.make_class());i.prototype={init:d,update:e,update_no_data:f,_data_not_loaded:g},b.exports=i},{"./utils":31,baconjs:32}],17:[function(a,b,c){function d(a,b,c){var d=a.attr("class","search-container").style("display","none");this.input=d.append("input").attr("class","search-bar");var f=d.append("div").attr("class","btn-group btn-group-sm");f.append("button").attr("class","btn btn-default").on("click",this.previous.bind(this)).append("span").attr("class","glyphicon glyphicon-chevron-left"),f.append("button").attr("class","btn btn-default").on("click",this.next.bind(this)).append("span").attr("class","glyphicon glyphicon-chevron-right"),this.counter=d.append("div").attr("class","search-counter"),d.append("button").attr("class","btn btn-sm btn-default close-button").on("click",function(){this.toggle(!1)}.bind(this)).append("span").attr("class","glyphicon glyphicon-remove"),this.callback_manager=new l,this.selection=d,this.map=c,this.search_index=b,this.current=1,this.results=null;var g=function(a){this.current=1,this.results=e(this.search_index.find(a.value)),this.update()}.bind(this,this.input.node());this.input.on("input",k.debounce(g,200))}function e(a){return m.uniq(a,function(a){var b=o[a.type];return b[0]+a[b[1]]})}function f(){return"none"!==this.selection.style("display")}function g(a){void 0===a?this.is_active=!this.is_active:this.is_active=a,this.is_active?(this.selection.style("display",null),this.counter.text(""),this.input.node().value="",this.input.node().focus(),this.clear_escape=this.map.key_manager.add_escape_listener(function(){this.toggle(!1)}.bind(this),!0),this.clear_next=this.map.key_manager.add_key_listener(["enter","ctrl+g"],function(){this.next()}.bind(this),!1),this.clear_previous=this.map.key_manager.add_key_listener(["shift+enter","shift+ctrl+g"],function(){this.previous()}.bind(this),!1),this.callback_manager.run("show")):(this.map.highlight(null),this.selection.style("display","none"),this.results=null,this.clear_escape&&this.clear_escape(),this.clear_escape=null,this.clear_next&&this.clear_next(),this.clear_next=null,this.clear_previous&&this.clear_previous(),this.clear_previous=null,this.callback_manager.run("hide"))}function h(){if(null===this.results)this.counter.text(""),this.map.highlight(null);else if(0===this.results.length)this.counter.text("0 / 0"),this.map.highlight(null);else{this.counter.text(this.current+" / "+this.results.length);var a=this.results[this.current-1];if("reaction"==a.type)this.map.zoom_to_reaction(a.reaction_id),this.map.highlight_reaction(a.reaction_id);else if("metabolite"==a.type)this.map.zoom_to_node(a.node_id),this.map.highlight_node(a.node_id);else{if("text_label"!=a.type)throw new Error("Bad search index data type: "+a.type);this.map.zoom_to_text_label(a.text_label_id),this.map.highlight_text_label(a.text_label_id)}}}function i(){null!==this.results&&(this.current===this.results.length?this.current=1:this.current+=1,this.update())}function j(){null!==this.results&&(1===this.current?this.current=this.results.length:this.current-=1,this.update())}var k=a("./utils"),l=a("./CallbackManager"),m=a("underscore"),n=k.make_class();n.prototype={init:d,is_visible:f,toggle:g,update:h,next:i,previous:j},b.exports=n;var o={metabolite:["m","node_id"],reaction:["r","reaction_id"],text_label:["t","text_label_id"]}},{"./CallbackManager":5,"./utils":31,underscore:35}],18:[function(a,b,c){function d(){this.index={}}function e(a,b,c,d){if(!c&&a in this.index)throw new Error("id is already in the index");if(d&&!("name"in b&&"data"in b))throw new Error("malformed record");this.index[a]=b}function f(a){return a in this.index?(delete this.index[a],!0):!1}function g(a){var b=RegExp(a,"i"),c=[];for(var d in this.index){var e=this.index[d];b.exec(e.name)&&c.push(e.data)}return c}var h=a("./utils"),i=h.make_class();i.prototype={init:d,insert:e,remove:f,find:g},b.exports=i},{"./utils":31}],19:[function(a,b,c){function d(a,b,c){this.set_option=a,this.get_option=b,this.status_bus=new m.Bus,this.force_update_bus=new m.Bus,m.Observable.prototype.convert_to_conditional_stream=e,m.Observable.prototype.force_update_with_bus=f,this.busses={},this.streams={};for(var d=0,h=c.length;h>d;d++){var i=c[d],j=g(i,b(i),a,this.status_bus,this.force_update_bus);this.busses[i]=j.bus,this.streams[i]=j.stream}}function e(a){var b=a.map(function(a){return"hold"==a}).not().toProperty(!0),c=a.scan(!1,function(a,b){return 0==a&&("accepted"==b||"rejected"==b)}).not(),d=a.scan(!1,function(a,b){return 0==a&&"hold"==b}).not(),e=m.combineAsArray(this,a),f=e.scan([],function(a,b){if("hold"==b[1])return a.push(b[0]),a;if("accept"==b[1])return a;if("reject"==b[1])return[];if("rejected"==b[1]||"accepted"==b[1])return[b[0]];throw Error("bad status "+b[1])}).filter(b).filter(c).filter(d).flatMap(function(a){return m.fromArray(a)}),g=this.filter(b);return g.merge(f)}function f(a){return m.combineAsArray(this,a.toProperty(!1)).map(function(a){return a[0]})}function g(a,b,c,d,e){var f=new m.Bus,g=f.convert_to_conditional_stream(d).force_update_with_bus(e);return g.onValue(function(b){c(a,b)}),f.push(b),{bus:f,stream:g}}function h(a,b){if(!(a in this.busses))throw new Error("Invalid setting name");this.busses[a].push(b)}function i(){this.status_bus.push("hold")}function j(){this.status_bus.push("reject"),this.status_bus.push("rejected"),this.force_update_bus.push(!0)}function k(){this.status_bus.push("accept"),this.status_bus.push("accepted")}var l=a("./utils"),m=a("baconjs"),n=l.make_class();n.prototype={init:d,set_conditional:h,hold_changes:i,abandon_changes:j,accept_changes:k},b.exports=n},{"./utils":31,baconjs:32}],20:[function(a,b,c){"strict mode";function d(a,b,c,d){this.sel=a,this.settings=b,this.draw=!1;var e=this.settings.get_option("unique_map_id");this.unique_string=null===e?"":"."+e;var f=a.append("div").attr("class","settings-box-background").style("display","none"),g=f.append("div").attr("class","settings-box-container").style("display","none");g.append("button").attr("class","btn btn-sm btn-default settings-button").on("click",function(){this.accept_changes()}.bind(this)).append("span").attr("class","glyphicon glyphicon-ok"),g.append("button").attr("class","btn btn-sm btn-default settings-button settings-button-close").on("click",function(){this.abandon_changes()}.bind(this)).append("span").attr("class","glyphicon glyphicon-remove");var h=g.append("div").attr("class","settings-box");h.append("div").text("Tip: Hover over an option to see more details about it.").classed("settings-tip",!0),h.append("hr"),h.append("div").text("View and build options").attr("class","settings-section-heading-large"),this.view_gui(h.append("div")),h.append("hr"),h.append("div").text("Reactions").attr("class","settings-section-heading-large");var i=new n(h.append("div"),"reaction",this.settings,c.get_data_statistics.bind(c));c.callback_manager.set("calc_data_stats__reaction",function(a){a&&(i.update(),i.update_no_data())}),h.append("div").text("Reaction or Gene data").attr("class","settings-section-heading"),this.style_gui(h.append("div"),"reaction",function(a){d&&(d("reaction",a),i.update(),i.update_no_data())}),h.append("hr"),h.append("div").text("Metabolites").attr("class","settings-section-heading-large");var j=new n(h.append("div"),"metabolite",this.settings,c.get_data_statistics.bind(c));c.callback_manager.set("calc_data_stats__metabolite",function(a){a&&(j.update(),j.update_no_data())}),h.append("div").text("Metabolite data").attr("class","settings-section-heading"),this.style_gui(h.append("div"),"metabolite",function(a){d&&(d("metabolite",a),j.update(),j.update_no_data())}),this.callback_manager=new m,this.map=c,this.selection=g,this.background=f}function e(){return"none"!=this.selection.style("display")}function f(a){void 0===a&&(a=!this.is_visible()),a?(this.hold_changes(),this.selection.style("display","inline-block"),this.background.style("display","block"),this.selection.select("input").node().focus(),this.clear_escape=this.map.key_manager.add_escape_listener(function(){this.abandon_changes()}.bind(this),!0),this.clear_enter=this.map.key_manager.add_enter_listener(function(){this.accept_changes()}.bind(this),!0),this.callback_manager.run("show")):(this.draw&&this.map.draw_everything(),this.selection.style("display","none"),this.background.style("display","none"),this.clear_escape&&this.clear_escape(),this.clear_escape=null,this.clear_enter&&this.clear_enter(),this.clear_enter=null,this.callback_manager.run("hide"))}function g(){this.settings.hold_changes()}function h(){this.draw=!1,this.settings.abandon_changes(),this.toggle(!1)}function i(){this.sel.selectAll("input").each(function(a){this.blur()}),this.draw=!0,this.settings.accept_changes(),this.toggle(!1)}function j(a,b,c){var d=a.append("table").attr("class","settings-table"),e=this.settings;if(d.append("tr").call(function(a){a.append("td").text("Options:").attr("class","options-label").attr("title","Options for "+b+" data.");var d=a.append("td"),f=[["Absolute value","abs","If checked, use the absolute value when calculating colors and sizes of "+b+"s on the map"],["Size","size","If checked, then size the "+("metabolite"==b?"radius of metabolite circles ":"thickness of reaction lines ")+"according to the value of the "+b+" data"],["Color","color","If checked, then color the "+("metabolite"==b?"metabolite circles ":"reaction lines ")+"according to the value of the "+b+" data"],["Text (Show data in label)","text","If checked, then show data values in the "+b+" labels"]],g=d.selectAll(".option-group").data(f),h=g.enter().append("label").attr("class","option-group"),i=function(){var a=[];return d.selectAll("input").each(function(b){this.checked&&a.push(b[1])}),a};h.append("input").attr("type","checkbox").on("change",function(a){e.set_conditional(b+"_styles",i()),"abs"==a[1]&&c(this.checked)}).each(function(a){e.streams[b+"_styles"].onValue(function(b){this.checked=-1!=b.indexOf(a[1])}.bind(this))}),h.append("span").text(function(a){return a[0]}).attr("title",function(a){return a[2]})}),d.append("tr").call(function(a){a.append("td").text("Comparison:").attr("class","options-label").attr("title","The function that will be used to compare datasets, when paired data is loaded");var c=a.append("td").attr("title","The function that will be used to compare datasets, when paired data is loaded"),d=[["Fold Change","fold"],["Log2(Fold Change)","log2_fold"],["Difference","diff"]],f=c.selectAll(".option-group").data(d),g=f.enter().append("label").attr("class","option-group");g.append("input").attr("type","radio").attr("name",b+"_compare_style"+this.unique_string).attr("value",function(a){return a[1]}).on("change",function(){this.checked&&e.set_conditional(b+"_compare_style",this.value)}).each(function(){e.streams[b+"_compare_style"].onValue(function(a){this.checked=this.value==a}.bind(this))}),g.append("span").text(function(a){return a[0]})}.bind(this)),"reaction"==b){var d=a.append("table").attr("class","settings-table").attr("title","The function that will be used to evaluate AND connections in gene reaction rules (AND connections generally connect components of an enzyme complex)");d.append("tr").call(function(a){a.append("td").text("Method for evaluating AND:").attr("class","options-label-wide");var b=a.append("td"),c=[["Mean","mean"],["Min","min"]],d=b.selectAll(".option-group").data(c),f=d.enter().append("label").attr("class","option-group"),g="and_method_in_gene_reaction_rule";f.append("input").attr("type","radio").attr("name",g+this.unique_string).attr("value",function(a){return a[1]}).on("change",function(){this.checked&&e.set_conditional(g,this.value)}).each(function(){e.streams[g].onValue(function(a){this.checked=this.value==a}.bind(this))}),f.append("span").text(function(a){return a[0]})}.bind(this))}}function k(a,b,c,d){var e=this.settings,f=a.append("table").attr("class","settings-table");f.append("tr").call(function(a){a.attr("title","The identifiers that are show in the reaction, gene, and metabolite labels on the map."),a.append("td").text("Identifiers:").attr("class","options-label");var b=a.append("td"),c=[["ID's","bigg_id"],["Descriptive names","name"]],d=b.selectAll(".option-group").data(c),f=d.enter().append("label").attr("class","option-group"),g="identifiers_on_map";f.append("input").attr("type","radio").attr("name",g+this.unique_string).attr("value",function(a){return a[1]}).on("change",function(){this.checked&&e.set_conditional(g,this.value)}).each(function(){e.streams[g].onValue(function(a){this.checked=this.value==a}.bind(this))}),f.append("span").text(function(a){return a[0]})}.bind(this));var g=[["scroll_behavior","Scroll to zoom (instead of scroll to pan)","If checked, then the scroll wheel and trackpad will control zoom rather than pan.",{zoom:!0,pan:!1}],["hide_secondary_metabolites","Hide secondary metabolites","If checked, then only the primary metabolites will be displayed."],["show_gene_reaction_rules","Show gene reaction rules","If checked, then gene reaction rules will be displayed below each reaction label. (Gene reaction rules are always shown when gene data is loaded.)"],["hide_all_labels","Hide reaction, gene, and metabolite labels","If checked, hide all reaction, gene, and metabolite labels"],["allow_building_duplicate_reactions","Allow duplicate reactions","If checked, then allow duplicate reactions during model building."],["highlight_missing","Highlight reactions not in model","If checked, then highlight in red all the reactions on the map that are not present in the loaded model."]],h=a.append("div").attr("class","settings-container").selectAll(".option-group").data(g),i=h.enter().append("label").attr("class","option-group full-line");
i.append("input").attr("type","checkbox"),i.append("span"),h.attr("title",function(a){return a[2]}),h.select("input").on("change",function(a){if(a.length>=4){for(var b in a[3])if(a[3][b]==this.checked){e.set_conditional(a[0],b);break}}else e.set_conditional(a[0],this.checked)}).each(function(a){e.streams[a[0]].onValue(function(b){a.length>=4?this.checked=a[3][b]:this.checked=b}.bind(this))}),h.select("span").text(function(a){return a[1]}),h.exit().remove(),a.append("div").style("margin-top","16px").classed("settings-tip",!0).text("Tip: To increase map performance, turn off text boxes (i.e. labels and gene reaction rules).")}var l=a("./utils"),m=a("./CallbackManager"),n=a("./ScaleEditor"),o=l.make_class();o.prototype={init:d,is_visible:e,toggle:f,hold_changes:g,abandon_changes:h,accept_changes:i,style_gui:j,view_gui:k},b.exports=o},{"./CallbackManager":5,"./ScaleEditor":16,"./utils":31}],21:[function(a,b,c){function d(a,b,c){var d=a.append("div").attr("id","text-edit-input");this.placed_div=m(d,b),this.placed_div.hide(),this.input=d.append("input"),this.map=b,this.setup_map_callbacks(b),this.zoom_container=c,this.setup_zoom_callbacks(c)}function e(a){a.callback_manager.set("edit_text_label.text_edit_input",function(a,b){this.show(a,b)}.bind(this)),a.callback_manager.set("new_text_label.text_edit_input",function(a){null!==this.active_target&&this._accept_changes(this.active_target.target),this.hide(),this._add_and_edit(a)}.bind(this)),a.callback_manager.set("hide_text_label_editor.text_edit_input",function(){this.hide()}.bind(this))}function f(a){a.callback_manager.set("zoom.text_edit_input",function(){this.active_target&&this._accept_changes(this.active_target.target),this.hide()}.bind(this)),a.callback_manager.set("go_to.text_edit_input",function(){this.active_target&&this._accept_changes(this.active_target.target),this.hide()}.bind(this))}function g(){return this.placed_div.is_visible()}function h(a,b){this.active_target&&this._accept_changes(this.active_target.target),this.active_target={target:a,coords:b},a.each(function(a){this.input.node().value=a.text}.bind(this)),this.placed_div.place(b),this.input.node().focus(),this.clear_escape=this.map.key_manager.add_escape_listener(function(){this._accept_changes(a),this.hide()}.bind(this),!0),this.clear_enter=this.map.key_manager.add_enter_listener(function(a){this._accept_changes(a),this.hide()}.bind(this,a),!0)}function i(){this.placed_div.hide(),this.input.attr("value",""),this.active_target=null,this.clear_escape&&this.clear_escape(),this.clear_escape=null,this.clear_enter&&this.clear_enter(),this.clear_enter=null}function j(a){if(""==this.input.node().value)a.each(function(a){var b={};b[a.text_label_id]=this.map.text_labels[a.text_label_id],this.map.delete_selectable({},b,!0)}.bind(this));else{var b=[];a.each(function(a){this.map.edit_text_label(a.text_label_id,this.input.node().value,!0),b.push(a.text_label_id)}.bind(this))}}function k(a){var b=this.map.new_text_label(a,""),c=this.map.sel.select("#text-labels").selectAll(".text-label").filter(function(a){return a.text_label_id==b});c.select("text").classed("edit-text-cursor",!0),this.show(c,a)}var l=a("./utils"),m=a("./PlacedDiv"),n=(a("./build"),l.make_class());n.prototype={init:d,setup_map_callbacks:e,setup_zoom_callbacks:f,is_visible:g,show:h,hide:i,_accept_changes:j,_add_and_edit:k},b.exports=n},{"./PlacedDiv":13,"./build":24,"./utils":31}],22:[function(a,b,c){function d(){var a=40;this.stack=Array(a),this.current=-1,this.oldest=-1,this.newest=-1,this.end_of_stack=!0,this.top_of_stack=!0}function e(a,b){return a+1>b-1?0:a+1}function f(a,b){return 0>a-1?b-1:a-1}function g(a,b){this.current=e(this.current,this.stack.length),this.end_of_stack?this.oldest=this.current:this.oldest==this.current&&(this.oldest=e(this.oldest,this.stack.length)),this.stack[this.current]={undo:a,redo:b},this.newest=this.current,this.top_of_stack=!0,this.end_of_stack=!1}function h(){return this.end_of_stack?console.warn("End of stack."):(this.stack[this.current].undo(),this.current==this.oldest?this.end_of_stack=!0:this.current=f(this.current,this.stack.length),void(this.top_of_stack=!1))}function i(){return this.top_of_stack?console.warn("Top of stack."):(this.end_of_stack||(this.current=e(this.current,this.stack.length)),this.stack[this.current].redo(),this.current==this.newest&&(this.top_of_stack=!0),void(this.end_of_stack=!1))}var j=a("./utils"),k=j.make_class();k.prototype={init:d,push:g,undo:h,redo:i},b.exports=k},{"./utils":31}],23:[function(a,b,c){function d(a,b,c,d){a.classed("escher-container",!0),d&&(d3.select("html").classed("fill-screen",!0),d3.select("body").classed("fill-screen",!0),a.classed("fill-screen-div",!0));var e=a.append("div").attr("class","escher-zoom-container"),f=e.append("div").attr("class","escher-3d-transform-container"),g=f.append("svg").attr("class","escher-svg").attr("xmlns","http://www.w3.org/2000/svg");g.select(".zoom-g").remove();var h=g.append("g").attr("class","zoom-g");this.selection=a,this.zoom_container=e,this.css3_transform_container=f,this.svg=g,this.zoomed_sel=h,this.window_translate={x:0,y:0},this.window_scale=1,this._scroll_behavior=b,this._use_3d_transform=c,this._pan_drag_on=!0,this._zoom_behavior=null,this._zoom_timeout=null,this._svg_scale=this.window_scale,this._svg_translate=this.window_translate,this.callback_manager=new s,this._update_scroll()}function e(a){this._scroll_behavior=a,this._update_scroll()}function f(a){this._use_3d_transform=a}function g(a){t.isUndefined(a)?this._pan_drag_on=!this._pan_drag_on:this._pan_drag_on=a,this._pan_drag_on?(this.zoomed_sel.classed("cursor-grab",!0).classed("cursor-grabbing",!1),this.zoomed_sel.on("mousedown.cursor",function(a){a.classed("cursor-grab",!1).classed("cursor-grabbing",!0)}.bind(null,this.zoomed_sel)).on("mouseup.cursor",function(a){a.classed("cursor-grab",!0).classed("cursor-grabbing",!1)}.bind(null,this.zoomed_sel))):(this.zoomed_sel.style("cursor",null).classed("cursor-grab",!1).classed("cursor-grabbing",!1),this.zoomed_sel.on("mousedown.cursor",null),this.zoomed_sel.on("mouseup.cursor",null)),this._update_scroll()}function h(){if(!t.contains(["zoom","pan","none"],this._scroll_behavior))throw Error("Bad value for scroll_behavior: "+this._scroll_behavior);this.zoom_container.on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null).on("dblclick.zoom",null).on("mousewheel.escher",null).on("DOMMouseScroll.escher",null).on("wheel.escher",null).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null);try{this._zoom_behavior=d3.behavior.zoom().on("zoom",function(){this.go_to(d3.event.scale,{x:d3.event.translate[0],y:d3.event.translate[1]})}.bind(this))}catch(a){return console.log("Not in a browser, so d3.behavior.zoom does not work."),void(this._zoom_behavior=null)}if(this._zoom_behavior.scale(this.window_scale),this._zoom_behavior.translate([this.window_translate.x,this.window_translate.y]),this.zoom_container.call(this._zoom_behavior),this.zoom_container.on("dblclick.zoom",null),this._pan_drag_on||this.zoom_container.on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),"zoom"!==this._scroll_behavior&&this.zoom_container.on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),"pan"===this._scroll_behavior){var b=function(){var a=d3.event,b=.5;a.stopPropagation(),a.preventDefault(),a.returnValue=!1;var c=function(a,c){var d=t.isUndefined(a)?c:-a/1.5;return d*b},d={x:this.window_translate.x-c(a.wheelDeltaX,a.deltaX),y:this.window_translate.y-c(a.wheelDeltaY,a.deltaY)};this.go_to(this.window_scale,d)}.bind(this);this.zoom_container.on("mousewheel.escher",b),this.zoom_container.on("DOMMouseScroll.escher",b),this.zoom_container.on("wheel.escher",b)}}function i(a,b){r.check_undefined(arguments,["scale","translate"]);var c=this._use_3d_transform;if(!a)throw new Error("Bad scale value");if(!b||!("x"in b)||!("y"in b)||isNaN(b.x)||isNaN(b.y))return console.error("Bad translate value");if(this.window_scale=a,this.window_translate=b,!t.isNull(this._zoom_behavior)){this._zoom_behavior.scale(a);var d=[b.x,b.y];this._zoom_behavior.translate(d)}c?(t.isNull(this._zoom_timeout)||clearTimeout(this._zoom_timeout),this._go_to_3d(a,b,this._svg_scale,this._svg_translate),this._zoom_timeout=t.delay(function(){this._go_to_svg(a,b)}.bind(this),100)):this._go_to_svg(a,b),this.callback_manager.run("go_to")}function j(a,b,c,d){var e=a/c,f=r.c_minus_c(b,r.c_times_scalar(d,e)),g="translate("+f.x+"px,"+f.y+"px) scale("+e+")";this.css3_transform_container.style("transform",g),this.css3_transform_container.style("-webkit-transform",g),this.css3_transform_container.style("transform-origin","0 0"),this.css3_transform_container.style("-webkit-transform-origin","0 0")}function k(){this.css3_transform_container.style("transform",null),this.css3_transform_container.style("-webkit-transform",null),this.css3_transform_container.style("transform-origin",null),this.css3_transform_container.style("-webkit-transform-origin",null)}function l(a,b,c){this.callback_manager.run("svg_start"),t.defer(function(){this._clear_3d(),this.zoomed_sel.attr("transform","translate("+b.x+","+b.y+") scale("+a+")"),this._svg_scale=this.window_scale,this._svg_translate=this.window_translate,t.defer(function(){this.callback_manager.run("svg_finish"),t.isUndefined(c)||c()}.bind(this))}.bind(this))}function m(a){var b=this.get_size(),c={x:b.width/2-((b.width/2-this.window_translate.x)*a+this.window_translate.x),y:b.height/2-((b.height/2-this.window_translate.y)*a+this.window_translate.y)};this.go_to(this.window_scale*a,r.c_plus_c(this.window_translate,c))}function n(){this.zoom_by(1.5)}function o(){this.zoom_by(.667)}function p(){return{width:parseInt(this.selection.style("width"),10),height:parseInt(this.selection.style("height"),10)}}function q(a){var b=120,c=this.get_size(),d={x:{min:-this.window_translate.x/this.window_scale+b/this.window_scale,max:-this.window_translate.x/this.window_scale+(c.width-b)/this.window_scale},y:{min:-this.window_translate.y/this.window_scale+b/this.window_scale,max:-this.window_translate.y/this.window_scale+(c.height-b)/this.window_scale}};a.x<d.x.min?(this.window_translate.x=this.window_translate.x-(a.x-d.x.min)*this.window_scale,this.go_to(this.window_scale,this.window_translate)):a.x>d.x.max&&(this.window_translate.x=this.window_translate.x-(a.x-d.x.max)*this.window_scale,this.go_to(this.window_scale,this.window_translate)),a.y<d.y.min?(this.window_translate.y=this.window_translate.y-(a.y-d.y.min)*this.window_scale,this.go_to(this.window_scale,this.window_translate)):a.y>d.y.max&&(this.window_translate.y=this.window_translate.y-(a.y-d.y.max)*this.window_scale,this.go_to(this.window_scale,this.window_translate))}var r=a("./utils"),s=a("./CallbackManager"),t=a("underscore"),u=r.make_class();u.prototype={init:d,set_scroll_behavior:e,set_use_3d_transform:f,_update_scroll:h,toggle_pan_drag:g,go_to:i,_go_to_3d:j,_clear_3d:k,_go_to_svg:l,zoom_by:m,zoom_in:n,zoom_out:o,get_size:p,translate_off_screen:q},b.exports=u},{"./CallbackManager":5,"./utils":31,underscore:35}],24:[function(a,b,c){function d(a,b,c,d,f,g,i,j){j=Math.PI/180*j;var k,l=String(++g.reactions),o={x:f.x,y:f.y},p=300,q=[o,n.c_plus_c(o,{x:p,y:0})],r={x:(q[0].x+q[1].x)/2,y:(q[0].y+q[1].y)/2};k=Math.abs(j)<Math.PI/4||Math.abs(j-Math.PI)<Math.PI/4?{x:-50,y:-40}:{x:30,y:10};var s=20,t=n.clone(b);n.extend(t,{label_x:r.x+k.x,label_y:r.y+k.y,segments:{}});var u=[],v=[],w=0,x=0,y=!1;for(var z in t.metabolites){var A=c[z],B=t.metabolites[z],C=A.formula,D={coefficient:B,bigg_id:z,name:A.name};if(0>B){D.index=w;var E=/C([0-9]+)/.exec(C);f.bigg_id==D.bigg_id?u.push([D.index,1/0]):E&&-1==i.indexOf(n.decompartmentalize(D.bigg_id)[0])&&u.push([D.index,parseInt(E[1])]),w++}else{D.index=x;var E=/C([0-9]+)/.exec(C);f.bigg_id==D.bigg_id?(v.push([D.index,1/0]),y=!0):E&&-1==i.indexOf(n.decompartmentalize(D.bigg_id)[0])&&v.push([D.index,parseInt(E[1])]),x++}t.metabolites[z]=D}var F=function(a,b){return b[1]>a[1]?b:a},G=u.reduce(F,[0,0])[0],H=v.reduce(F,[0,0])[0];for(var z in t.metabolites){var A=t.metabolites[z];A.coefficient<0?(A.index==G&&(A.is_primary=!0),A.count=w+1):(A.index==H&&(A.is_primary=!0),A.count=x+1)}var I={},J=[{node_type:"anchor_reactants",dis:{x:s*(y?1:-1),y:0}},{node_type:"center",dis:{x:0,y:0}},{node_type:"anchor_products",dis:{x:s*(y?-1:1),y:0}}],K={};J.map(function(a){var b=String(++g.nodes),c="center"==a.node_type?"midmarker":"multimarker";I[b]={node_type:c,x:r.x+a.dis.x,y:r.y+a.dis.y,connected_segments:[],name:null,bigg_id:null,label_x:null,label_y:null,node_is_primary:null},K[a.node_type]=b});var L=[[K.anchor_reactants,K.center],[K.anchor_products,K.center]];L.map(function(a){var b=a[0],c=a[1],d=String(++g.segments);t.segments[d]={b1:null,b2:null,from_node_id:b,to_node_id:c,from_node_coefficient:null,to_node_coefficient:null,reversibility:t.reversibility,data:t.data,reverse_flux:t.reverse_flux},I[b].connected_segments.push({segment_id:d,reaction_id:l}),I[c].connected_segments.push({segment_id:d,reaction_id:l})});var M=I;for(var z in t.metabolites){var N,O,A=t.metabolites[z];A.coefficient<0?(N=G,O=K.anchor_reactants):(N=H,O=K.anchor_products);var P=h(A,N,q,r,p,y);if(f.bigg_id==A.bigg_id){var Q=String(++g.segments);t.segments[Q]={b1:P.b1,b2:P.b2,from_node_id:O,to_node_id:d,from_node_coefficient:null,to_node_coefficient:A.coefficient,reversibility:t.reversibility,data:t.data,reverse_flux:t.reverse_flux},f.connected_segments.push({segment_id:Q,reaction_id:l}),M[O].connected_segments.push({segment_id:Q,reaction_id:l})}else{var Q=String(++g.segments),R=String(++g.nodes);t.segments[Q]={b1:P.b1,b2:P.b2,from_node_id:O,to_node_id:R,from_node_coefficient:null,to_node_coefficient:A.coefficient,reversibility:t.reversibility,data:t.data,reverse_flux:t.reverse_flux},M[R]={connected_segments:[{segment_id:Q,reaction_id:l}],x:P.circle.x,y:P.circle.y,node_is_primary:Boolean(A.is_primary),label_x:P.circle.x+k.x,label_y:P.circle.y+k.y,name:A.name,bigg_id:A.bigg_id,node_type:"metabolite"},M[O].connected_segments.push({segment_id:Q,reaction_id:l})}}var S=[];for(var a in t.metabolites)S.push({bigg_id:a,coefficient:t.metabolites[a].coefficient});t.metabolites=S;var T={};T[l]=t;var U=m(T);return M[d]=f,e(M,T,U,j,o),{new_reactions:T,new_beziers:U,new_nodes:M}}function e(a,b,c,d,e){var f=function(a){return null===a?null:n.rotate_coords(a,d,e)},h=[],i=[];for(var k in a){var l=a[k],m=f({x:l.x,y:l.y}),o=g(l,b,m);l.connected_segments.map(function(a){var d=b[a.reaction_id];if(void 0!==d){var e=a.segment_id,g=d.segments[e];if(g.to_node_id==k&&g.b2){var h=f(g.b2),i=j(e,"b2");g.b2=n.c_plus_c(g.b2,h),c[i].x=g.b2.x,c[i].y=g.b2.y}else if(g.from_node_id==k&&g.b1){var h=f(g.b1),i=j(e,"b1");g.b1=n.c_plus_c(g.b1,h),c[i].x=g.b1.x,c[i].y=g.b1.y}}}),i=n.unique_concat([i,o.reaction_ids]),h.push(k)}return{node_ids:h,reaction_ids:i}}function f(a,b,c,d,e){var f=g(a,c,e);return a.connected_segments.map(function(a){var g=c[a.reaction_id];if(void 0!==g){var h=a.segment_id,i=g.segments[h];[["b1","from_node_id"],["b2","to_node_id"]].forEach(function(a){var c=a[0],f=a[1];if(i[f]==b&&i[c]){i[c]=n.c_plus_c(i[c],e);var g=d[j(h,c)];g.x=i[c].x,g.y=i[c].y}}),f.reaction_ids.indexOf(a.reaction_id)<0&&f.reaction_ids.push(a.reaction_id)}}),f}function g(a,b,c){a.x=a.x+c.x,a.y=a.y+c.y,a.label_x=a.label_x+c.x,a.label_y=a.label_y+c.y;var d=[];return a.connected_segments.map(function(e){var f=b[e.reaction_id];d.indexOf(e.reaction_id)<0&&(d.push(e.reaction_id),"midmarker"==a.node_type&&(f.label_x=f.label_x+c.x,f.label_y=f.label_y+c.y))}),{reaction_ids:d}}function h(a,b,c,d,e,f){var g,h,i=c[0],c=[n.c_minus_c(c[0],i),n.c_minus_c(c[1],i)],d=n.c_minus_c(d,i),j=80,k=.4,l=.25,m=.7*j,o=40,p=Math.min(2,a.count-1);a.is_primary?g=20:(g=10,h=a.index>b?a.index-1:a.index);var q,r,s,t,u=e-g,v=[{x:g,y:0},{x:u,y:0}];a.coefficient<0!=f&&a.is_primary?(q={x:v[0].x,y:v[0].y},s={x:d.x*(1-k)+v[0].x*k,y:d.y*(1-k)+v[0].y*k},t={x:d.x*l+q.x*(1-l),y:d.y*l+q.y*(1-l)},r={x:c[0].x,y:c[0].y}):a.coefficient<0!=f?(q={x:v[0].x+o,y:v[0].y+(m*h-m*(p-1)/2)},s={x:d.x*(1-k)+v[0].x*k,y:d.y*(1-k)+v[0].y*k},t={x:d.x*l+q.x*(1-l),y:d.y*l+q.y*(1-l)},r={x:c[0].x+o,y:c[0].y+(j*h-j*(p-1)/2)}):a.coefficient>0!=f&&a.is_primary?(q={x:v[1].x,y:v[1].y},s={x:d.x*(1-k)+v[1].x*k,y:d.y*(1-k)+v[1].y*k},t={x:d.x*l+q.x*(1-l),y:d.y*l+q.y*(1-l)},r={x:c[1].x,y:c[1].y}):a.coefficient>0!=f&&(q={x:v[1].x-o,y:v[1].y+(m*h-m*(p-1)/2)},s={x:d.x*(1-k)+v[1].x*k,y:d.y*(1-k)+v[1].y*k},t={x:d.x*l+q.x*(1-l),y:d.y*l+q.y*(1-l)},r={x:c[1].x-o,y:c[1].y+(j*h-j*(p-1)/2)});var w={};return w.b1=n.c_plus_c(i,s),w.b2=n.c_plus_c(i,t),w.circle=n.c_plus_c(i,r),w}function i(a,b,c){var d=String(++a.text_labels),e={text:b,x:c.x,y:c.y};return{id:d,label:e}}function j(a,b){return a+"_"+b}function k(a){var b=[];for(var c in a){var d=a[c];for(var e in d.segments){var f=d.segments[e];["b1","b2"].forEach(function(a){var c=f[a];null!==c&&b.push(j(e,a))})}}return b}function l(a,b){var c={};for(var d in a){var e=a[d];["b1","b2"].forEach(function(a){var f=e[a];if(null!==f){var g=j(d,a);c[g]={bezier:a,x:f.x,y:f.y,reaction_id:b,segment_id:d}}})}return c}function m(a){var b={};for(var c in a){var d=a[c],e=l(d.segments,c);n.extend(b,e)}return b}var n=a("./utils");b.exports={new_reaction:d,rotate_nodes:e,move_node_and_dependents:f,new_text_label:i,bezier_id_for_segment_id:j,bezier_ids_for_reaction_ids:k,new_beziers_for_segments:l,new_beziers_for_reactions:m}},{"./utils":31}],25:[function(a,b,c){var d=a("./utils");b.exports=function(a,b){function c(a){return void 0===m&&(m=document.createElement("span"),m.style.visibility="hidden",m.style.position="fixed",m.style.outline="0",m.style.margin="0",m.style.padding="0",m.style.border="0",m.style.left="0",m.style.whiteSpace="pre",m.style.fontSize=b.fontSize,m.style.fontFamily=b.fontFamily,m.style.fontWeight="normal",document.body.appendChild(m)),m.innerHTML=String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),m.getBoundingClientRect().right}document=d.get_document(a),window=d.get_window(a),b=b||{},b.fontSize=b.fontSize||"13px",b.fontFamily=b.fontFamily||"sans-serif",b.promptInnerHTML=b.promptInnerHTML||"",b.color=b.color||"#333",b.hintColor=b.hintColor||"#aaa",b.backgroundColor=b.backgroundColor||"#fff",b.dropDownBorderColor=b.dropDownBorderColor||"#aaa",b.dropDownZIndex=b.dropDownZIndex||"100",b.dropDownOnHoverBackgroundColor=b.dropDownOnHoverBackgroundColor||"#ddd";var e=document.createElement("input");e.type="text",e.spellcheck=!1,e.style.fontSize=b.fontSize,e.style.fontFamily=b.fontFamily,e.style.color=b.color,e.style.backgroundColor=b.backgroundColor,e.style.width="100%",e.style.outline="0",e.style.border="0",e.style.margin="0",e.style.padding="0";var f=e.cloneNode();f.disabled="",f.style.position="absolute",f.style.top="0",f.style.left="0",f.style.borderColor="transparent",f.style.boxShadow="none",f.style.color=b.hintColor,e.style.backgroundColor="transparent",e.style.verticalAlign="top",e.style.position="relative";var g=document.createElement("div");g.style.position="relative",g.style.outline="0",g.style.border="0",g.style.margin="0",g.style.padding="0";var h=document.createElement("div");if(h.style.position="absolute",h.style.outline="0",h.style.margin="0",h.style.padding="0",h.style.border="0",h.style.fontSize=b.fontSize,h.style.fontFamily=b.fontFamily,h.style.color=b.color,h.style.backgroundColor=b.backgroundColor,h.style.top="0",h.style.left="0",h.style.overflow="hidden",h.innerHTML=b.promptInnerHTML,h.style.background="transparent",void 0===document.body)throw"document.body is undefined. The library was wired up incorrectly.";document.body.appendChild(h);var i=h.getBoundingClientRect().right;g.appendChild(h),h.style.visibility="visible",h.style.left="-"+i+"px",g.style.marginLeft=i+"px",g.appendChild(f),g.appendChild(e);var j=document.createElement("div");j.style.position="absolute",j.style.visibility="hidden",j.style.outline="0",j.style.margin="0",j.style.padding="0",j.style.textAlign="left",j.style.fontSize=b.fontSize,j.style.fontFamily=b.fontFamily,j.style.backgroundColor=b.backgroundColor,j.style.zIndex=b.dropDownZIndex,j.style.cursor="default",j.style.borderStyle="solid",j.style.borderWidth="1px",j.style.borderColor=b.dropDownBorderColor,j.style.overflowX="hidden",j.style.whiteSpace="pre",j.style.overflowY="scroll";var k=function(a){var c=[],d=0,e=-1,f=null,g=function(){this.style.outline="1px solid #ddd"},h=function(){this.style.outline="0"},i=function(a){a.preventDefault(),j.onmouseselection(this.id)},j={hide:function(){a.style.visibility="hidden"},refresh:function(e,f){a.style.visibility="hidden",d=0,a.innerHTML="";var k=window.innerHeight||document.documentElement.clientHeight,l=a.parentNode.getBoundingClientRect(),m=l.top-6,n=k-l.bottom-6;c=[];for(var o=0;o<f.length;o++){var q=f[o].matches.filter(function(a){return 0==a.toLowerCase().indexOf(e.toLowerCase())});if(0!=q.length){var r=document.createElement("div");if(r.style.color=b.color,r.onmouseover=g,r.onmouseout=h,r.onmousedown=function(a){a.preventDefault()},r.ondblclick=i,r.__hint=q[0],r.id=f[o].id,r.innerHTML=f[o].html,c.push(r),a.appendChild(r),c.length>=p.display_limit){var s=document.createElement("div");s.innerHTML=" "+(f.length-c.length)+" more",c.push(s),a.appendChild(s);break}}}0!==c.length&&(j.highlight(0),m>3*n?(a.style.maxHeight=m+"px",a.style.top="",a.style.bottom="100%"):(a.style.top="100%",a.style.bottom="",a.style.maxHeight=n+"px"),a.style.visibility="visible")},highlight:function(a){-1!=e&&c[e]&&(c[e].style.backgroundColor=b.backgroundColor),c[a].style.backgroundColor=b.dropDownOnHoverBackgroundColor,e=a,f=c[a]},move:function(b){return"hidden"===a.style.visibility?"":d+b===-1||d+b===c.length?c[d].__hint:(d+=b,j.highlight(d),c[d].__hint)},onmouseselection:function(){},get_current_row:function(){return f}};return j},l=k(j);l.onmouseselection=function(a){p.onEnter(a),p.input.focus()},g.appendChild(j),a.appendChild(g);var m,n,o,p={get_hint:function(a){return a},display_limit:1e3,onArrowDown:function(){},onArrowUp:function(){},onEnter:function(){},onTab:function(){},onChange:function(){p.repaint()},startFrom:0,options:[],wrapper:g,input:e,hint:f,dropDown:j,prompt:h,setText:function(a){f.value=a,e.value=a},getText:function(){return e.value},hideDropDown:function(){l.hide()},repaint:function(){var a=e.value,b=p.startFrom,d=p.options,g=d.length,h=a.substring(b);n=a.substring(0,b),f.value="";for(var i=0;g>i;i++){var k=d[i].matches.filter(function(a){return 0==a.toLowerCase().indexOf(h.toLowerCase())});if(0!=k.length){f.value=p.get_hint(k[0]);break}}j.style.left=c(n)+"px",l.refresh(h,p.options)}},q=function(a,b){o=a.value;var c=function(){var c=a.value;o!==c&&(o=c,b(c))};a.addEventListener("input",c,!1),a.addEventListener("keyup",c,!1),a.addEventListener("change",c,!1)};q(e,function(a){p.onChange(a),p.repaint()});var r=function(a){a=a||window.event;var b=a.keyCode;if(33!=b&&34!=b)if(39!=b&&35!=b&&9!=b){if(13==b){var c=l.get_current_row().id;return void p.onEnter(c)}if(40==b){var d=l.move(1);return""==d&&p.onArrowDown(),void(f.value=p.get_hint(d))}if(38==b){var d=l.move(-1);return""==d&&p.onArrowUp(),f.value=p.get_hint(d),a.preventDefault(),void a.stopPropagation()}f.value=""}else if(9==b&&(a.preventDefault(),a.stopPropagation(),0==f.value.length&&p.onTab()),f.value.length>0){e.value=f.value;var g=o!=e.value;o=e.value,g&&p.onChange(e.value)}};return e.addEventListener("keydown",r,!1),p}},{"./utils":31}],26:[function(a,b,c){function d(a,b,c){function d(a,b){var c={},d=[null];for(var e in a){d=a[e].map(function(){return null});break}for(var f in b){var g=b[f],h=g.bigg_id,i={};g.genes.forEach(function(b){["bigg_id","name"].forEach(function(c){var e=a[b[c]]||q.clone(d),f=i[b.bigg_id];if("undefined"==typeof f)i[b.bigg_id]=e;else for(var g=0;g<e.length;g++){var h=e[g];null!==h&&(f[g]=h)}})}),c[h]=i}return c}if(null===a)return null;if(-1==["reaction_data","metabolite_data","gene_data"].indexOf(b))throw new Error("Invalid name argument: "+b);a instanceof Array||(a=[a]);var e=function(){return null===a?null:1==a.length?null:2==a.length?null:console.warn("Bad data style: "+b)};if(e(),a=q.array_to_object(a),"gene_data"==b){if(void 0===c)throw new Error("Must pass all_reactions argument for gene_data");a=d(a,c)}return a}function e(a,b,c){function d(a){return isFinite(a)?a:null}function e(a,b){return b?Math.abs(a):a}function f(a,b,c){return c?Math.abs(b-a):b-a}function g(a,b,c){if(0==a||0==b)return null;var d=b>=a?b/a:-a/b;return c?Math.abs(d):d}function h(a,b,c){if(0==a)return null;if(0>b/a)return null;var d=Math.log(b/a)/Math.log(2);return c?Math.abs(d):d}if(null===a)return null;var i=-1!=b.indexOf("abs");if(1==a.length){var j=p(a[0]);return null===j?null:e(j,i)}if(2!=a.length)throw new Error("Data array must be of length 1 or 2");var k=a.map(p);if(null===k[0]||null===k[1])return null;if("diff"==c)return f(k[0],k[1],i);if("fold"==c)return d(g(k[0],k[1],i));if("log2_fold"==c)return d(h(k[0],k[1],i));throw new Error("Bad data compare_style: "+c)}function f(a){return null===a||null===a[0]?!1:a[0]<0}function g(a,b,c,d,f,g){function h(a,b){return null===a?"nd":b(a)}var i=a,j=null===b,k={};c.forEach(function(a){var c=a.bigg_id;if(!(c in k))if(k[c]=!0,j)i=l(i,c,c+"\n");else{if(!(c in b))return;var f=b[c],m=e(f,d,g),n=null===m?s:d3.format(".3g");if(1===f.length)i=l(i,c,c+" ("+h(f[0],n)+")\n");else if(2===f.length){var o,q=r.any(f,function(a){return null!==p(a)});o=q?c+" ("+h(f[0],n)+", "+h(f[1],n)+": "+h(m,n)+")\n":c+" ("+h(f[0],n)+", "+h(f[1],n)+")\n",i=l(i,c,o)}}}),i=i.replace(u,"\n").replace(v,"$1");var m=i.split("\n").map(function(a){for(var b=0,d=c.length;d>b;b++){var e=c[b];if(-1!==a.indexOf(e.bigg_id))return"name"===f&&(a=l(a,e.bigg_id,e.name)),{bigg_id:e.bigg_id,name:e.name,text:a}}return{bigg_id:null,name:null,text:a}});return m}function h(a,b){function c(a,b){return null===a?"(nd)":b(a)}if(null===a)return c(null);if(1==a.length){var d=null===b?s:d3.format(".3g");return c(a[0],d)}if(2==a.length){var d=null===b?s:d3.format(".3g"),e=c(a[0],d);return e+=", "+c(a[1],d),e+=": "+c(b,d)}return""}function i(a){var b=a[0].length,c=[];if(2>b||b>3)throw new Error("CSV file must have 2 or 3 columns");for(var d=1;b>d;d++)c[d-1]={};return a.slice(1).forEach(function(a){for(var b=1,d=a.length;d>b;b++)c[b-1][a[0]]=a[b]}),c}function j(a){var b=a.replace(w,"$1$2").replace(x,"").split(" ").filter(function(a){return""!=a});return q.unique_strings_array(b)}function k(a,b,c){var d=[null],e=1;for(var f in b){d=b[f].map(function(){return null}),e=d.length;break}if(""==a)return q.clone(d);for(var g=[],h=0;e>h;h++){var i=a,j=!0;for(var f in b){var k=p(b[f][h]);null===k?k=0:j=!1,i=l(i,f,k)}if(j)g.push(null);else{for(;;){var m=i;if(m=m.replace(y," $1 "),m=m.replace(B,function(a,b,c,d){var e=c.split(z).map(parseFloat),f=e.reduce(function(a,b){return a+b});return b+f+d}),m=m.replace(C,function(a,b,d,e){var f=d.split(A).map(parseFloat),g="min"==c?Math.min.apply(null,f):f.reduce(function(a,b){return a+b})/f.length;return b+g+e}),m==i)break;i=m}var n=Number(i);isNaN(n)?(console.warn("Could not evaluate "+a),g.push(null)):g.push(n)}}return g}function l(a,b,c){function d(a){return a.replace(t,"\\$1")}var e="(^|[\\s\\(\\)])",f="([\\s\\(\\)]|$)",g=e+d(b)+f;return a.replace(new RegExp(g,"g"),"$1"+c+"$2")}function m(a,b,c,d){var g,i,j,k;if(null===b){for(g in a){i=a[g],i.data=null,i.data_string="";for(j in i.segments)k=i.segments[j],k.data=null;i.gene_string=null}return!1}for(g in a){i=a[g];var l=b[i.bigg_id]||b[i.name]||null,m=e(l,c,d),n=f(l),o=h(l,m);i.data=m,i.data_string=o,i.reverse_flux=n,i.gene_string=null;for(j in i.segments)k=i.segments[j],k.data=i.data,k.reverse_flux=i.reverse_flux}return!0}function n(a,b,c,d){var f;if(null===b){for(f in a)a[f].data=null,a[f].data_string="";return!1}for(f in a){var g=a[f],i=b[g.bigg_id]||b[g.name]||null,j=e(i,c,d),k=h(i,j);g.data=j,g.data_string=k}return!0}function o(a,b,c,d,i,j){if(null===b){for(var l in a){var m=a[l];m.data=null,m.data_string="",m.reverse_flux=!1;for(var n in m.segments){var o=m.segments[n];o.data=null}m.gene_string=null}return!1}var p=[null];for(var l in b){for(var r in b[l]){p=b[l][r].map(function(){return null});break}break}for(var l in a){var s,t,m=a[l],u=m.gene_reaction_rule,v=b[m.bigg_id];"undefined"!=typeof v?(t=v,s=k(u,t,j)):(t={},s=q.clone(p));var w=e(s,c,i),x=f(s),y=h(s,w);m.data=w,m.data_string=y,m.reverse_flux=x;for(var n in m.segments){var o=m.segments[n];o.data=m.data,o.reverse_flux=m.reverse_flux}m.gene_string=g(u,t,m.genes,c,d,i)}return!0}function p(a){var b=Number(a);return isNaN(b)||parseFloat(a)!=b?null:b}var q=a("./utils"),r=a("underscore");b.exports={import_and_check:d,text_for_data:h,float_for_data:e,reverse_flux_for_data:f,gene_string_for_data:g,csv_converter:i,genes_for_gene_reaction_rule:j,evaluate_gene_reaction_rule:k,replace_gene_in_rule:l,apply_reaction_data_to_reactions:m,apply_metabolite_data_to_nodes:n,apply_gene_data_to_reactions:o};var s=function(a){return a},t=/([.*+?^=!:${}()|\[\]\/\\])/g,u=/\n\s*\n/g,v=/\n\s*(\)*)\s*$/,w=/([\(\) ])(?:and|or)([\)\( ])/gi,x=/[\(\)]/g,y=/\(\s*(\S+)\s*\)/g,z=/\s+or\s+/i,A=/\s+and\s+/i,B=/(^|\()(\s*-?[0-9.]+\s+(?:or\s+-?[0-9.]+\s*)+)(\)|$)/gi,C=/(^|\(|or\s)(\s*-?[0-9.]+\s+(?:and\s+-?[0-9.]+\s*)+)(\sor|\)|$)/gi},{"./utils":31,underscore:35}],27:[function(a,b,c){b.exports={version:"1.5.0",builder_embed:"svg.escher-svg .gene-label,svg.escher-svg .label{text-rendering:optimizelegibility;cursor:default}svg.escher-svg #mouse-node{fill:none}svg.escher-svg #canvas{stroke:#ccc;stroke-width:7px;fill:#fff}svg.escher-svg .resize-rect{fill:#000;opacity:0;stroke:none}svg.escher-svg .label{font-family:sans-serif;font-style:italic;font-weight:700;font-size:8px;fill:#000;stroke:none}svg.escher-svg .reaction-label{font-size:30px;fill:#202078;text-rendering:optimizelegibility}svg.escher-svg .node-label{font-size:20px}svg.escher-svg .gene-label{font-size:18px;fill:#202078}svg.escher-svg .text-label .label,svg.escher-svg .text-label-input{font-size:50px}svg.escher-svg .node-circle{stroke-width:2px}svg.escher-svg .midmarker-circle,svg.escher-svg .multimarker-circle{fill:#fff;fill-opacity:.2;stroke:#323232}svg.escher-svg g.selected .node-circle{stroke-width:6px;stroke:#1471c7}svg.escher-svg g.selected .label{fill:#1471c7}svg.escher-svg .metabolite-circle{stroke:#a24510;fill:#e0865b}svg.escher-svg g.selected .metabolite-circle{stroke:#050200}svg.escher-svg .segment{stroke:#334E75;stroke-width:10px;fill:none}svg.escher-svg .arrowhead{fill:#334E75}svg.escher-svg .stoichiometry-label-rect{fill:#fff;opacity:.5}svg.escher-svg .stoichiometry-label{fill:#334E75;font-size:17px}svg.escher-svg .membrane{fill:none;stroke:#fb0}svg.escher-svg .brush .extent{fill-opacity:.1;fill:#000;stroke:#fff;shape-rendering:crispEdges}svg.escher-svg #brush-container .background{fill:none}svg.escher-svg .bezier-circle{fill:#fff}svg.escher-svg .bezier-circle.b1{stroke:red}svg.escher-svg .bezier-circle.b2{stroke:#00f}svg.escher-svg .connect-line{stroke:#c8c8c8}svg.escher-svg .direction-arrow{stroke:#000;stroke-width:1px;fill:#fff;opacity:.3}svg.escher-svg .start-reaction-cursor{cursor:pointer}svg.escher-svg .start-reaction-target{stroke:#646464;fill:none;opacity:.5}svg.escher-svg .rotation-center-line{stroke:red;stroke-width:5px}svg.escher-svg .highlight{fill:#D97000;text-decoration:underline}svg.escher-svg .cursor-grab{cursor:grab;cursor:-webkit-grab}svg.escher-svg .cursor-grabbing{cursor:grabbing;cursor:-webkit-grabbing}svg.escher-svg .edit-text-cursor{cursor:text}"}},{}],28:[function(a,b,c){b.exports={version:a("./inline").version,Builder:a("./Builder"),Map:a("./Map"),Behavior:a("./Behavior"),KeyManager:a("./KeyManager"),DataMenu:a("./DataMenu"),UndoStack:a("./UndoStack"),CobraModel:a("./CobraModel"),utils:a("./utils"),SearchIndex:a("./SearchIndex"),Settings:a("./Settings"),data_styles:a("./data_styles"),ui:a("./ui"),"static":a("./static"),ZoomContainer:a("./ZoomContainer")}},{"./Behavior":1,"./Builder":4,
"./CobraModel":7,"./DataMenu":8,"./KeyManager":11,"./Map":12,"./SearchIndex":18,"./Settings":19,"./UndoStack":22,"./ZoomContainer":23,"./data_styles":26,"./inline":27,"./static":29,"./ui":30,"./utils":31}],29:[function(a,b,c){function d(a,b,c,d,g){var h=f.parse_url_components(window,d),i=function(a){a(null)},j=function(a){a(null)};if(h.map_name){var k=e("map",h.map_name,c,a);k&&(i=function(a){d3.json(k,function(b,c){b&&console.warn(b),a(c)})})}if(h.model_name){var l=e("model",h.model_name,c,b);l&&(j=function(a){d3.json(l,function(b,c){b&&console.warn(b),a(c)})})}h.hasOwnProperty("enable_editing")&&(d.enable_editing="true"===h.enable_editing.toLowerCase()),i(function(a){j(function(b){g(a,b,d)})})}function e(a,b,c,d){var e=c[a+"s"].filter(function(c){return c[a+"_name"]==b});if(0==e.length)throw new Error("Bad "+a+" "+b);return d+encodeURIComponent(e[0].organism)+"/"+encodeURIComponent(e[0][a+"_name"])+".json"}var f=a("./utils");b.exports={load_map_model_from_url:d}},{"./utils":31}],30:[function(a,b,c){function d(a,b){var c=b.ignore_bootstrap||!1;a.attr("class","btn btn-default simple-button");var d=a.append("span"),e=d.append("span");"id"in b&&a.attr("id",b.id),"text"in b&&e.text(b.text),"icon"in b&&!c&&d.classed(b.icon,!0),c||e.attr("class","hidden"),"key"in b&&i(a,b.key),"key_text"in b&&"tooltip"in b&&null!==b.key_text?a.attr("title",b.tooltip+b.key_text):"tooltip"in b&&a.attr("title",b.tooltip)}function e(a,b){var c=a.append("button");d(c,b)}function f(a){var b=a.append("li").attr("class","btn-group-vertical").attr("data-toggle","buttons");return{button:function(a){var c=(a.ignore_bootstrap||!1,b.append("label"));return c.append("input").attr("type","radio"),d(c,a),this}}}function g(a){var b=a.attr("class","btn-group-vertical");return{button:function(a){var c=b.append("button");return d(c,a),this}}}function h(a,b,c){void 0===c&&(c=!1);var d=a.append("li").attr("class","dropdown");d.append("button").text(b+" ").attr("class","btn btn-link btn-sm dropdown-button").attr("data-toggle","dropdown").append("b").attr("class","caret");var e=d.append("ul").attr("class","dropdown-menu").classed("pull-right",c).attr("role","menu").attr("aria-labelledby","dLabel");return{dropdown:d,button:function(a){var b=e.append("li").attr("role","presentation").datum(a),c=b.append("a").attr("href","#"),d=c.append("span").attr("class","dropdown-button-icon"),f=c.append("span").attr("class","dropdown-button-text");if("id"in a&&b.attr("id",a.id),"key_text"in a&&"text"in a&&null!==a.key_text?f.text(" "+a.text+a.key_text):"text"in a&&f.text(" "+a.text),"icon"in a&&d.classed(a.icon,!0),"key"in a)i(c,a.key);else if("input"in a){var g=a.input,h=g.accept_csv?k(c,b,g.pre_fn,g.fn,g.failure_fn):j(c,b,g.pre_fn,g.fn,g.failure_fn);"assign"in g&&"key"in g&&(g.assign[g.key]=h)}return this},divider:function(){return e.append("li").attr("role","presentation").attr("class","divider"),this}}}function i(a,b){a.on("click",function(){b.fn.call(b.target)})}function j(a,b,c,d,e){var f=b.append("input").attr("type","file").style("display","none").on("change",function(){l.load_json(this.files[0],function(a,b){d(a,b),this.value=""}.bind(this),c,e)});return a.on("click",function(a){f.node().click()}),function(){f.node().click()}}function k(a,b,c,d,e){var f=b.append("input").attr("type","file").style("display","none").on("change",function(){l.load_json_or_csv(this.files[0],m.csv_converter,function(a,b){d(a,b),this.value=""}.bind(this),c,e)});return a.on("click",function(a){f.node().click()}),function(){f.node().click()}}var l=a("./utils"),m=a("./data_styles");b.exports={individual_button:e,radio_button_group:f,button_group:g,dropdown_menu:h,set_json_input_button:j,set_json_or_csv_input_button:k}},{"./data_styles":26,"./utils":31}],31:[function(a,b,c){function d(){try{!!new Blob}catch(a){alert("Blob not supported")}}function e(a,b,c){if(void 0===a||null===a)return b;var d={};for(var e in b){var f=e in a&&null!==a[e]&&void 0!==a[e],g=f?a[e]:b[e];c&&e in c&&(g=parseFloat(g),isNaN(g)&&(f?(console.warn("Bad float for option "+e),g=parseFloat(b[e]),isNaN(g)&&(console.warn("Bad float for default "+e),g=null)):(console.warn("Bad float for default "+e),g=null))),d[e]=g}return d}function f(a){for(var b=a.node();b.hasChildNodes();)b.removeChild(b.lastChild)}function g(a,b){var c="";return a&&d3.text(a,function(a,d){a&&console.warn(a),c=d,b(c)}),!1}function h(a,b,c,d){function e(a,b){return-1!==a.indexOf(b,a.length-b.length)}return d?(b&&console.warn("File "+b+" overridden by value."),void c.call(a,null,d)):b?void(e(b,"json")?d3.json(b,function(b,d){c.call(a,b,d)}):e(b,"css")?d3.text(b,function(b,d){c.call(a,b,d)}):c.call(a,"Unrecognized file type",null)):void c.call(a,"No filename",null)}function i(a,b,c){0===b.length&&c.call(a);for(var d=-1,e=b.length;++d<b.length;)h(a,b[d].file,function(b,d){this.call(a,b,d),--e||c.call(a)}.bind(b[d].callback),b[d].value)}function j(){var a,b=function(c){if(!(this instanceof b)){a=!0;var d=new b(arguments);return a=!1,d}"function"==typeof this.init&&this.init.apply(this,a?c:arguments)};return b}function k(a,b){a.select("defs").remove();var c=a.append("defs"),d=c.node();return d.parentNode.insertBefore(d,d.parentNode.firstChild),c.append("style").attr("type","text/css").text(b),c}function l(a,b,c,d,e,f,g,h){var i={};for(var j in d)void 0===d[j]?console.warn("Undefined value for id "+j+" in object. Ignoring."):i[j]=d[j];var k=a.select(b).selectAll(c).data(o(i,e),function(a){return a[e]});f&&k.enter().call(f),g&&k.call(g),h&&k.exit().call(h)}function m(a,b,c,d,e,f,g){var h=a.selectAll(b).data(function(a){return o(a[c],d)},function(a){return a[d]});e&&h.enter().call(e),f&&h.call(f),g&&h.exit().call(g)}function n(a,b){var c=[];for(var d in a){var e=r(a[d]);e[b]=d,c.push(e)}return c}function o(a,b){var c=[];for(var d in a){var e=a[d];e[b]=d,c.push(e)}return c}function p(a,b){if(!a||!b)return!1;if(a.length!=b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]!=b[c])return!1;return!0}function q(a){for(var b={},c=0,d=a.length;d>c;c++)for(var e=a[c],f=Object.keys(e),g=0,h=f.length;h>g;g++){var i=f[g];if(i in b)b[i][c]=e[i];else{for(var j=[],k=0;d>k;k++)j[k]=null;j[c]=e[i],b[i]=j}}return b}function r(a){return aa.isArray(a)?aa.map(a,function(a){return r(a)}):aa.isObject(a)?aa.mapObject(a,function(a,b){return r(a)}):a}function s(a,b,c){void 0===c&&(c=!1);for(var d in b){if(d in a&&!c)throw new Error("Attribute "+d+" already in object.");a[d]=b[d]}}function t(a){var b=[];return a.forEach(function(a){a.forEach(function(a){b.indexOf(a)<0&&b.push(a)})}),b}function u(a){for(var b=[],c=0,d=a.length;d>c;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b}function v(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function w(a,b){for(var c={},d=-1;++d<b.length;)c[b[d]]=r(a[b[d]]);return b.length!=Object.keys(c).length&&console.warn("did not find correct reaction subset"),c}function x(a,b){for(var c={},d=-1;++d<b.length;)c[b[d]]=a[b[d]];return b.length!=Object.keys(c).length&&console.warn("did not find correct reaction subset"),c}function y(a,b){return null===a||null===b||void 0===a||void 0===b?null:{x:a.x+b.x,y:a.y+b.y}}function z(a,b){return null===a||null===b||void 0===a||void 0===b?null:{x:a.x-b.x,y:a.y-b.y}}function A(a,b){return{x:a.x*b,y:a.y*b}}function B(a,b){d();var c=JSON.stringify(a),e=new Blob([c],{type:"application/json"});ba(e,b+".json")}function C(a,b,c,d){window.File&&window.FileReader&&window.FileList&&window.Blob||b("The File APIs are not fully supported in this browser.",null);var e=new window.FileReader;if(e.onload=function(a){var c,d=a.target.result;try{c=JSON.parse(d)}catch(e){return void b(e,null)}b(null,c)},void 0!==c&&null!==c)try{c()}catch(f){console.warn(f)}e.onabort=function(a){try{d()}catch(b){console.warn(b)}},e.onerror=function(a){try{d()}catch(b){console.warn(b)}},e.readAsText(a)}function D(a,b,c,d,e,f){var g=function(a){var d,e,f=a.target.result;try{d=JSON.parse(f)}catch(g){e="JSON error: "+g;try{d=b(d3.csv.parseRows(f))}catch(g){return void c(e+"\nCSV error: "+g,null)}}c(null,d)};if(void 0!==f&&null!==f)return console.warn("Debugging load_json_or_csv"),g(f);window.File&&window.FileReader&&window.FileList&&window.Blob||c("The File APIs are not fully supported in this browser.",null);var h=new window.FileReader;if(void 0!==d&&null!==d)try{d()}catch(i){console.warn(i)}h.onabort=function(a){try{e()}catch(b){console.warn(b)}},h.onerror=function(a){try{e()}catch(b){console.warn(b)}},h.onload=g,h.readAsText(a)}function E(a,b,c){d();var e=(new XMLSerializer).serializeToString(b.node());c&&(e=_.xml(e)),e='<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"\n "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+e;var f=new Blob([e],{type:"image/svg+xml"});ba(f,a+".svg")}function F(a,b,c){d();var e=(new XMLSerializer).serializeToString(b.node());c&&(e=_.xml(e)),e='<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"\n "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+e;var f=document.createElement("canvas"),g=f.getContext("2d"),h=b.node().getBBox(),i=h.width+h.x,j=h.height+h.y;1e4>i&&1e4>j?(f.width=i,f.height=j):f.width>f.height?(f.width=1e4,f.height=1e4*(j/i)):(f.width=1e4*(i/j),f.height=1e4);var k=new Image;k.src="data:image/svg+xml;base64,"+btoa(e),k.onload=function(){g.fillStyle="#FFF",g.fillRect(0,0,f.width,f.height),g.drawImage(k,0,0,f.width,f.height),f.toBlob(function(b){ba(b,a+".png")})}}function G(a,b,c){var d=function(a){return H(a,b,c)};return a.map(d)}function H(a,b,c){var d=Math.cos(-b)*(a.x-c.x)+Math.sin(-b)*(a.y-c.y)+c.x-a.x,e=-Math.sin(-b)*(a.x-c.x)+Math.cos(-b)*(a.y-c.y)+c.y-a.y;return{x:d,y:e}}function I(a){var b=a[1].x-a[0].x,c=a[1].y-a[0].y;return 0==b&&c>=0?Math.PI/2:0==b&&0>c?3*Math.PI/2:b>=0&&c>=0?Math.atan(c/b):b>=0?Math.atan(c/b)+2*Math.PI:Math.atan(c/b)+Math.PI}function J(a){return 180*a/Math.PI}function K(a,b,c){var d=Math.atan2(b.x-c.x,c.y-b.y),e=Math.atan2(b.x-c.x+a.x,c.y-b.y-a.y),f=e-d;return f}function L(a,b){return Math.sqrt(Math.pow(b.y-a.y,2)+Math.pow(b.x-a.x,2))}function M(a,b){b.map(function(c,d){void 0===a[d]&&console.error("Argument is undefined: "+String(b[d]))})}function N(a,b){return a+"_"+b}function O(a){function b(a){var b=/(.*)_([a-z0-9]{1,2})$/,c=b.exec(a);return null===c?null:c.slice(1,3)}var c=b(a);return null===c&&(c=[a,null]),c}function P(a){var b=a.reduce(function(a,b){return a+b}),c=b/a.length;return c}function Q(a){a.sort(function(a,b){return a-b});var b=Math.floor(a.length/2);return a.length%2==1?a[b]:(a[b-1]+a[b])/2}function R(a){a.sort(function(a,b){return a-b});var b=Math.floor(a.length/2);return 1==a.length?[a[0],a[0],a[0]]:a.length%2==1?[Q(a.slice(0,b)),a[b],Q(a.slice(b+1))]:[Q(a.slice(0,b)),(a[b-1]+a[b])/2,Q(a.slice(b))]}function S(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}function T(){return S(12)}function U(a,b){for(a instanceof Array&&(a=a.node());null!==a.parentNode;)if(a=a.parentNode,void 0!==a.tagName&&a.tagName.toLowerCase()===b.toLowerCase())return!0;return!1}function V(a,b){return void 0!==b&&null!==b&&(b=b.replace(/^\/|\/$/g,""),a=[b,a].join("/")),a.replace(/^\/|\/$/g,"")+".json"}function W(a,b){aa.isUndefined(b)&&(b={});for(var c=a.location.search.substring(1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("="),g=decodeURIComponent(f[1]);if(f[0].indexOf("[]")==f[0].length-2){var h=f[0].replace("[]","");h in b||(b[h]=[]),b[h].push(g)}else b[f[0]]=g}return b}function X(a){return a.ownerDocument}function Y(a){return X(a).defaultView}function Z(a){try{return d3.transform(a)}catch(b){return console.error("Cannot run d3.transform, probably becuase this is a node/jsdom test. Returning a tranform object for testing."),{translate:[0,0],rotate:0}}}function $(a){var b=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!=a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))};try{return b().toLowerCase().indexOf(a)>-1}catch(c){return!1}}var _=a("vkbeautify"),aa=a("underscore");try{var ba=a("filesaverjs").saveAs}catch(ca){console.warn("filesaverjs not available")}b.exports={set_options:e,remove_child_nodes:f,load_css:g,load_files:i,load_the_file:h,make_class:j,setup_defs:k,draw_an_object:l,draw_a_nested_object:m,make_array:n,make_array_ref:o,compare_arrays:p,array_to_object:q,clone:r,extend:s,unique_concat:t,unique_strings_array:u,debounce:v,object_slice_for_ids:w,object_slice_for_ids_ref:x,c_plus_c:y,c_minus_c:z,c_times_scalar:A,download_json:B,load_json:C,load_json_or_csv:D,download_svg:E,download_png:F,rotate_coords_recursive:G,rotate_coords:H,get_angle:I,to_degrees:J,angle_for_event:K,distance:L,check_undefined:M,compartmentalize:N,decompartmentalize:O,mean:P,median:Q,quartiles:R,random_characters:S,generate_map_id:T,check_for_parent_tag:U,name_to_url:V,parse_url_components:W,get_document:X,get_window:Y,d3_transform_catch:Z,check_browser:$}},{filesaverjs:33,underscore:35,vkbeautify:36}],32:[function(b,c,d){(function(b){(function(){function d(a,b){var c=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];this.obs=a,this.sync=b,this.lazy=c,this.queue=[]}function e(){d.apply(this,arguments)}function f(a){d.call(this,a,!0)}function g(a,b,c){this.context=a,this.method=b,this.args=c}function h(a){this.value=a}function i(){this.id=++da}function j(a,b){return this instanceof j?(i.call(this),void(!b&&M.isFunction(a)||(null!=a?a._isNext:void 0)?(this.valueF=a,this.valueInternal=void 0):(this.valueF=void 0,this.valueInternal=a))):new j(a,b)}function k(a,b){return this instanceof k?void j.call(this,a,b):new k(a,b)}function l(){return this instanceof l?void i.call(this):new l}function m(a){return this instanceof m?(this.error=a,void i.call(this)):new m(a)}function n(a){this.desc=a,this.id=++ia,this.initialDesc=this.desc}function o(){var a=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];this.unsubscribe=M.bind(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[];for(var b,c=0;c<a.length;c++)b=a[c],this.add(b)}function p(a,b){this._subscribe=a,this._handleEvent=b,this.subscribe=M.bind(this.subscribe,this),this.handleEvent=M.bind(this.handleEvent,this),this.pushing=!1,this.ended=!1,this.prevError=void 0,this.unsubSrc=void 0,this.subscriptions=[],this.queue=[]}function q(a,b,c){return this instanceof q?(M.isFunction(a)&&(c=b,b=a,a=g.empty),n.call(this,a),F(b),this.dispatcher=new p(b,c),void ja(this)):new q(a,b,c)}function r(a,b,c){p.call(this,b,c),this.property=a,this.subscribe=M.bind(this.subscribe,this),this.current=ba,this.currentValueRootId=void 0,this.propertyEnded=!1}function s(a,b,c){n.call(this,a),F(b),this.dispatcher=new r(this,b,c),ja(this)}function t(){return this instanceof t?(this.unsubAll=M.bind(this.unsubAll,this),this.subscribeAll=M.bind(this.subscribeAll,this),this.guardedSink=M.bind(this.guardedSink,this),this.sink=void 0,this.subscriptions=[],this.ended=!1,void q.call(this,new w.Desc(w,"Bus",[]),this.subscribeAll)):new t}function u(a){return[a,ga()]}var v=Array.prototype.slice,w={toString:function(){return"Bacon"}};w.version="0.7.83";var x=("undefined"!=typeof b&&null!==b?b:this).Error,y=function(){},z=function(a,b){return a},A=function(a){return a.slice(0)},B=function(a,b){if(!b)throw new x(a)},C=function(a){if((null!=a?a._isObservable:void 0)&&!(null!=a?a._isProperty:void 0))throw new x("Observable is not a Property : "+a)},D=function(a){if(!(null!=a?a._isEventStream:void 0))throw new x("not an EventStream : "+a)},E=function(a){if(!(null!=a?a._isObservable:void 0))throw new x("not an Observable : "+a)},F=function(a){return B("not a function : "+a,M.isFunction(a))},G=function(a){return a instanceof Array},H=function(a){return a&&a._isObservable},I=function(a){if(!G(a))throw new x("not an array : "+a)},J=function(a){return B("no arguments supported",0===a.length)},K=function(a){for(var b=arguments.length,c=1;b>1?b>c:c>b;b>1?c++:c--)for(var d in arguments[c])a[d]=arguments[c][d];return a},L=function(a,b){var c={}.hasOwnProperty,d=function(){};d.prototype=b.prototype,a.prototype=new d;for(var e in b)c.call(b,e)&&(a[e]=b[e]);return a},M={indexOf:function(){return Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],b===c)return d;return-1}}(),indexWhere:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],b(c))return d;return-1},head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,a.length)},filter:function(a,b){for(var c,d=[],e=0;e<b.length;e++)c=b[e],a(c)&&d.push(c);return d},map:function(a,b){return function(){for(var c,d=[],e=0;e<b.length;e++)c=b[e],d.push(a(c));return d}()},each:function(a,b){for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=a[c];b(c,d)}},toArray:function(a){return G(a)?a:[a]},contains:function(a,b){return-1!==M.indexOf(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a){for(var b,c=arguments.length<=1||void 0===arguments[1]?M.id:arguments[1],d=0;d<a.length;d++)if(b=a[d],!c(b))return!1;return!0},any:function(a){for(var b,c=arguments.length<=1||void 0===arguments[1]?M.id:arguments[1],d=0;d<a.length;d++)if(b=a[d],c(b))return!0;return!1},without:function(a,b){return M.filter(function(b){return b!==a},b)},remove:function(a,b){var c=M.indexOf(b,a);return c>=0?b.splice(c,1):void 0},fold:function(a,b,c){for(var d,e=0;e<a.length;e++)d=a[e],b=c(b,d);return b},flatMap:function(a,b){return M.fold(b,[],function(b,c){return b.concat(a(c))})},cached:function(a){var b=ba;return function(){return("undefined"!=typeof b&&null!==b?b._isNone:void 0)&&(b=a(),a=void 0),b}},bind:function(a,b){return function(){return a.apply(b,arguments)}},isFunction:function(a){return"function"==typeof a},toString:function(a){var b,c,d,e={}.hasOwnProperty;try{return N++,null==a?"undefined":M.isFunction(a)?"function":G(a)?N>5?"[..]":"["+M.map(M.toString,a).toString()+"]":null!=(null!=a?a.toString:void 0)&&a.toString!==Object.prototype.toString?a.toString():"object"==typeof a?N>5?"{..}":(b=function(){var b=[];for(c in a)e.call(a,c)&&(d=function(){var b;try{return a[c]}catch(b){return b}}(),b.push(M.toString(c)+":"+M.toString(d)));return b}(),"{"+b+"}"):a}finally{N--}}},N=0;w._=M;var O=w.UpdateBarrier=function(){var a,b=[],c={},d=[],e=0,f={},g=function(b){return a?d.push(b):b()},h=function(d,e){if(a){var f=c[d.id];return"undefined"==typeof f||null===f?(f=c[d.id]=[e],b.push(d)):f.push(e)}return e()},i=function(){for(;b.length>0;)j(0,!0);f={}},j=function(a,d){var e=b[a],f=e.id,g=c[f];b.splice(a,1),delete c[f],d&&b.length>0&&k(e);for(var h,i=0;i<g.length;i++)(h=g[i])()},k=function(a){if(!f[a.id]){for(var d,e=a.internalDeps(),g=0;g<e.length;g++)if(d=e[g],k(d),c[d.id]){var h=M.indexOf(b,d);j(h,!1)}f[a.id]=!0}},l=function(b,c,f,g){if(a)return f.apply(c,g);a=b;try{var h=f.apply(c,g);i()}finally{for(a=void 0;e<d.length;){var j=d[e];e++,j()}e=0,d=[]}return h},m=function(){return a?a.id:void 0},n=function(a,b){var c=!1,d=!1,e=function(){return d=!0},f=function(){return c=!0,e()};return e=a.dispatcher.subscribe(function(a){return g(function(){if(!c){var d=b(a);if(d===w.noMore)return f()}})}),d&&e(),f},o=function(){return b.length>0};return{whenDoneWith:h,hasWaiters:o,inTransaction:l,currentEventId:m,wrappedSubscribe:n,afterTransaction:g}}();K(d.prototype,{_isSource:!0,subscribe:function(a){return this.obs.dispatcher.subscribe(a)},toString:function(){return this.obs.toString()},markEnded:function(){return this.ended=!0,!0},consume:function(){return this.lazy?{value:M.always(this.queue[0])}:this.queue[0]},push:function(a){return this.queue=[a],[a]},mayHave:function(){return!0},hasAtLeast:function(){return this.queue.length},flatten:!0}),L(e,d),K(e.prototype,{consume:function(){return this.queue.shift()},push:function(a){return this.queue.push(a)},mayHave:function(a){return!this.ended||this.queue.length>=a},hasAtLeast:function(a){return this.queue.length>=a},flatten:!1}),L(f,d),K(f.prototype,{consume:function(){var a=this.queue;return this.queue=[],{value:function(){return a}}},push:function(a){return this.queue.push(a.value())},hasAtLeast:function(){return!0}}),d.isTrigger=function(a){return(null!=a?a._isSource:void 0)?a.sync:null!=a?a._isEventStream:void 0},d.fromObservable=function(a){return(null!=a?a._isSource:void 0)?a:(null!=a?a._isProperty:void 0)?new d(a,!1):new e(a,!0)},K(g.prototype,{_isDesc:!0,deps:function(){return this.cached||(this.cached=R([this.context].concat(this.args))),this.cached},toString:function(){return M.toString(this.context)+"."+M.toString(this.method)+"("+M.map(M.toString,this.args)+")"}});var P=function(a,b){var c=a||b;if(c&&c._isDesc)return a||b;for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;d>f;f++)e[f-2]=arguments[f];return new g(a,b,e)},Q=function(a,b){return b.desc=a,b},R=function(a){return G(a)?M.flatMap(R,a):H(a)?[a]:("undefined"!=typeof a&&null!==a?a._isSource:void 0)?[a.obs]:[]};w.Desc=g,w.Desc.empty=new w.Desc("","",[]);var S=function(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];if("object"==typeof b&&d.length){var f=b,g=d[0];b=function(){return f[g].apply(f,arguments)},d=d.slice(1)}return a.apply(void 0,[b].concat(d))}},T=function(a){return a=Array.prototype.slice.call(a),Y.apply(void 0,a)},U=function(a,b){return function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return a.apply(void 0,b.concat(d))}},V=function(a){return function(b){return function(c){if("undefined"!=typeof c&&null!==c){var d=c[b];return M.isFunction(d)?d.apply(c,a):d}}}},W=function(a,b){var c=a.slice(1).split("."),d=M.map(V(b),c);return function(a){for(var b,c=0;c<d.length;c++)b=d[c],a=b(a);return a}},X=function(a){return"string"==typeof a&&a.length>1&&"."===a.charAt(0)},Y=S(function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return M.isFunction(a)?c.length?U(a,c):a:X(a)?W(a,c):M.always(a)}),Z=function(a,b){return Y.apply(void 0,[a].concat(b))},$=function(a,b,c,d){if("undefined"!=typeof b&&null!==b?b._isProperty:void 0){var e=b.sampledBy(a,function(a,b){return[a,b]});return d.call(e,function(a){var b=a[0];a[1];return b}).map(function(a){var b=(a[0],a[1]);return b})}return b=Z(b,c),d.call(a,b)},_=function(a){if(M.isFunction(a))return a;if(X(a)){var b=aa(a);return function(a,c){return a[b](c)}}throw new x("not a function or a field key: "+a)},aa=function(a){return a.slice(1)};K(h.prototype,{_isSome:!0,getOrElse:function(){return this.value},get:function(){return this.value},filter:function(a){return a(this.value)?new h(this.value):ba},map:function(a){return new h(a(this.value))},forEach:function(a){return a(this.value)},isDefined:!0,toArray:function(){return[this.value]},inspect:function(){return"Some("+this.value+")"},toString:function(){return this.inspect()}});var ba={_isNone:!0,getOrElse:function(a){return a},filter:function(){return ba},map:function(){return ba},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},ca=function(a){return("undefined"!=typeof a&&null!==a?a._isSome:void 0)||("undefined"!=typeof a&&null!==a?a._isNone:void 0)?a:new h(a)};w.noMore="<no-more>",w.more="<more>";var da=0;i.prototype._isEvent=!0,i.prototype.isEvent=function(){return!0},i.prototype.isEnd=function(){return!1},i.prototype.isInitial=function(){return!1},i.prototype.isNext=function(){return!1},i.prototype.isError=function(){return!1},i.prototype.hasValue=function(){return!1},i.prototype.filter=function(){return!0},i.prototype.inspect=function(){return this.toString()},i.prototype.log=function(){return this.toString()},L(j,i),j.prototype.isNext=function(){return!0},j.prototype.hasValue=function(){return!0},j.prototype.value=function(){var a;return(null!=(a=this.valueF)?a._isNext:void 0)?(this.valueInternal=this.valueF.value(),this.valueF=void 0):this.valueF&&(this.valueInternal=this.valueF(),this.valueF=void 0),this.valueInternal},j.prototype.fmap=function(a){var b,c;return this.valueInternal?(c=this.valueInternal,this.apply(function(){return a(c)})):(b=this,this.apply(function(){return a(b.value())}))},j.prototype.apply=function(a){return new j(a)},j.prototype.filter=function(a){return a(this.value())},j.prototype.toString=function(){return M.toString(this.value())},j.prototype.log=function(){return this.value()},j.prototype._isNext=!0,L(k,j),k.prototype._isInitial=!0,k.prototype.isInitial=function(){return!0},k.prototype.isNext=function(){return!1},k.prototype.apply=function(a){return new k(a)},k.prototype.toNext=function(){return new j(this)},L(l,i),l.prototype.isEnd=function(){return!0},l.prototype.fmap=function(){return this},l.prototype.apply=function(){return this},l.prototype.toString=function(){return"<end>"},L(m,i),m.prototype.isError=function(){return!0},m.prototype.fmap=function(){return this},m.prototype.apply=function(){return this},m.prototype.toString=function(){return"<error> "+M.toString(this.error)},w.Event=i,w.Initial=k,w.Next=j,w.End=l,w.Error=m;var ea=function(a){return new k(a,!0)},fa=function(a){return new j(a,!0)},ga=function(){return new l},ha=function(a){return a&&a._isEvent?a:fa(a)},ia=0,ja=function(){};K(n.prototype,{_isObservable:!0,subscribe:function(a){return O.wrappedSubscribe(this,a)},subscribeInternal:function(a){return this.dispatcher.subscribe(a)},onValue:function(){var a=T(arguments);return this.subscribe(function(b){return b.hasValue()?a(b.value()):void 0})},onValues:function(a){return this.onValue(function(b){return a.apply(void 0,b)})},onError:function(){var a=T(arguments);return this.subscribe(function(b){return b.isError()?a(b.error):void 0})},onEnd:function(){var a=T(arguments);return this.subscribe(function(b){return b.isEnd()?a():void 0})},name:function(a){return this._name=a,this},withDescription:function(){return this.desc=P.apply(void 0,arguments),this},toString:function(){return this._name?this._name:this.desc.toString()},internalDeps:function(){return this.initialDesc.deps()}}),n.prototype.assign=n.prototype.onValue,n.prototype.forEach=n.prototype.onValue,n.prototype.inspect=n.prototype.toString,w.Observable=n,K(o.prototype,{add:function(a){var b=this;if(!this.unsubscribed){var c=!1,d=y;this.starting.push(a);var e=function(){return b.unsubscribed?void 0:(c=!0,b.remove(d),M.remove(a,b.starting))};return d=a(this.unsubscribe,e),this.unsubscribed||c?d():this.subscriptions.push(d),M.remove(a,this.starting),d}},remove:function(a){return this.unsubscribed?void 0:void 0!==M.remove(a,this.subscriptions)?a():void 0},unsubscribe:function(){if(!this.unsubscribed){this.unsubscribed=!0;for(var a=this.subscriptions,b=0;b<a.length;b++)a[b]();return this.subscriptions=[],this.starting=[],[]}},count:function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},empty:function(){return 0===this.count()}}),w.CompositeUnsubscribe=o,p.prototype.hasSubscribers=function(){return this.subscriptions.length>0},p.prototype.removeSub=function(a){return this.subscriptions=M.without(a,this.subscriptions),this.subscriptions},p.prototype.push=function(a){return a.isEnd()&&(this.ended=!0),O.inTransaction(a,this,this.pushIt,[a])},p.prototype.pushToSubscriptions=function(a){try{for(var b=this.subscriptions,c=b.length,d=0;c>d;d++){var e=b[d],f=e.sink(a);(f===w.noMore||a.isEnd())&&this.removeSub(e)}return!0}catch(g){throw this.pushing=!1,this.queue=[],g}},p.prototype.pushIt=function(a){if(this.pushing)return this.queue.push(a),w.more;if(a!==this.prevError){for(a.isError()&&(this.prevError=a),this.pushing=!0,this.pushToSubscriptions(a),this.pushing=!1;this.queue.length;)a=this.queue.shift(),this.push(a);return this.hasSubscribers()?w.more:(this.unsubscribeFromSource(),w.noMore)}},p.prototype.handleEvent=function(a){return this._handleEvent?this._handleEvent(a):this.push(a)},p.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc(),this.unsubSrc=void 0},p.prototype.subscribe=function(a){var b;return this.ended?(a(ga()),y):(F(a),b={sink:a},this.subscriptions.push(b),1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent),F(this.unsubSrc)),function(a){return function(){return a.removeSub(b),a.hasSubscribers()?void 0:a.unsubscribeFromSource()}}(this))},w.Dispatcher=p,L(q,n),K(q.prototype,{_isEventStream:!0,toProperty:function(a){var b=0===arguments.length?ba:ca(function(){return a}),c=this.dispatcher,d=new w.Desc(this,"toProperty",[a]);return new s(d,function(a){var d=!1,e=!1,f=y,g=w.more,i=function(){return d?void 0:b.forEach(function(b){return d=!0,g=a(new k(b)),g===w.noMore?(f(),f=y,y):void 0})};return f=c.subscribe(function(c){return c.hasValue()?c.isInitial()&&!e?(b=new h(function(){return c.value()}),w.more):(c.isInitial()||i(),d=!0,b=new h(c),a(c)):(c.isEnd()&&(g=i()),g!==w.noMore?a(c):void 0)}),e=!0,i(),f})},toEventStream:function(){return this},withHandler:function(a){return new q(new w.Desc(this,"withHandler",[a]),this.dispatcher.subscribe,a)}}),w.EventStream=q,w.never=function(){return new q(P(w,"never"),function(a){return a(ga()),y})},w.when=function(){if(0===arguments.length)return w.never();var a=arguments.length,b="when: expecting arguments in the form (Observable+,function)+";B(b,a%2===0);for(var c=[],e=[],f=0,g=[];a>f;){g[f]=arguments[f],g[f+1]=arguments[f+1];for(var h,i=M.toArray(arguments[f]),j=la(arguments[f+1]),k={f:j,ixs:[]},l=!1,m=0;m<i.length;m++){h=i[m];var n=M.indexOf(c,h);l||(l=d.isTrigger(h)),0>n&&(c.push(h),n=c.length-1);for(var o,p=0;p<k.ixs.length;p++)o=k.ixs[p],o.index===n&&o.count++;k.ixs.push({index:n,count:1})}B("At least one EventStream required",l||!i.length),i.length>0&&e.push(k),f+=2}if(!c.length)return w.never();c=M.map(d.fromObservable,c);var r=M.any(c,function(a){return a.flatten})&&ka(M.map(function(a){return a.obs},c)),s=new w.Desc(w,"when",g),t=new q(s,function(a){var b=[],d=!1,f=function(a){for(var b,d=0;d<a.ixs.length;d++)if(b=a.ixs[d],!c[b.index].hasAtLeast(b.count))return!1;return!0},g=function(a){return!a.sync||a.ended},h=function(a){for(var b,d=0;d<a.ixs.length;d++)if(b=a.ixs[d],!c[b.index].mayHave(b.count))return!0},i=function(a){return!a.source.flatten},j=function(j){return function(k){var l=function(){return O.whenDoneWith(t,n)},m=function(){if(!(b.length>0))return w.more;for(var d,g=w.more,h=b.pop(),j=0;j<e.length;j++)if(d=e[j],f(d)){var k=function(){for(var a,b=[],e=0;e<d.ixs.length;e++)a=d.ixs[e],b.push(c[a.index].consume());return b}();return g=a(h.e.apply(function(){var a,b=function(){for(var a,b=[],c=0;c<k.length;c++)a=k[c],b.push(a.value());return b}();return(a=d).f.apply(a,b)})),b.length&&(b=M.filter(i,b)),g===w.noMore?g:m()}},n=function(){var b=m();return d&&(M.all(c,g)||M.all(e,h))&&(b=w.noMore,a(ga())),b===w.noMore&&k(),b};return j.subscribe(function(c){if(c.isEnd())d=!0,j.markEnded(),l();else if(c.isError())var e=a(c);else j.push(c),j.sync&&(b.push({source:j,e:c}),r||O.hasWaiters()?l():n());return e===w.noMore&&k(),e||w.more})}};return new w.CompositeUnsubscribe(function(){for(var a,b=[],d=0;d<c.length;d++)a=c[d],b.push(j(a));return b}()).unsubscribe});return t};var ka=function(a){var b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=function(a){if(M.contains(b,a))return!0;var d=a.internalDeps();return d.length?(b.push(a),M.any(d,c)):(b.push(a),!1)};return M.any(a,c)},la=function(a){return M.isFunction(a)?a:M.always(a)};w.groupSimultaneous=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];1===b.length&&G(b[0])&&(b=b[0]);
var d=function(){for(var a,c=[],d=0;d<b.length;d++)a=b[d],c.push(new f(a));return c}();return Q(new w.Desc(w,"groupSimultaneous",b),w.when(d,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}))},L(r,p),K(r.prototype,{push:function(a){return a.isEnd()&&(this.propertyEnded=!0),a.hasValue()&&(this.current=new h(a),this.currentValueRootId=O.currentEventId()),p.prototype.push.call(this,a)},maybeSubSource:function(a,b){return b===w.noMore?y:this.propertyEnded?(a(ga()),y):p.prototype.subscribe.call(this,a)},subscribe:function(a){var b=this,c=w.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var d=O.currentEventId(),e=this.currentValueRootId;return!this.propertyEnded&&e&&d&&d!==e?(O.whenDoneWith(this.property,function(){return b.currentValueRootId===e?a(ea(b.current.get().value())):void 0}),this.maybeSubSource(a,c)):(O.inTransaction(void 0,this,function(){return c=a(ea(this.current.get().value()))},[]),this.maybeSubSource(a,c))}return this.maybeSubSource(a,c)}}),L(s,n),K(s.prototype,{_isProperty:!0,changes:function(){var a=this;return new q(new w.Desc(this,"changes",[]),function(b){return a.dispatcher.subscribe(function(a){return a.isInitial()?void 0:b(a)})})},withHandler:function(a){return new s(new w.Desc(this,"withHandler",[a]),this.dispatcher.subscribe,a)},toProperty:function(){return J(arguments),this},toEventStream:function(){var a=this;return new q(new w.Desc(this,"toEventStream",[]),function(b){return a.dispatcher.subscribe(function(a){return a.isInitial()&&(a=a.toNext()),b(a)})})}}),w.Property=s,w.constant=function(a){return new s(new w.Desc(w,"constant",[a]),function(b){return b(ea(a)),b(ga()),y})},w.fromBinder=function(a){var b=arguments.length<=1||void 0===arguments[1]?M.id:arguments[1],c=new w.Desc(w,"fromBinder",[a,b]);return new q(c,function(c){var d=!1,e=!1,f=function(){return d?void 0:"undefined"!=typeof g&&null!==g?(g(),d=!0):e=!0},g=a(function(){for(var a,d=arguments.length,e=Array(d),g=0;d>g;g++)e[g]=arguments[g];var h=b.apply(this,e);G(h)&&(null!=(a=M.last(h))?a._isEvent:void 0)||(h=[h]);for(var i,j=w.more,k=0;k<h.length;k++)if(i=h[k],j=c(i=ha(i)),j===w.noMore||i.isEnd())return f(),j;return j});return e&&f(),f})},w.Observable.prototype.map=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(this,a,c,function(a){return Q(new w.Desc(this,"map",[a]),this.withHandler(function(b){return this.push(b.fmap(a))}))})};var ma=function(a){return G(a[0])?a[0]:Array.prototype.slice.call(a)},na=function(a){return M.isFunction(a[0])?[ma(Array.prototype.slice.call(a,1)),a[0]]:[ma(Array.prototype.slice.call(a,0,a.length-1)),M.last(a)]};w.combineAsArray=function(){for(var a,b=ma(arguments),c=0;c<b.length;c++)a=b[c],H(a)||(b[c]=w.constant(a));if(b.length){var e=function(){for(var a,c=[],e=0;e<b.length;e++)a=b[e],c.push(new d(a,!0));return c}();return Q(new w.Desc(w,"combineAsArray",b),w.when(e,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}).toProperty())}return w.constant([])},w.onValues=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return w.combineAsArray(b.slice(0,b.length-1)).onValues(b[b.length-1])},w.combineWith=function(){var a=na(arguments),b=a[0],c=a[1],d=new w.Desc(w,"combineWith",[c].concat(b));return Q(d,w.combineAsArray(b).map(function(a){return c.apply(void 0,a)}))},w.Observable.prototype.combine=function(a,b){var c=_(b),d=new w.Desc(this,"combine",[a,b]);return Q(d,w.combineAsArray(this,a).map(function(a){return c(a[0],a[1])}))},w.Observable.prototype.withStateMachine=function(a,b){var c=a,d=new w.Desc(this,"withStateMachine",[a,b]);return Q(d,this.withHandler(function(a){var d=b(c,a),e=d[0],f=d[1];c=e;for(var g,h=w.more,i=0;i<f.length;i++)if(g=f[i],h=this.push(g),h===w.noMore)return h;return h}))};var oa=function(a,b){return a===b},pa=function(a){return"undefined"!=typeof a&&null!==a?a._isNone:!1};w.Observable.prototype.skipDuplicates=function(){var a=arguments.length<=0||void 0===arguments[0]?oa:arguments[0],b=new w.Desc(this,"skipDuplicates",[]);return Q(b,this.withStateMachine(ba,function(b,c){return c.hasValue()?c.isInitial()||pa(b)||!a(b.get(),c.value())?[new h(c.value()),[c]]:[b,[]]:[b,[c]]}))},w.Observable.prototype.awaiting=function(a){var b=new w.Desc(this,"awaiting",[a]);return Q(b,w.groupSimultaneous(this,a).map(function(a){return 0===a[1].length}).toProperty(!1).skipDuplicates())},w.Observable.prototype.not=function(){return Q(new w.Desc(this,"not",[]),this.map(function(a){return!a}))},w.Property.prototype.and=function(a){return Q(new w.Desc(this,"and",[a]),this.combine(a,function(a,b){return a&&b}))},w.Property.prototype.or=function(a){return Q(new w.Desc(this,"or",[a]),this.combine(a,function(a,b){return a||b}))},w.scheduler={setTimeout:function(a,b){return setTimeout(a,b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},clearTimeout:function(a){return clearTimeout(a)},now:function(){return(new Date).getTime()}},w.EventStream.prototype.bufferWithTime=function(a){return Q(new w.Desc(this,"bufferWithTime",[a]),this.bufferWithTimeOrCount(a,Number.MAX_VALUE))},w.EventStream.prototype.bufferWithCount=function(a){return Q(new w.Desc(this,"bufferWithCount",[a]),this.bufferWithTimeOrCount(void 0,a))},w.EventStream.prototype.bufferWithTimeOrCount=function(a,b){var c=function(c){return c.values.length===b?c.flush():void 0!==a?c.schedule():void 0},d=new w.Desc(this,"bufferWithTimeOrCount",[a,b]);return Q(d,this.buffer(a,c,c))},w.EventStream.prototype.buffer=function(a){var b=arguments.length<=1||void 0===arguments[1]?y:arguments[1],c=arguments.length<=2||void 0===arguments[2]?y:arguments[2],d={scheduled:null,end:void 0,values:[],flush:function(){if(this.scheduled&&(w.scheduler.clearTimeout(this.scheduled),this.scheduled=null),this.values.length>0){var a=this.values;this.values=[];var b=this.push(fa(a));if(null!=this.end)return this.push(this.end);if(b!==w.noMore)return c(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){var b=this;return this.scheduled?void 0:this.scheduled=a(function(){return b.flush()})}},e=w.more;if(!M.isFunction(a)){var f=a;a=function(a){return w.scheduler.setTimeout(a,f)}}return Q(new w.Desc(this,"buffer",[]),this.withHandler(function(a){var c=this;return d.push=function(a){return c.push(a)},a.isError()?e=this.push(a):a.isEnd()?(d.end=a,d.scheduled||d.flush()):(d.values.push(a.value()),b(d)),e}))},w.Observable.prototype.filter=function(a){C(a);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(this,a,c,function(a){return Q(new w.Desc(this,"filter",[a]),this.withHandler(function(b){return b.filter(a)?this.push(b):w.more}))})},w.once=function(a){return new q(new g(w,"once",[a]),function(b){return b(ha(a)),b(ga()),y})},w.EventStream.prototype.concat=function(a){var b=this;return new q(new w.Desc(b,"concat",[a]),function(c){var d=y,e=b.dispatcher.subscribe(function(b){return b.isEnd()?d=a.dispatcher.subscribe(c):c(b)});return function(){return e(),d()}})},w.Observable.prototype.flatMap=function(){return sa(this,qa(arguments))},w.Observable.prototype.flatMapFirst=function(){return sa(this,qa(arguments),!0)};var qa=function(a){return 1===a.length&&H(a[0])?M.always(a[0]):T(a)},ra=function(a){return H(a)?a:w.once(a)},sa=function(a,b,c,d){var e=[a],f=[],g=new w.Desc(a,"flatMap"+(c?"First":""),[b]),h=new q(g,function(e){var g=new o,h=[],i=function(a){var c=ra(b(a.value()));return f.push(c),g.add(function(a,b){return c.dispatcher.subscribe(function(d){if(d.isEnd())return M.remove(c,f),j(),k(b),w.noMore;("undefined"!=typeof d&&null!==d?d._isInitial:void 0)&&(d=d.toNext());var g=e(d);return g===w.noMore&&a(),g})})},j=function(){var a=h.shift();return a?i(a):void 0},k=function(a){return a(),g.empty()?e(ga()):void 0};return g.add(function(b,f){return a.dispatcher.subscribe(function(a){return a.isEnd()?k(f):a.isError()?e(a):c&&g.count()>1?w.more:g.unsubscribed?w.noMore:d&&g.count()>d?h.push(a):i(a)})}),g.unsubscribe});return h.internalDeps=function(){return f.length?e.concat(f):e},h};w.Observable.prototype.flatMapWithConcurrencyLimit=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];var e=new w.Desc(this,"flatMapWithConcurrencyLimit",[a].concat(c));return Q(e,sa(this,qa(c),!1,a))},w.Observable.prototype.flatMapConcat=function(){var a=new w.Desc(this,"flatMapConcat",Array.prototype.slice.call(arguments,0));return Q(a,this.flatMapWithConcurrencyLimit.apply(this,[1].concat(v.call(arguments))))},w.later=function(a,b){return Q(new w.Desc(w,"later",[a,b]),w.fromBinder(function(c){var d=function(){return c([b,ga()])},e=w.scheduler.setTimeout(d,a);return function(){return w.scheduler.clearTimeout(e)}}))},w.Observable.prototype.bufferingThrottle=function(a){var b=new w.Desc(this,"bufferingThrottle",[a]);return Q(b,this.flatMapConcat(function(b){return w.once(b).concat(w.later(a).filter(!1))}))},w.Property.prototype.bufferingThrottle=function(){return w.Observable.prototype.bufferingThrottle.apply(this,arguments).toProperty()},L(t,q),K(t.prototype,{unsubAll:function(){for(var a,b=this.subscriptions,c=0;c<b.length;c++)a=b[c],"function"==typeof a.unsub&&a.unsub()},subscribeAll:function(a){if(this.ended)a(ga());else{this.sink=a;for(var b,c=A(this.subscriptions),d=0;d<c.length;d++)b=c[d],this.subscribeInput(b)}return this.unsubAll},guardedSink:function(a){var b=this;return function(c){return c.isEnd()?(b.unsubscribeInput(a),w.noMore):b.sink(c)}},subscribeInput:function(a){return a.unsub=a.input.dispatcher.subscribe(this.guardedSink(a.input)),a.unsub},unsubscribeInput:function(a){for(var b,c=this.subscriptions,d=0;d<c.length;d++)if(b=c[d],b.input===a)return"function"==typeof b.unsub&&b.unsub(),void this.subscriptions.splice(d,1)},plug:function(a){var b=this;if(E(a),!this.ended){var c={input:a};return this.subscriptions.push(c),"undefined"!=typeof this.sink&&this.subscribeInput(c),function(){return b.unsubscribeInput(a)}}},end:function(){return this.ended=!0,this.unsubAll(),"function"==typeof this.sink?this.sink(ga()):void 0},push:function(a){return this.ended||"function"!=typeof this.sink?void 0:this.sink(fa(a))},error:function(a){return"function"==typeof this.sink?this.sink(new m(a)):void 0}}),w.Bus=t;var ta=function(a,b){return S(function(c){for(var d=U(b,[function(a,b){return c.apply(void 0,a.concat([b]))}]),e=arguments.length,f=Array(e>1?e-1:0),g=1;e>g;g++)f[g-1]=arguments[g];return Q(new w.Desc(w,a,[c].concat(f)),w.combineAsArray(f).flatMap(d))})};w.fromCallback=ta("fromCallback",function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return w.fromBinder(function(b){return Z(a,c)(b),y},function(a){return[a,ga()]})}),w.fromNodeCallback=ta("fromNodeCallback",function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return w.fromBinder(function(b){return Z(a,c)(b),y},function(a,b){return a?[new m(a),ga()]:[b,ga()]})}),w.combineTemplate=function(a){function b(a){return a[a.length-1]}function c(a,c,d){return b(a)[c]=d,d}function d(a,b){return function(d,e){return c(d,a,e[b])}}function e(a,b){return function(d){return c(d,a,b)}}function f(a){return G(a)?[]:{}}function g(a,b){return function(d){var e=f(b);return c(d,a,e),d.push(e)}}function h(a,b){if(H(b))return l.push(b),k.push(d(a,l.length-1));if(!b||b.constructor!=Object&&b.constructor!=Array)return k.push(e(a,b));var c=function(a){return a.pop()};return k.push(g(a,b)),j(b),k.push(c)}function i(b){for(var c,d=f(a),e=[d],g=0;g<k.length;g++)(c=k[g])(e,b);return d}function j(a){return M.each(a,h)}var k=[],l=[];return j(a),Q(new w.Desc(w,"combineTemplate",[a]),w.combineAsArray(l).map(i))};var ua=function(a,b){var c=new q(P(a,"justInitValue"),function(b){var d=void 0,e=a.dispatcher.subscribe(function(a){return a.isEnd()||(d=a),w.noMore});return O.whenDoneWith(c,function(){return"undefined"!=typeof d&&null!==d&&b(d),b(ga())}),e});return c.concat(b).toProperty()};w.Observable.prototype.mapEnd=function(){var a=T(arguments);return Q(new w.Desc(this,"mapEnd",[a]),this.withHandler(function(b){return b.isEnd()?(this.push(fa(a(b))),this.push(ga()),w.noMore):this.push(b)}))},w.Observable.prototype.skipErrors=function(){return Q(new w.Desc(this,"skipErrors",[]),this.withHandler(function(a){return a.isError()?w.more:this.push(a)}))},w.EventStream.prototype.takeUntil=function(a){var b={};return Q(new w.Desc(this,"takeUntil",[a]),w.groupSimultaneous(this.mapEnd(b),a.skipErrors()).withHandler(function(a){if(a.hasValue()){var c=a.value(),d=c[0],e=c[1];if(e.length)return this.push(ga());for(var f,g=w.more,h=0;h<d.length;h++)f=d[h],g=f===b?this.push(ga()):this.push(fa(f));return g}return this.push(a)}))},w.Property.prototype.takeUntil=function(a){var b=this.changes().takeUntil(a);return Q(new w.Desc(this,"takeUntil",[a]),ua(this,b))},w.Observable.prototype.flatMapLatest=function(){var a=qa(arguments),b=this.toEventStream();return Q(new w.Desc(this,"flatMapLatest",[a]),b.flatMap(function(c){return ra(a(c)).takeUntil(b)}))},w.Property.prototype.delayChanges=function(a,b){return Q(a,ua(this,b(this.changes())))},w.EventStream.prototype.delay=function(a){return Q(new w.Desc(this,"delay",[a]),this.flatMap(function(b){return w.later(a,b)}))},w.Property.prototype.delay=function(a){return this.delayChanges(new w.Desc(this,"delay",[a]),function(b){return b.delay(a)})},w.EventStream.prototype.debounce=function(a){return Q(new w.Desc(this,"debounce",[a]),this.flatMapLatest(function(b){return w.later(a,b)}))},w.Property.prototype.debounce=function(a){return this.delayChanges(new w.Desc(this,"debounce",[a]),function(b){return b.debounce(a)})},w.EventStream.prototype.debounceImmediate=function(a){return Q(new w.Desc(this,"debounceImmediate",[a]),this.flatMapFirst(function(b){return w.once(b).concat(w.later(a).filter(!1))}))},w.Observable.prototype.decode=function(a){return Q(new w.Desc(this,"decode",[a]),this.combine(w.combineTemplate(a),function(a,b){return b[a]}))},w.Observable.prototype.scan=function(a,b){var c,d=this;b=_(b);var e=ca(a),f=!1,g=function(a){var g=!1,i=y,j=w.more,l=function(){return g?void 0:e.forEach(function(b){return g=f=!0,j=a(new k(function(){return b})),j===w.noMore?(i(),i=y):void 0})};return i=d.dispatcher.subscribe(function(c){if(c.hasValue()){if(f&&c.isInitial())return w.more;c.isInitial()||l(),g=f=!0;var d=e.getOrElse(void 0),i=b(d,c.value());return e=new h(i),a(c.apply(function(){return i}))}return c.isEnd()&&(j=l()),j!==w.noMore?a(c):void 0}),O.whenDoneWith(c,l),i};return c=new s(new w.Desc(this,"scan",[a,b]),g)},w.Observable.prototype.diff=function(a,b){return b=_(b),Q(new w.Desc(this,"diff",[a,b]),this.scan([a],function(a,c){return[c,b(a[0],c)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]}))},w.Observable.prototype.doAction=function(){var a=T(arguments);return Q(new w.Desc(this,"doAction",[a]),this.withHandler(function(b){return b.hasValue()&&a(b.value()),this.push(b)}))},w.Observable.prototype.doEnd=function(){var a=T(arguments);return Q(new w.Desc(this,"doEnd",[a]),this.withHandler(function(b){return b.isEnd()&&a(),this.push(b)}))},w.Observable.prototype.doError=function(){var a=T(arguments);return Q(new w.Desc(this,"doError",[a]),this.withHandler(function(b){return b.isError()&&a(b.error),this.push(b)}))},w.Observable.prototype.doLog=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return Q(new w.Desc(this,"doLog",b),this.withHandler(function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,b.concat([a.log()])),this.push(a)}))},w.Observable.prototype.endOnError=function(a){("undefined"==typeof a||null===a)&&(a=!0);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(this,a,c,function(a){return Q(new w.Desc(this,"endOnError",[]),this.withHandler(function(b){return b.isError()&&a(b.error)?(this.push(b),this.push(ga())):this.push(b)}))})},n.prototype.errors=function(){return Q(new w.Desc(this,"errors",[]),this.filter(function(){return!1}))},w.Observable.prototype.take=function(a){return 0>=a?w.never():Q(new w.Desc(this,"take",[a]),this.withHandler(function(b){return b.hasValue()?(a--,a>0?this.push(b):(0===a&&this.push(b),this.push(ga()),w.noMore)):this.push(b)}))},w.Observable.prototype.first=function(){return Q(new w.Desc(this,"first",[]),this.take(1))},w.Observable.prototype.mapError=function(){var a=T(arguments);return Q(new w.Desc(this,"mapError",[a]),this.withHandler(function(b){return b.isError()?this.push(fa(a(b.error))):this.push(b)}))},w.Observable.prototype.flatMapError=function(a){var b=new w.Desc(this,"flatMapError",[a]);return Q(b,this.mapError(function(a){return new m(a)}).flatMap(function(b){return b instanceof m?a(b.error):w.once(b)}))},w.EventStream.prototype.sampledBy=function(a,b){return Q(new w.Desc(this,"sampledBy",[a,b]),this.toProperty().sampledBy(a,b))},w.Property.prototype.sampledBy=function(a,b){var c=!1;"undefined"!=typeof b&&null!==b?b=_(b):(c=!0,b=function(a){return a.value()});var e=new d(this,!1,c),f=new d(a,!0,c),g=w.when([e,f],b),h=a._isProperty?g.toProperty():g;return Q(new w.Desc(this,"sampledBy",[a,b]),h)},w.Property.prototype.sample=function(a){return Q(new w.Desc(this,"sample",[a]),this.sampledBy(w.interval(a,{})))},w.Observable.prototype.map=function(a){if(a&&a._isProperty)return a.sampledBy(this,z);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(this,a,c,function(a){return Q(new w.Desc(this,"map",[a]),this.withHandler(function(b){return this.push(b.fmap(a))}))})},w.Observable.prototype.fold=function(a,b){return Q(new w.Desc(this,"fold",[a,b]),this.scan(a,b).sampledBy(this.filter(!1).mapEnd().toProperty()))},n.prototype.reduce=n.prototype.fold;var va=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]],wa=function(a){for(var b,c=0;c<va.length;c++){b=va[c];var d=[a[b[0]],a[b[1]]];if(d[0]&&d[1])return d}for(var e=0;e<va.length;e++){b=va[e];var f=a[b[0]];if(f)return[f,function(){}]}throw new m("No suitable event methods in "+a)};w.fromEventTarget=function(a,b,c){var d=wa(a),e=d[0],f=d[1],g=new w.Desc(w,"fromEvent",[a,b]);return Q(g,w.fromBinder(function(c){return e.call(a,b,c),function(){return f.call(a,b,c)}},c))},w.fromEvent=w.fromEventTarget,w.fromPoll=function(a,b){var c=new w.Desc(w,"fromPoll",[a,b]);return Q(c,w.fromBinder(function(b){var c=w.scheduler.setInterval(b,a);return function(){return w.scheduler.clearInterval(c)}},b))},w.fromPromise=function(a,b){var c=arguments.length<=2||void 0===arguments[2]?u:arguments[2];return Q(new w.Desc(w,"fromPromise",[a]),w.fromBinder(function(c){var d=a.then(c,function(a){return c(new m(a))});return d&&"function"==typeof d.done&&d.done(),b?function(){return"function"==typeof a.abort?a.abort():void 0}:function(){}},c))},w.Observable.prototype.groupBy=function(a){var b=arguments.length<=1||void 0===arguments[1]?w._.id:arguments[1],c={},d=this;return d.filter(function(b){return!c[a(b)]}).map(function(e){var f=a(e),g=d.filter(function(b){return a(b)===f}),h=w.once(e).concat(g),i=b(h,e).withHandler(function(a){return this.push(a),a.isEnd()?delete c[f]:void 0});return c[f]=i,i})},w.fromArray=function(a){if(I(a),a.length){var b=0;return new q(new w.Desc(w,"fromArray",[a]),function(c){var d=!1,e=w.more,f=!1,g=!1,h=function(){if(g=!0,!f){for(f=!0;g;)if(g=!1,e!==w.noMore&&!d){var i=a[b++];e=c(ha(i)),e!==w.noMore&&(b===a.length?c(ga()):O.afterTransaction(h))}return f=!1}};return h(),function(){return d=!0}})}return Q(new w.Desc(w,"fromArray",a),w.never())},w.EventStream.prototype.holdWhen=function(a){var b=!1,c=[],d=this;return new q(new w.Desc(this,"holdWhen",[a]),function(e){var f=new o,g=!1,h=function(a){return"function"==typeof a&&a(),f.empty()&&g?e(ga()):void 0};return f.add(function(d,f){return a.subscribeInternal(function(a){if(!a.hasValue())return a.isEnd()?h(f):e(a);if(b=a.value(),!b){var d=c;return c=[],function(){for(var a,b=[],c=0;c<d.length;c++)a=d[c],b.push(e(fa(a)));return b}()}})}),f.add(function(a,f){return d.subscribeInternal(function(a){return b&&a.hasValue()?c.push(a.value()):a.isEnd()&&c.length?h(f):e(a)})}),g=!0,h(),f.unsubscribe})},w.interval=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return Q(new w.Desc(w,"interval",[a,b]),w.fromPoll(a,function(){return fa(b)}))},w.$={},w.$.asEventStream=function(a,b,c){var d=this;return M.isFunction(b)&&(c=b,b=void 0),Q(new w.Desc(this.selector||this,"asEventStream",[a]),w.fromBinder(function(c){return d.on(a,b,c),function(){return d.off(a,b,c)}},c))},"undefined"!=typeof jQuery&&jQuery&&(jQuery.fn.asEventStream=w.$.asEventStream),"undefined"!=typeof Zepto&&Zepto&&(Zepto.fn.asEventStream=w.$.asEventStream),w.Observable.prototype.last=function(){var a;return Q(new w.Desc(this,"last",[]),this.withHandler(function(b){return b.isEnd()?(a&&this.push(a),this.push(ga()),w.noMore):void(a=b)}))},w.Observable.prototype.log=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.subscribe(function(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,b.concat([a.log()]))}),this},w.EventStream.prototype.merge=function(a){D(a);var b=this;return Q(new w.Desc(b,"merge",[a]),w.mergeAll(this,a))},w.mergeAll=function(){var a=ma(arguments);return a.length?new q(new w.Desc(w,"mergeAll",a),function(b){var c=0,d=function(d){return function(e){return d.dispatcher.subscribe(function(d){if(d.isEnd())return c++,c===a.length?b(ga()):w.more;var f=b(d);return f===w.noMore&&e(),f})}},e=M.map(d,a);return new w.CompositeUnsubscribe(e).unsubscribe}):w.never()},w.repeatedly=function(a,b){var c=0;return Q(new w.Desc(w,"repeatedly",[a,b]),w.fromPoll(a,function(){return b[c++%b.length]}))},w.repeat=function(a){var b=0;return w.fromBinder(function(c){function d(a){return a.isEnd()?f?e():f=!0:g=c(a)}function e(){var e;for(f=!0;f&&g!==w.noMore;)e=a(b++),f=!1,e?h=e.subscribeInternal(d):c(ga());return f=!0}var f=!1,g=w.more,h=function(){};return e(),function(){return h()}})},w.retry=function(a){if(!M.isFunction(a.source))throw new x("'source' option has to be a function");var b=a.source,c=a.retries||0,d=a.maxRetries||c,e=a.delay||function(){return 0},f=a.isRetryable||function(){return!0},g=!1,h=null;return Q(new w.Desc(w,"retry",[a]),w.repeat(function(){function a(){return b().endOnError().withHandler(function(a){return a.isError()?(h=a,f(h.error)&&c>0?void 0:(g=!0,this.push(a))):(a.hasValue()&&(h=null,g=!0),this.push(a))})}if(g)return null;if(h){var i={error:h.error,retriesDone:d-c},j=w.later(e(i)).filter(!1);return c-=1,j.concat(w.once().flatMap(a))}return a()}))},w.sequentially=function(a,b){var c=0;return Q(new w.Desc(w,"sequentially",[a,b]),w.fromPoll(a,function(){var a=b[c++];return c<b.length?a:c===b.length?[a,ga()]:ga()}))},w.Observable.prototype.skip=function(a){return Q(new w.Desc(this,"skip",[a]),this.withHandler(function(b){return b.hasValue()&&a>0?(a--,w.more):this.push(b)}))},w.EventStream.prototype.skipUntil=function(a){var b=a.take(1).map(!0).toProperty(!1);return Q(new w.Desc(this,"skipUntil",[a]),this.filter(b))},w.EventStream.prototype.skipWhile=function(a){C(a);for(var b=!1,c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];return $(this,a,d,function(a){return Q(new w.Desc(this,"skipWhile",[a]),this.withHandler(function(c){return!b&&c.hasValue()&&a(c.value())?w.more:(c.hasValue()&&(b=!0),this.push(c))}))})},w.Observable.prototype.slidingWindow=function(a){var b=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return Q(new w.Desc(this,"slidingWindow",[a,b]),this.scan([],function(b,c){return b.concat([c]).slice(-a)}).filter(function(a){return a.length>=b}))};var xa=[],ja=function(a){if(xa.length&&!ja.running)try{ja.running=!0,xa.forEach(function(b){b(a)})}finally{delete ja.running}};w.spy=function(a){return xa.push(a)},w.Property.prototype.startWith=function(a){return Q(new w.Desc(this,"startWith",[a]),this.scan(a,function(a,b){return b}))},w.EventStream.prototype.startWith=function(a){return Q(new w.Desc(this,"startWith",[a]),w.once(a).concat(this))},w.Observable.prototype.takeWhile=function(a){C(a);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return $(this,a,c,function(a){return Q(new w.Desc(this,"takeWhile",[a]),this.withHandler(function(b){return b.filter(a)?this.push(b):(this.push(ga()),w.noMore)}))})},w.EventStream.prototype.throttle=function(a){return Q(new w.Desc(this,"throttle",[a]),this.bufferWithTime(a).map(function(a){return a[a.length-1]}))},w.Property.prototype.throttle=function(a){return this.delayChanges(new w.Desc(this,"throttle",[a]),function(b){return b.throttle(a)})},n.prototype.firstToPromise=function(a){var b=this;if("function"!=typeof a){if("function"!=typeof Promise)throw new x("There isn't default Promise, use shim or parameter");a=Promise}return new a(function(a,c){return b.subscribe(function(b){return b.hasValue()&&a(b.value()),b.isError()&&c(b.error),w.noMore})})},n.prototype.toPromise=function(a){return this.last().firstToPromise(a)},w["try"]=function(a){return function(b){try{return w.once(a(b))}catch(c){return new w.Error(c)}}},w.update=function(a){function b(a){return function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return function(b){return a.apply(void 0,[b].concat(c))}}}for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];for(var f=d.length-1;f>0;)d[f]instanceof Function||(d[f]=M.always(d[f])),d[f]=b(d[f]),f-=2;return Q(new w.Desc(w,"update",[a].concat(d)),w.when.apply(w,d).scan(a,function(a,b){return b(a)}))},w.zipAsArray=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=ma(b);return Q(new w.Desc(w,"zipAsArray",d),w.zipWith(d,function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b}))},w.zipWith=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=na(b),e=d[0],f=d[1];return e=M.map(function(a){return a.toEventStream()},e),Q(new w.Desc(w,"zipWith",[f].concat(e)),w.when(e,f))},w.Observable.prototype.zip=function(a,b){return Q(new w.Desc(this,"zip",[a]),w.zipWith([this,a],b||Array))},"undefined"!=typeof a&&null!==a&&null!=a.amd?(a([],function(){return w}),"undefined"!=typeof this&&null!==this&&(this.Bacon=w)):"undefined"!=typeof c&&null!==c&&null!=c.exports?(c.exports=w,w.Bacon=w):this.Bacon=w}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(b,c,d){var e=e||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),h=a.webkitRequestFileSystem,i=a.requestFileSystem||h||a.mozRequestFileSystem,j=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},k="application/octet-stream",l=0,m=500,n=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,m)},o=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){j(f)}}},p=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\ufeff",a],{type:a.type}):a},q=function(b,j,m){m||(b=p(b));var q,r,s,t=this,u=b.type,v=!1,w=function(){o(t,"writestart progress write writeend".split(" "))},x=function(){if(r&&g&&"undefined"!=typeof FileReader){var d=new FileReader;return d.onloadend=function(){var a=d.result;r.location.href="data:attachment/file"+a.slice(a.search(/[,;]/)),t.readyState=t.DONE,w()},d.readAsDataURL(b),void(t.readyState=t.INIT)}if((v||!q)&&(q=c().createObjectURL(b)),r)r.location.href=q;else{var e=a.open(q,"_blank");void 0==e&&g&&(a.location.href=q)}t.readyState=t.DONE,w(),n(q)},y=function(a){return function(){return t.readyState!==t.DONE?a.apply(this,arguments):void 0}},z={create:!0,exclusive:!1};return t.readyState=t.INIT,j||(j="download"),e?(q=c().createObjectURL(b),d.href=q,d.download=j,void setTimeout(function(){f(d),w(),n(q),t.readyState=t.DONE})):(a.chrome&&u&&u!==k&&(s=b.slice||b.webkitSlice,b=s.call(b,0,b.size,k),v=!0),h&&"download"!==j&&(j+=".download"),(u===k||h)&&(r=a),i?(l+=b.size,void i(a.TEMPORARY,l,y(function(a){a.root.getDirectory("saved",z,y(function(a){var c=function(){a.getFile(j,z,y(function(a){a.createWriter(y(function(c){c.onwriteend=function(b){r.location.href=a.toURL(),t.readyState=t.DONE,o(t,"writeend",b),n(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=t["on"+a]}),c.write(b),t.abort=function(){c.abort(),t.readyState=t.DONE},t.readyState=t.WRITING}),x)}),x)};a.getFile(j,{create:!1},y(function(a){a.remove(),c()}),y(function(a){a.code===a.NOT_FOUND_ERR?c():x()}))}),x)}),x)):void x())},r=q.prototype,s=function(a,b,c){return new q(a,b,c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return c||(a=p(a)),navigator.msSaveOrOpenBlob(a,b||"download")}:(r.abort=function(){var a=this;a.readyState=a.DONE,o(a,"abort")},r.readyState=r.INIT=0,r.WRITING=1,r.DONE=2,r.error=r.onwritestart=r.onprogress=r.onwrite=r.onabort=r.onerror=r.onwriteend=null,s)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof c&&c.exports?c.exports.saveAs=e:"undefined"!=typeof a&&null!==a&&null!=a.amd&&a([],function(){return e})},{}],34:[function(b,c,d){!function(b,d,e){function f(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function g(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return t[a.which]?t[a.which]:u[a.which]?u[a.which]:String.fromCharCode(a.which).toLowerCase()}function h(a,b){return a.sort().join(",")===b.sort().join(",")}function i(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function j(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function k(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function l(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function m(){if(!s){s={};for(var a in t)a>95&&112>a||t.hasOwnProperty(a)&&(s[t[a]]=a)}return s}function n(a,b,c){return c||(c=m()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function o(a){return"+"===a?["+"]:(a=a.replace(/\+{2}/g,"+plus"),a.split("+"))}function p(a,b){var c,d,e,f=[];for(c=o(a),e=0;e<c.length;++e)d=c[e],w[d]&&(d=w[d]),b&&"keypress"!=b&&v[d]&&(d=v[d],f.push("shift")),l(d)&&f.push(d);return b=n(d,f,b),{key:d,modifiers:f,action:b}}function q(a,b){return null===a||a===d?!1:a===b?!0:q(a.parentNode,b)}function r(a){function b(a){a=a||{};var b,c=!1;for(b in u)a[b]?c=!0:u[b]=0;c||(x=!1)}function c(a,b,c,d,e,f){var g,i,j=[],k=c.type;if(!s._callbacks[a])return[];for("keyup"==k&&l(a)&&(b=[a]),g=0;g<s._callbacks[a].length;++g)if(i=s._callbacks[a][g],(d||!i.seq||u[i.seq]==i.level)&&k==i.action&&("keypress"==k&&!c.metaKey&&!c.ctrlKey||h(b,i.modifiers))){var m=!d&&i.combo==e,n=d&&i.seq==d&&i.level==f;(m||n)&&s._callbacks[a].splice(g,1),j.push(i)}return j}function e(a,b,c,d){s.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(j(b),k(b))}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=g(a);if(b)return"keyup"==a.type&&v===b?void(v=!1):void s.handleKey(b,i(a),a)}function n(){clearTimeout(t),t=setTimeout(b,1e3)}function o(a,c,d,f){function h(b){return function(){x=b,++u[a],n()}}function i(c){e(d,c,a),"keyup"!==f&&(v=g(c)),
setTimeout(b,10)}u[a]=0;for(var j=0;j<c.length;++j){var k=j+1===c.length,l=k?i:h(f||p(c[j+1]).action);q(c[j],l,f,a,j)}}function q(a,b,d,e,f){s._directMap[a+":"+d]=b,a=a.replace(/\s+/g," ");var g,h=a.split(" ");return h.length>1?void o(a,h,b,d):(g=p(a,d),s._callbacks[g.key]=s._callbacks[g.key]||[],c(g.key,g.modifiers,{type:g.action},e,a,f),void s._callbacks[g.key][e?"unshift":"push"]({callback:b,modifiers:g.modifiers,action:g.action,seq:e,level:f,combo:a}))}var s=this;if(a=a||d,!(s instanceof r))return new r(a);s.target=a,s._callbacks={},s._directMap={};var t,u={},v=!1,w=!1,x=!1;s._handleKey=function(a,d,f){var g,h=c(a,d,f),i={},j=0,k=!1;for(g=0;g<h.length;++g)h[g].seq&&(j=Math.max(j,h[g].level));for(g=0;g<h.length;++g)if(h[g].seq){if(h[g].level!=j)continue;k=!0,i[h[g].seq]=1,e(h[g].callback,f,h[g].combo,h[g].seq)}else k||e(h[g].callback,f,h[g].combo);var m="keypress"==f.type&&w;f.type!=x||l(a)||m||b(i),w=k&&"keydown"==f.type},s._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)q(a[d],b,c)},f(a,"keypress",m),f(a,"keydown",m),f(a,"keyup",m)}for(var s,t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},v={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},w={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},x=1;20>x;++x)t[111+x]="f"+x;for(x=0;9>=x;++x)t[x+96]=x;r.prototype.bind=function(a,b,c){var d=this;return a=a instanceof Array?a:[a],d._bindMultiple.call(d,a,b,c),d},r.prototype.unbind=function(a,b){var c=this;return c.bind.call(c,a,function(){},b)},r.prototype.trigger=function(a,b){var c=this;return c._directMap[a+":"+b]&&c._directMap[a+":"+b]({},a),c},r.prototype.reset=function(){var a=this;return a._callbacks={},a._directMap={},a},r.prototype.stopCallback=function(a,b){var c=this;return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:q(b,c.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},r.prototype.handleKey=function(){var a=this;return a._handleKey.apply(a,arguments)},r.init=function(){var a=r(d);for(var b in a)"_"!==b.charAt(0)&&(r[b]=function(b){return function(){return a[b].apply(a,arguments)}}(b))},r.init(),b.Mousetrap=r,"undefined"!=typeof c&&c.exports&&(c.exports=r),"function"==typeof a&&a.amd&&a(function(){return r})}(window,document)},{}],35:[function(b,c,d){(function(){function b(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=w(d,f,4);var g=!D(c)&&v.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function e(a){return function(b,c,d){c=x(c,d);for(var e=C(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function f(a,b,c){return function(d,e,f){var g=0,h=C(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(n.call(d,g,h),v.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function g(a,b){var c=I.length,d=a.constructor,e=v.isFunction(d)&&d.prototype||k,f="constructor";for(v.has(a,f)&&!v.contains(b,f)&&b.push(f);c--;)f=I[c],f in a&&a[f]!==e[f]&&!v.contains(b,f)&&b.push(f)}var h=this,i=h._,j=Array.prototype,k=Object.prototype,l=Function.prototype,m=j.push,n=j.slice,o=k.toString,p=k.hasOwnProperty,q=Array.isArray,r=Object.keys,s=l.bind,t=Object.create,u=function(){},v=function(a){return a instanceof v?a:this instanceof v?void(this._wrapped=a):new v(a)};"undefined"!=typeof d?("undefined"!=typeof c&&c.exports&&(d=c.exports=v),d._=v):h._=v,v.VERSION="1.8.3";var w=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},x=function(a,b,c){return null==a?v.identity:v.isFunction(a)?w(a,b,c):v.isObject(a)?v.matcher(a):v.property(a)};v.iteratee=function(a,b){return x(a,b,1/0)};var y=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},z=function(a){if(!v.isObject(a))return{};if(t)return t(a);u.prototype=a;var b=new u;return u.prototype=null,b},A=function(a){return function(b){return null==b?void 0:b[a]}},B=Math.pow(2,53)-1,C=A("length"),D=function(a){var b=C(a);return"number"==typeof b&&b>=0&&B>=b};v.each=v.forEach=function(a,b,c){b=w(b,c);var d,e;if(D(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=v.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},v.map=v.collect=function(a,b,c){b=x(b,c);for(var d=!D(a)&&v.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},v.reduce=v.foldl=v.inject=b(1),v.reduceRight=v.foldr=b(-1),v.find=v.detect=function(a,b,c){var d;return d=D(a)?v.findIndex(a,b,c):v.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},v.filter=v.select=function(a,b,c){var d=[];return b=x(b,c),v.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},v.reject=function(a,b,c){return v.filter(a,v.negate(x(b)),c)},v.every=v.all=function(a,b,c){b=x(b,c);for(var d=!D(a)&&v.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},v.some=v.any=function(a,b,c){b=x(b,c);for(var d=!D(a)&&v.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},v.contains=v.includes=v.include=function(a,b,c,d){return D(a)||(a=v.values(a)),("number"!=typeof c||d)&&(c=0),v.indexOf(a,b,c)>=0},v.invoke=function(a,b){var c=n.call(arguments,2),d=v.isFunction(b);return v.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},v.pluck=function(a,b){return v.map(a,v.property(b))},v.where=function(a,b){return v.filter(a,v.matcher(b))},v.findWhere=function(a,b){return v.find(a,v.matcher(b))},v.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=D(a)?a:v.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=x(b,c),v.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},v.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=D(a)?a:v.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=x(b,c),v.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},v.shuffle=function(a){for(var b,c=D(a)?a:v.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=v.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},v.sample=function(a,b,c){return null==b||c?(D(a)||(a=v.values(a)),a[v.random(a.length-1)]):v.shuffle(a).slice(0,Math.max(0,b))},v.sortBy=function(a,b,c){return b=x(b,c),v.pluck(v.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var E=function(a){return function(b,c,d){var e={};return c=x(c,d),v.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};v.groupBy=E(function(a,b,c){v.has(a,c)?a[c].push(b):a[c]=[b]}),v.indexBy=E(function(a,b,c){a[c]=b}),v.countBy=E(function(a,b,c){v.has(a,c)?a[c]++:a[c]=1}),v.toArray=function(a){return a?v.isArray(a)?n.call(a):D(a)?v.map(a,v.identity):v.values(a):[]},v.size=function(a){return null==a?0:D(a)?a.length:v.keys(a).length},v.partition=function(a,b,c){b=x(b,c);var d=[],e=[];return v.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},v.first=v.head=v.take=function(a,b,c){return null!=a?null==b||c?a[0]:v.initial(a,a.length-b):void 0},v.initial=function(a,b,c){return n.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},v.last=function(a,b,c){return null!=a?null==b||c?a[a.length-1]:v.rest(a,Math.max(0,a.length-b)):void 0},v.rest=v.tail=v.drop=function(a,b,c){return n.call(a,null==b||c?1:b)},v.compact=function(a){return v.filter(a,v.identity)};var F=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=C(a);h>g;g++){var i=a[g];if(D(i)&&(v.isArray(i)||v.isArguments(i))){b||(i=F(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};v.flatten=function(a,b){return F(a,b,!1)},v.without=function(a){return v.difference(a,n.call(arguments,1))},v.uniq=v.unique=function(a,b,c,d){v.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=x(c,d));for(var e=[],f=[],g=0,h=C(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?v.contains(f,j)||(f.push(j),e.push(i)):v.contains(e,i)||e.push(i)}return e},v.union=function(){return v.uniq(F(arguments,!0,!0))},v.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=C(a);e>d;d++){var f=a[d];if(!v.contains(b,f)){for(var g=1;c>g&&v.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},v.difference=function(a){var b=F(arguments,!0,!0,1);return v.filter(a,function(a){return!v.contains(b,a)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(a){for(var b=a&&v.max(a,C).length||0,c=Array(b),d=0;b>d;d++)c[d]=v.pluck(a,d);return c},v.object=function(a,b){for(var c={},d=0,e=C(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},v.findIndex=e(1),v.findLastIndex=e(-1),v.sortedIndex=function(a,b,c,d){c=x(c,d,1);for(var e=c(b),f=0,g=C(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},v.indexOf=f(1,v.findIndex,v.sortedIndex),v.lastIndexOf=f(-1,v.findLastIndex),v.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var G=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=z(a.prototype),g=a.apply(f,e);return v.isObject(g)?g:f};v.bind=function(a,b){if(s&&a.bind===s)return s.apply(a,n.call(arguments,1));if(!v.isFunction(a))throw new TypeError("Bind must be called on a function");var c=n.call(arguments,2),d=function(){return G(a,d,b,this,c.concat(n.call(arguments)))};return d},v.partial=function(a){var b=n.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===v?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return G(a,c,this,this,f)};return c},v.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=v.bind(a[c],a);return a},v.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return v.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},v.delay=function(a,b){var c=n.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},v.defer=v.partial(v.delay,v,1),v.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:v.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=v.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},v.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=v.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=v.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},v.wrap=function(a,b){return v.partial(b,a)},v.negate=function(a){return function(){return!a.apply(this,arguments)}},v.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},v.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},v.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},v.once=v.partial(v.before,2);var H=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];v.keys=function(a){if(!v.isObject(a))return[];if(r)return r(a);var b=[];for(var c in a)v.has(a,c)&&b.push(c);return H&&g(a,b),b},v.allKeys=function(a){if(!v.isObject(a))return[];var b=[];for(var c in a)b.push(c);return H&&g(a,b),b},v.values=function(a){for(var b=v.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},v.mapObject=function(a,b,c){b=x(b,c);for(var d,e=v.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},v.pairs=function(a){for(var b=v.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},v.invert=function(a){for(var b={},c=v.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},v.functions=v.methods=function(a){var b=[];for(var c in a)v.isFunction(a[c])&&b.push(c);return b.sort()},v.extend=y(v.allKeys),v.extendOwn=v.assign=y(v.keys),v.findKey=function(a,b,c){b=x(b,c);for(var d,e=v.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},v.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;v.isFunction(b)?(e=v.allKeys(g),d=w(b,c)):(e=F(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},v.omit=function(a,b,c){if(v.isFunction(b))b=v.negate(b);else{var d=v.map(F(arguments,!1,!1,1),String);b=function(a,b){return!v.contains(d,b)}}return v.pick(a,b,c)},v.defaults=y(v.allKeys,!0),v.create=function(a,b){var c=z(a);return b&&v.extendOwn(c,b),c},v.clone=function(a){return v.isObject(a)?v.isArray(a)?a.slice():v.extend({},a):a},v.tap=function(a,b){return b(a),a},v.isMatch=function(a,b){var c=v.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var J=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof v&&(a=a._wrapped),b instanceof v&&(b=b._wrapped);var e=o.call(a);if(e!==o.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(v.isFunction(g)&&g instanceof g&&v.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!J(a[i],b[i],c,d))return!1}else{var j,k=v.keys(a);if(i=k.length,v.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!v.has(b,j)||!J(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};v.isEqual=function(a,b){return J(a,b)},v.isEmpty=function(a){return null==a?!0:D(a)&&(v.isArray(a)||v.isString(a)||v.isArguments(a))?0===a.length:0===v.keys(a).length},v.isElement=function(a){return!(!a||1!==a.nodeType)},v.isArray=q||function(a){return"[object Array]"===o.call(a)},v.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){v["is"+a]=function(b){return o.call(b)==="[object "+a+"]"}}),v.isArguments(arguments)||(v.isArguments=function(a){return v.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(v.isFunction=function(a){return"function"==typeof a||!1}),v.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},v.isNaN=function(a){return v.isNumber(a)&&a!==+a},v.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===o.call(a)},v.isNull=function(a){return null===a},v.isUndefined=function(a){return void 0===a},v.has=function(a,b){return null!=a&&p.call(a,b)},v.noConflict=function(){return h._=i,this},v.identity=function(a){return a},v.constant=function(a){return function(){return a}},v.noop=function(){},v.property=A,v.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},v.matcher=v.matches=function(a){return a=v.extendOwn({},a),function(b){return v.isMatch(b,a)}},v.times=function(a,b,c){var d=Array(Math.max(0,a));b=w(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},v.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},v.now=Date.now||function(){return(new Date).getTime()};var K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=v.invert(K),M=function(a){var b=function(b){return a[b]},c="(?:"+v.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};v.escape=M(K),v.unescape=M(L),v.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),v.isFunction(d)?d.call(a):d};var N=0;v.uniqueId=function(a){var b=++N+"";return a?a+b:b},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Q=/\\|'|\r|\n|\u2028|\u2029/g,R=function(a){return"\\"+P[a]};v.template=function(a,b,c){!b&&c&&(b=c),b=v.defaults({},b,v.templateSettings);var d=RegExp([(b.escape||O).source,(b.interpolate||O).source,(b.evaluate||O).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(Q,R),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,v)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},v.chain=function(a){var b=v(a);return b._chain=!0,b};var S=function(a,b){return a._chain?v(b).chain():b};v.mixin=function(a){v.each(v.functions(a),function(b){var c=v[b]=a[b];v.prototype[b]=function(){var a=[this._wrapped];return m.apply(a,arguments),S(this,c.apply(v,a))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=j[a];v.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],S(this,c)}}),v.each(["concat","join","slice"],function(a){var b=j[a];v.prototype[a]=function(){return S(this,b.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},"function"==typeof a&&a.amd&&a("underscore",[],function(){return v})}).call(this)},{}],36:[function(a,b,c){function d(a){var b="    ";if(isNaN(parseInt(a)))b=a;else switch(a){case 1:b=" ";break;case 2:b="  ";break;case 3:b="   ";break;case 4:b="    ";break;case 5:b="     ";break;case 6:b="      ";break;case 7:b="       ";break;case 8:b="        ";break;case 9:b="         ";break;case 10:b="          ";break;case 11:b="           ";break;case 12:b="            "}var c=["\n"];for(ix=0;ix<100;ix++)c.push(c[ix]+b);return c}function e(){this.step="    ",this.shift=d(this.step)}function f(a,b){return b-(a.replace(/\(/g,"").length-a.replace(/\)/g,"").length)}function g(a,b){return a.replace(/\s{1,}/g," ").replace(/ AND /gi,"~::~"+b+b+"AND ").replace(/ BETWEEN /gi,"~::~"+b+"BETWEEN ").replace(/ CASE /gi,"~::~"+b+"CASE ").replace(/ ELSE /gi,"~::~"+b+"ELSE ").replace(/ END /gi,"~::~"+b+"END ").replace(/ FROM /gi,"~::~FROM ").replace(/ GROUP\s{1,}BY/gi,"~::~GROUP BY ").replace(/ HAVING /gi,"~::~HAVING ").replace(/ IN /gi," IN ").replace(/ JOIN /gi,"~::~JOIN ").replace(/ CROSS~::~{1,}JOIN /gi,"~::~CROSS JOIN ").replace(/ INNER~::~{1,}JOIN /gi,"~::~INNER JOIN ").replace(/ LEFT~::~{1,}JOIN /gi,"~::~LEFT JOIN ").replace(/ RIGHT~::~{1,}JOIN /gi,"~::~RIGHT JOIN ").replace(/ ON /gi,"~::~"+b+"ON ").replace(/ OR /gi,"~::~"+b+b+"OR ").replace(/ ORDER\s{1,}BY/gi,"~::~ORDER BY ").replace(/ OVER /gi,"~::~"+b+"OVER ").replace(/\(\s{0,}SELECT /gi,"~::~(SELECT ").replace(/\)\s{0,}SELECT /gi,")~::~SELECT ").replace(/ THEN /gi," THEN~::~"+b).replace(/ UNION /gi,"~::~UNION~::~").replace(/ USING /gi,"~::~USING ").replace(/ WHEN /gi,"~::~"+b+"WHEN ").replace(/ WHERE /gi,"~::~WHERE ").replace(/ WITH /gi,"~::~WITH ").replace(/ ALL /gi," ALL ").replace(/ AS /gi," AS ").replace(/ ASC /gi," ASC ").replace(/ DESC /gi," DESC ").replace(/ DISTINCT /gi," DISTINCT ").replace(/ EXISTS /gi," EXISTS ").replace(/ NOT /gi," NOT ").replace(/ NULL /gi," NULL ").replace(/ LIKE /gi," LIKE ").replace(/\s{0,}SELECT /gi,"SELECT ").replace(/\s{0,}UPDATE /gi,"UPDATE ").replace(/ SET /gi," SET ").replace(/~::~{1,}/g,"~::~").split("~::~")}e.prototype.xml=function(a,b){var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").replace(/\s*xmlns\=/g,"~::~xmlns=").split("~::~"),e=c.length,f=!1,g=0,h="",i=0,j=b?d(b):this.shift;for(i=0;e>i;i++)c[i].search(/<!/)>-1?(h+=j[g]+c[i],f=!0,(c[i].search(/-->/)>-1||c[i].search(/\]>/)>-1||c[i].search(/!DOCTYPE/)>-1)&&(f=!1)):c[i].search(/-->/)>-1||c[i].search(/\]>/)>-1?(h+=c[i],f=!1):/^<\w/.exec(c[i-1])&&/^<\/\w/.exec(c[i])&&/^<[\w:\-\.\,]+/.exec(c[i-1])==/^<\/[\w:\-\.\,]+/.exec(c[i])[0].replace("/","")?(h+=c[i],f||g--):c[i].search(/<\w/)>-1&&-1==c[i].search(/<\//)&&-1==c[i].search(/\/>/)?h=h+=f?c[i]:j[g++]+c[i]:c[i].search(/<\w/)>-1&&c[i].search(/<\//)>-1?h=h+=f?c[i]:j[g]+c[i]:c[i].search(/<\//)>-1?h=h+=f?c[i]:j[--g]+c[i]:c[i].search(/\/>/)>-1?h=h+=f?c[i]:j[g]+c[i]:h+=c[i].search(/<\?/)>-1?j[g]+c[i]:c[i].search(/xmlns\:/)>-1||c[i].search(/xmlns\=/)>-1?j[g]+c[i]:c[i];return"\n"==h[0]?h.slice(1):h},e.prototype.json=function(a,b){var b=b?b:this.step;return"undefined"==typeof JSON?a:"string"==typeof a?JSON.stringify(JSON.parse(a),null,b):"object"==typeof a?JSON.stringify(a,null,b):a},e.prototype.css=function(a,b){var c=a.replace(/\s{1,}/g," ").replace(/\{/g,"{~::~").replace(/\}/g,"~::~}~::~").replace(/\;/g,";~::~").replace(/\/\*/g,"~::~/*").replace(/\*\//g,"*/~::~").replace(/~::~\s{0,}~::~/g,"~::~").split("~::~"),e=c.length,f=0,g="",h=0,i=b?d(b):this.shift;for(h=0;e>h;h++)g+=/\{/.exec(c[h])?i[f++]+c[h]:/\}/.exec(c[h])?i[--f]+c[h]:/\*\\/.exec(c[h])?i[f]+c[h]:i[f]+c[h];return g.replace(/^\n{1,}/,"")},e.prototype.sql=function(a,b){var c=a.replace(/\s{1,}/g," ").replace(/\'/gi,"~::~'").split("~::~"),e=c.length,h=[],i=0,j=this.step,k=0,l="",m=0,n=b?d(b):this.shift;for(m=0;e>m;m++)h=m%2?h.concat(c[m]):h.concat(g(c[m],j));for(e=h.length,m=0;e>m;m++){k=f(h[m],k),/\s{0,}\s{0,}SELECT\s{0,}/.exec(h[m])&&(h[m]=h[m].replace(/\,/g,",\n"+j+j)),/\s{0,}\s{0,}SET\s{0,}/.exec(h[m])&&(h[m]=h[m].replace(/\,/g,",\n"+j+j)),/\s{0,}\(\s{0,}SELECT\s{0,}/.exec(h[m])?(i++,l+=n[i]+h[m]):/\'/.exec(h[m])?(1>k&&i&&i--,l+=h[m]):(l+=n[i]+h[m],1>k&&i&&i--)}return l=l.replace(/^\n{1,}/,"").replace(/\n{1,}/g,"\n")},e.prototype.xmlmin=function(a,b){var c=b?a:a.replace(/\<![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\>/g,"").replace(/[ \r\n\t]{1,}xmlns/g," xmlns");return c.replace(/>\s{0,}</g,"><")},e.prototype.jsonmin=function(a){return"undefined"==typeof JSON?a:JSON.stringify(JSON.parse(a),null,0)},e.prototype.cssmin=function(a,b){var c=b?a:a.replace(/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,"");return c.replace(/\s{1,}/g," ").replace(/\{\s{1,}/g,"{").replace(/\}\s{1,}/g,"}").replace(/\;\s{1,}/g,";").replace(/\/\*\s{1,}/g,"/*").replace(/\*\/\s{1,}/g,"*/")},e.prototype.sqlmin=function(a){return a.replace(/\s{1,}/g," ").replace(/\s{1,}\(/,"(").replace(/\s{1,}\)/,")")},b.exports=new e},{}]},{},[28])(28)});
//# sourceMappingURL=escher.min.js.map